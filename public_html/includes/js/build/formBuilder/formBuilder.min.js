function removeFormPreviewItem(a){if(confirm("Are you sure you want to remove this field?")){var b=a.parent().parent();"fieldset"==a.parent().next().children(":input[name^=type_]").val()&&b.after(a.next().find("li"));var c=$(".addFieldNav").parent();b.removeClass("well activeField").remove(),c.hasClass("active")||($(".addFieldNav").click().tab("show"),$("#formPreview li:first-child").trigger("click")),$("#formSettings_formMetadata").not(":checked")&&(0===$(":input[name^=type_][value=idno]",formPreview).length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}}function applyFormPreview(){var a;a="undefined"==typeof globalFieldID?$("#formPreview").children().find(".fieldPreview"):$("#formPreview_"+globalFieldID).find(".fieldPreview"),a.each(function(){var a=$(this).find(".fieldLabels"),b=$(this).find(".controls").children(),c=$(this).next(),d=c.find($('input[name^="placeholder"]')).val(),e=(c.find($('input[name^="type"]')).val(),c.find($('input[name^="name"]')).val()),f=(c.find($('input[name^="style"]')).val(),c.find($('input[name^="label"]')).val()),g=c.find($('input[name^="id"]')).val(),h=c.find($('input[name^="class"]')).val(),i=c.find($('input[name^="value"]')).val(),j=c.find($('input[name^="disabled"')).val(),k=c.find($('input[name^="readonly"')).val();c.find($('input[name^="hidden"]')).val(),c.find($('input[name^="choicesOptions"]')).val(),c.find($('input[name^="choicesType"]')).val();b.attr({placeholder:d,name:e,id:g,"class":h}),b.val(i),"true"===j||"true"===k?(b.prop("readonly",!0).addClass("disabled"),b.prop("disabled",!0).addClass("disabled")):(b.prop("readonly",!1).removeClass("disabled"),b.prop("disabled",!1).removeClass("disabled")),i.length&&b.val(i),a.html(f)})}function sortableForm(){$("#formCreator ul.sortable").sortable({connectWith:"#formCreator ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("Field Set"==$(b.item).text()&&"formPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNewField(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableForm()}}),calculatePosition()}function calculatePosition(){$("#formCreator ul.sortable").children("li").each(function(a){$(this).attr("data-position",a),$(this).find("[data-bind='position']").val(a)})}function showFieldSettings(a){var b=$("#fieldSettings_form"),c=$("#fieldSettings_fieldset_form");if(void 0===a)$("#noFieldSelected").show(),c.hide(),b.hide();else{var d,e,f,g=a,h=$("#type_"+g).val(),i=$("#fieldset_"+g);if($("#noFieldSelected").hide(),"fieldset"==h)c.show(),b.hide();else{c.hide(),b.show(),b.find(".dataSettings").children().hide(),b.find(".default").show();var j=$("#fieldSettings_name"),k=$("#fieldSettings_options_required"),l=$("#fieldSettings_options_duplicates"),m=$("#fieldSettings_options_displayTable"),n=$("#fieldSettings_options_readonly"),o=$("#fieldSettings_options_disabled");switch("idno"==h?(j.prop("readonly",!0).val("idno").keyup(),k.prop({checked:!0,disabled:!0}).change(),l.prop({checked:!0,disabled:!0}).change(),m.prop({checked:!0,disabled:!0}).change(),n.prop({checked:!0,disabled:!0}).change(),o.prop({checked:!1,disabled:!0}).change()):"file"==h?m.removeAttr("checked").change().prop("disabled",!0):(j.removeAttr("readonly"),k.removeAttr("disabled"),l.removeAttr("disabled"),n.removeAttr("disabled"),o.removeAttr("disabled"),m.removeAttr("disabled")),h){case"idno":$("#fieldSettings_container_idno").parent().show();break;case"text":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_externalUpdate").parent().hide(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"textarea":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"radio":case"checkbox":case"select":case"multiselect":$("#fieldSettings_container_choices").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;case"number":$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().show(),$("#fieldSettings_range_format").parent().removeClass("span6").addClass("span4"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="value">Value</option><option value="digits">Digits</option>');break;case"wysiwyg":$("#fieldSettings_container_placeholder").hide(),$("#fieldSettings_container_value").hide();break;case"file":$("#fieldSettings_container_file_allowedExtensions").parent().show(),$("#fieldSettings_container_file_options").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;default:$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show()}var p=$("#choicesOptions_"+g).val();if(void 0!==p){var q=$("#fieldSettings_choices_manual");for(d=p.split("%,%"),e="",f=0;f<d.length;f++)e+=addChoice(d[f],$("#choicesDefault_"+g).val());q.html(e).find("input[name=fieldSettings_choices_text]").keyup()}var r=$("#allowedExtensions_"+g).val();if(void 0!==r){var s=$("#fieldSettings_file_allowedExtensions");for(d=r.split("%,%"),e="",s.html(""),f=0;f<d.length;f++)e+=addAllowedExtension(d[f]);s.append(e),s.find(":input[name=fieldSettings_allowedExtension_text]:first").keyup()}var t=$("#metadataStandard_"+g).val();if(void 0!==t){var u=$("#metadataStandard_options");for(d=t.split("%,%"),e="",u.html(""),f=0;f<d.length;f++)e+=addMetadataStandard(d[f]);u.append(e),$(".mdStandardSelect").each(function(){var a=$(this).data("selectvalue");$(this).val(a)})}if("fieldset"!=h){var v=i.parents("li").parents("li");if(v.length>0){var w=v.prop("id").split("_")[1];i.val($("#fieldset_"+w).val())}else i.val("")}else $("#fieldSettings_fieldset").val(i.val());-1!=$.inArray(h,["idno","text","textarea","date","time","wysiwyg"])?$("#fieldVariablesLink").show():$("#fieldVariablesLink").hide(),$("#fieldSettings_externalUpdate_formSelect").change(function(){var a=$(this).val();void 0===choicesFields[a]&&(choicesFields[a]="",$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var b=JSON.parse(a);$.each(b,function(a,b){var c="";$.each(b,function(a,b){c+='<option value="'+b.name+'">'+b.label+"</option>"}),choicesFields[a]=c})})),$("#externalUpdateForm_"+g).val(a).change(),$("#fieldSettings_externalUpdate_fieldSelect").html(choicesFields[a]).change()}),$(".uxOptions").find("input").change(function(){var a=$(this).data("bindmodel"),b=$("."+a);$(this).is(":checked")||$(this).value?b.show():b.hide()}),enableChoiceFunctionality()}}}function fieldSettingsBindings(){var a=$("#formPreview");a.children("li").removeClass("activeField"),$("#fieldSettings_form").find("[data-bindmodel]").bind("change keyup",bindToHiddenForm),a.on("click","li",function(b){if(b.stopPropagation(),$(b.target).is(".icon-remove"))console.log($(this)),removeFormPreviewItem($(b.target));else{var c=$(this).data("id");globalFieldID=c,a.find("[data-bind]").bind("change",setOriginalValues),$(this).hasClass("activeField")||(a.find(".activeField").removeClass("activeField"),$(this).addClass("activeField"),$("#fieldTab a[href='#fieldSettings']").tab("show"),showFieldSettings(c),setInitialBind(),applyFormPreview())}})}function setInitialBind(){var a=globalFieldID;if("undefined"!=typeof a){var b=$("#formPreview").find("[data-id='"+a+"']"),c=b.find(".fieldValues");c.find("[data-bind]").change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues)}}function setOriginalValues(){var a=globalFieldID,b=$(this).data("bind"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#fieldSettings_form").find("[data-bindmodel='"+b+"']"),e=$("#formPreview").find("[data-id='"+a+"']"),f=e.find(".fieldPreview");if("name"==b&&(c=$.trim(c),evaluateSpace(c,d)),"idnoFormat"==b&&(idnoValues.idnoFormat=c),"startIncrement"==b&&(idnoValues.startIncrement=c),"help"==b){var g=c.split("|")[0],h=c.split("|")[1].sanitizeInput().unEscapeHtml(),c="undefined"==h?"":h;$(this).val(g+"|"+h),$("#fieldSettings_help_textarea").val(c).hide(),$("#fieldSettings_help_url").hide().val(c),$("#fieldSettings_help_type").val(g).change()}d.is("input[type=checkbox]")?"true"==c?d.prop("checked",!0):d.prop("checked",!1):d.is("select")?d.find('option[value="'+c+'"]').prop("selected",!0):d.is("input[type=number]")?d.val(parseInt(c)):d.val(c),d.is($("#fieldSettings_choices_type"))&&("manual"==c?($("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide()):($("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show())),"managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"validation"==b&&("regexp"==c?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide()),"choicesForm"==b&&("null"==c||void 0==c?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error"))),"choicesDefault"==b&&$('input[value="'+c+'"]').prev().addClass("active"),"choicesField"==b&&($("#fieldSettings_choices_formSelect").change(),$("#fieldSettings_choices_fieldSelect").val(c).change())}function bindToHiddenForm(){var a=globalFieldID;if("undefined"!=typeof a){var b=$(this).data("bindmodel"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#formPreview").find("[data-id='"+a+"']"),e=($("#formPreview_"+a).find(".fieldLabels"),d.find(".fieldValues")),f=d.find(".fieldPreview");if(e.find("[data-bind='"+b+"']").val(c),"name"==b&&(evaluateSpace(c,$(this)),titleField()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"choicesType"==b)if("manual"==c)$("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide(),$("#choicesForm_"+a).val("");else{$("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show();var g=e.find($('input[name^="type"]')).val();"multiselect"==g?f.find(".controls").find($("select")).html():"checkbox"==g||"radio"==g?f.find(".controls").find($("label")).remove():"select"==g&&f.find($(".controls")).find($("select")).html(output)}if("managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"idnoFormat"==b||"startIncrement"==b||"idnoConfirm"==b){$("#fieldSettings_container_idno_confirm").removeClass("hidden").show();var h=$("#fieldSettings_idno_confirm").is(":checked");h===!1&&idnoValues.idnoFormat?$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled")}if("validation"==b){var i=$("#fieldSettings_validation").val();"regexp"===i?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide().val("")}if(("helpText"==b||"helpURL"==b)&&formatHelpForHiddenField(e),"helpType"==b){switch($(this).val()){case"text":case"html":$("#fieldSettings_help_textarea").show().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden");break;case"web":$("#fieldSettings_help_url").show().removeClass("hidden"),$("#fieldSettings_help_textarea").hide().removeClass("hidden");break;case"none":case"default":$("#fieldSettings_help_textarea").hide().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden")}formatHelpForHiddenField(e)}applyFormPreview()}}function formatHelpForHiddenField(a){var b,c=$("#fieldSettings_help_type").val(),d=globalFieldID;"text"==c||"html"==c?(b=$("#fieldSettings_help_textarea").val().sanitizeInput().escapeHtml(),console.log(b)):(b=$("#fieldSettings_help_url").val(),console.log(b),validateURL(b)?$("#fieldSettings_help_url").removeClass("has-error"):$("#fieldSettings_help_url").addClass("has-error"));var e=c+"|"+b;$("#fieldSettings_help_text").val(e),a.find("[data-bind='help']").val(e),$(".helpPreview").popover("destroy"),$(".helpPreview").hide(),"html"===c||"text"===c?($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help",content:"<div>"+b.unEscapeHtml()+"</div>",trigger:"click",html:!0})):"web"===c&&($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help Url",content:'<div><a href="'+b+'">'+b+"</a></div>",trigger:"click",html:!0}))}function evaluateSpace(a,b){checkForSpaces(a)?(b.addClass("has-error testy"),$(".noSpacesAlert").show(),$("input[type=submit]").addClass("disabled").attr("disabled",!0)):(b.removeClass("has-error"),$("input[type=submit]").removeClass("disabled").removeAttr("disabled"),$(".noSpacesAlert").hide())}function getFormFields(){var a="";return $.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(b){var c=JSON.parse(b);$.each(c,function(b,c){$.each(c,function(b,c){a+='<option value="'+c.name+'">'+c.label+"</option>"})})}),a}function evaluateCheck(a){return a.is(":checked")?!0:!1}function formSettingsBindings(){$("#formTitle").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formTitle").focus()}),$("#formSettings_formTitle").keyup(function(){$("#formTitle").html($(this).val()),0!==$(this).val().length?$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled")}).keyup(),$("#formDescription").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formDescription").focus()}),$("#formSettings_formDescription").keyup(function(){$("#formDescription").html($(this).val())}).keyup(),$("#formSettings_formMetadata").change(function(){var a=$("#fieldAdd"),b=$("#formPreview").find("input[name^=type_][value=idno]");$(this).is(":checked")?($("#formSettings_linkTitle_container").show(),0===b.length?($("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):confirm("Enabling this will remove any existing ID Number fields. Do you want to continue?")?(b.parent().parent().remove(),$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):$(this).removeAttr("checked")):($("#formSettings_linkTitle_container").hide(),a.find("li:contains('ID Number')").show(),a.find("li:contains('Paragraph Text')").show(),a.find("li:contains('Radio')").show(),a.find("li:contains('Checkboxes')").show(),a.find("li:contains('Dropdown')").show(),a.find("li:contains('Multi-Select')").show(),a.find("li:contains('File Upload')").show(),a.find("li:contains('WYSIWYG')").show(),a.find("li:contains('Field Set')").parent().show().prev().show(),0===b.length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}).change()}function modalBindings(){$("#formTypeSelector").modal({show:!1,keyboard:!1,backdrop:"static"}).on("click","button:contains('Metadata')",function(){$(".nav-tabs li:nth-child(3) a").click(),$("#formSettings_formMetadata").prop("checked",!0).change(),$("#formTypeSelector").modal("hide")}).on("click","button:contains('Object')",function(){var a=$("#fieldAdd"),b=($("#formPreview .well"),$("#fieldSettings_label")),c=$("#fieldSettings_options_sortable"),d=$("#fieldSettings_options_searchable");a.find("li:contains('ID Number')").click(),b.val("IDNO").keyup(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),a.find("li:contains('Single Line Text')").click(),$("#fieldSettings_name").val("title").keyup(),b.val("Title").keyup(),$("#fieldSettings_options_required").prop("checked",!0).change(),$("#fieldSettings_options_duplicates").prop("checked",!0).change(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),$("#fieldSettings_options_displayTable").prop("checked",!0).change(),$("#fieldTab li:last a").click(),$("#formPreview li").removeClass("activeField"),$("#formSettings_formMetadata").removeAttr("checked").change(),$("#formTypeSelector").modal("hide"),$("#formSettings_formTitle")})}function addNewField(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c=0;$("#formPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");c<=b[1]&&(c=parseInt(b[1])+1)}}),$(a).attr({id:"formPreview_"+c,"data-id":c}).html('<div class="fieldPreview">'+newFieldPreview(c,b)+'</div><div class="fieldValues">'+newFieldValues(c,b)+"</div>"),$("#formPreview_"+c).click(),$("#formSettings_formMetadata").not(":checked")&&(0===$("#formPreview").find("input[name^=type_][value=idno]").length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}function newFieldPreview(a,b,c){var d="";if(void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.choicesOptions="First Choice%,%Second Choice",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),("idno"!=b&&"ID Number"!=b||0!==numIDNOs)&&(d+='<i class="icon-remove"></i>'),d+='<span class="fa fa-question-circle helpPreview"></span>',"Field Set"==b||"fieldset"==b)d+='<fieldset><legend></legend><ul class="unstyled sortable"></ul></fieldset>';else{switch(d+='<div class="control-group"><label class="control-label fieldLabels">Untitled</label><div class="controls">',b){case"ID Number":case"idno":case"Single Line Text":case"text":d+='<input type="text">',numIDNOs++;break;case"Paragraph Text":case"textarea":d+="<textarea></textarea>";break;case"Radio":case"radio":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="radio" checked> '+b+"</label>":'<label> <input type="radio"> '+b+"</label>"})}else d+='<label class="radio"><input type="radio">First Choice</label><label class="radio"><input type="radio">Second Choice</label>';break;case"Checkboxes":case"checkbox":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="checkbox" checked> '+b+"</label>":'<label> <input type="checkbox"> '+b+"</label>"})}else d+='<label class="checkbox"><input type="checkbox">First Choice</label><label class="checkbox"><input type="checkbox">Second Choice</label>';break;case"Dropdown":case"select":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+="<select>",$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+="<select></select>";break;case"Number":case"number":d+='<input type="number">';break;case"Email":case"email":d+='<input type="email">';break;case"Phone":case"tel":d+='<input type="tel">';break;case"Date":case"date":d+='<input type="date">';break;case"Time":case"time":d+='<input type="time">';break;case"Website":case"url":d+='<input type="url">';break;case"Multi-Select":case"multiselect":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+='<select multiple></select><br><select class="selectPreview">',$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+='<select multiple></select><br><select class="selectPreview"></select>';break;case"WYSIWYG":case"wysiwyg":d+='<img src="../includes/img/wysiwyg.png">';break;case"File Upload":case"file":d+='<input type="file" disabled>'}d+="</div></div>"}return d}function newFieldValues(a,b,c){var d="";void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),c.type=determineType(b),b=c.type;var e=["name","position","type","label","value","placeholder","id","class","style","help","helpType","required","duplicates","readonly","disabled","disabledInsert","disabledUpdate","publicRelease","sortable","searchable","displayTable","hidden","validation","validationRegex","access","fieldset","metadataStandard"];switch(d+=createHiddenFields(e,a,c),b){case"idno":var f=["managedBy","idnoFormat"];d+=createHiddenFields(f,a,c),d+='<input type="hidden" id="startIncrement_'+a+'" name="startIncrement_'+a+'"   data-bind="startIncrement"    value="'+(void 0!==c.startIncrement?c.startIncrement:"1")+'">',d+='<input type="hidden" id="idnoConfirm_'+a+'"    name="idnoConfirm_'+a+'"      data-bind"idnoConfirm"        value="false">';break;case"text":var g=["externalUpdateForm","externalUpdateField","min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"textarea":case"number":var g=["min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"radio":case"checkbox":case"select":case"multiselect":var h=["choicesType","choicesNull","choicesDefault","choicesForm","choicesField","choicesFieldDefault"];d+=createHiddenFields(h,a,c),d+='<input type="hidden" id="choicesOptions_'+a+'" name="choicesOptions_'+a+'" data-bind="choicesOptions" value="'+(void 0!==c.choicesOptions?c.choicesOptions:"First Choice%,%Second Choice")+'">';break;case"file":var i=["bgProcessing","multipleFiles","combine","ocr","convert","convertHeight","convertWidth","watermark","watermarkImage","watermarkLocation","border","borderHeight","borderWidth","borderColor","thumbnail","convertAudio","bitRate","audioFormat","convertVideo","videoHeight","videoWidth","videobitRate","aspectRatio","videoFormat","videothumbnail","videoThumbFrames","videoThumbHeight","videoThumbWidth","videoFormatThumb"];d+=createHiddenFields(i,a,c),d+='<input type="hidden" id="allowedExtensions_'+a+'" name="allowedExtensions_'+a+'"     data-bind="allowedExtensions"    value="'+(void 0!==c.allowedExtensions?c.allowedExtensions:"tif%,%tiff%,%jpg")+'">',d+='<input type="hidden" id="convertResolution_'+a+'" name="convertResolution_'+a+'"     data-bind="convertResolution"    value="'+(void 0!==c.convertResolution?c.convertResolution:"192")+'">',d+='<input type="hidden" id="convertFormat_'+a+'"     name="convertFormat_'+a+'"         data-bind="convertFormat"        value="'+(void 0!==c.convertFormat?c.convertFormat:"JPG")+'">',d+='<input type="hidden" id="thumbnailHeight_'+a+'"   name="thumbnailHeight_'+a+'"       data-bind="thumbnailHeight"      value="'+(void 0!==c.thumbnailHeight?c.thumbnailHeight:"150")+'">',d+='<input type="hidden" id="thumbnailWidth_'+a+'"    name="thumbnailWidth_'+a+'"        data-bind="thumbnailWidth"       value="'+(void 0!==c.thumbnailWidth?c.thumbnailWidth:"150")+'">',d+='<input type="hidden" id="thumbnailFormat_'+a+'"   name="thumbnailFormat_'+a+'"       data-bind="thumbnailFormat"      value="'+(void 0!==c.thumbnailFormat?c.thumbnailFormat:"JPG")+'">',d+='<input type="hidden" id="help_'+a+'"   name="help_'+a+'"       data-bind="help"      value="'+(void 0!==c.help?c.help:"none|")+'">'}return d}function determineValidation(a){switch(a){case"Number":case"number":return"integer";case"Email":case"email":return"emailAddr";case"Phone":case"tel":return"phoneNumber";case"Date":case"date":return"date";case"Website":case"url":return"url";default:return}}function determineType(a){switch(a){case"ID Number":case"idno":return"idno";case"Single Line Text":case"text":return"text";case"Paragraph Text":case"textarea":return"textarea";case"Radio":case"radio":return"radio";case"Checkboxes":case"checkbox":return"checkbox";case"Dropdown":case"select":return"select";case"Number":case"number":return"number";case"Email":case"email":return"email";case"Phone":case"tel":return"tel";case"Date":case"date":return"date";case"Time":case"time":return"time";case"Website":case"url":return"url";case"Multi-Select":case"multiselect":return"multiselect";case"WYSIWYG":case"wysiwyg":return"wysiwyg";case"File Upload":case"file":return"file";case"Field Set":case"fieldset":return"fieldset";default:return}}function createHiddenFields(a,b,c){return output="",$.each(a,function(a,d){var e=d+"_"+b,f=void 0!==c[d]?c[d]:"";output+='<input type="hidden" id="'+e+'" name="'+e+'" data-bind="'+d+'" value="'+f+'"/>'}),output}function addChoice(a,b){return"undefined"==typeof a?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':"undefined"==typeof b?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn'+(a==b?" active":"")+'" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>'}function addAllowedExtension(a){return"undefined"==typeof a&&(a=""),'<div class="row-fluid input-append extensionItem" data-itemtype="extension"><input name="fieldSettings_allowedExtension_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add an extension."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this extension."><i class="icon-remove"></i></button></div>'}function addMetadataStandard(a){"undefined"==typeof a&&(a="");var b=metadataSchema,c=a.split(" : ")[1],d=a.split(" : ")[0];"undefined"==typeof c&&(c=""),"undefined"==typeof d&&(d="");var e='<select class="input-block-level form-control mdStandardSelect" id="fieldSettings_standardType" name="fieldSettings_standardType" data-selectvalue="'+d+'"><option value=""> None </option>'+b+"</select>";return'<div class="row-fluid input-append metadata-item" data-itemtype="metadataStandard">'+e+'<input name="fieldSettings_metadataIdentifer" type="text" value="'+c+'"><button name="add" class="btn" type="button" title="Add Metadata Standard"><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove Metadata Standard"><i class="icon-remove"></i></button></div>'}function enableChoiceFunctionality(){$(".choicesItem").find($("input[type=text], select")).bind("change keyup",modifyChoiceBinding).change(),$(".extensionItem").find($("input[type=text], select")).bind("change keyup",extensionBinding).change(),$(".metadata-item").find($("input[type=text], select")).bind("change keyup",metadataBinding).change(),$("#fieldSettings_choices_null").change(function(){$(".input-append").find("input[type=text]").change()}),$(".input-append").find("button").click(function(){var a=$(this).attr("name"),b=$(this).parent().data("itemtype");if("add"==a)"choice"==b?$(this).parent().after(addChoice()):"extension"==b?$(this).parent().after(addAllowedExtension()):$(this).parent().after(addMetadataStandard()),$(".input-append").find("button").unbind("click"),enableChoiceFunctionality();else if("remove"==a)$(this).parent().remove(),$(".input-append").find($("input[type=text]")).change();else if("default"==a){var c=$(this).next().val(),d=globalFieldID;$("#choicesDefault_"+d).val(c),$('button[name="default"]').removeClass("active"),$(this).hasClass("focus")&&$(this).addClass("selected")}}),$("#fieldSettings_choices_formSelect").change(function(){var a=$(this).val();if("null"==a?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error")),void 0===choicesFields[a]){var b;choicesFields[null]=b,$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var c=JSON.parse(a);$.each(c,function(a,c){b="<option value> Select A Field</option>",$.each(c,function(a,c){b+='<option value="'+c.name+'">'+c.label+"</option>"}),choicesFields[a]=b})})}$("#fieldSettings_choices_fieldSelect").html(choicesFields[a])})}function modifyChoiceBinding(){var a=[];$(this).parent().data("itemtype");$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".choicesOptions").val(b).change(),$("#fieldSettings_choices_null").is(":checked")&&a.unshift("Make A Selection");for(var c=$("#formPreview_"+globalFieldID),d=c.find($("#type_"+globalFieldID)).val(),e="",f=0;f<a.length;f++)"multiselect"==d||"select"==d?e+="<option value='"+a[f]+"'>"+a[f]+"</option>":"checkbox"==d?e+="<label for='checkbox'><input type='checkbox'/>"+a[f]+"</label>":"radio"==d&&(e+="<label for='checkbox'><input type='radio'/>"+a[f]+"</label>");if("multiselect"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}else if("checkbox"==d||"radio"==d){var g=c.find($(".controls"));g.find($("label")).remove(),g.append(e)}else if("select"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}}function extensionBinding(){var a=[];$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),
a[b]=value});var b=a.join("%,%");$(".allowedExtensions").val(b).change();var c=$("#fieldSettings_file_allowedExtensions").children().length;1>=c?$("#allowedExtensionsAlert").show():$("#allowedExtensionsAlert").hide(),1>c&&$(this).parent().after(addAllowedExtension())}function metadataBinding(){var a=[];$(this).parent().data("itemtype");$(this).parent().parent().find($("input[type=text]")).each(function(b){var c=$(this).prev("select").val();value=c+" : "+$(this).val(),a[b]=value});var b=a.join("%,%");$(".metadataStandard").val(b).change()}function titleField(){var a=$("#formSettings_objectTitleField"),b="";$("#formPreview").find($(":input[type=text]")).each(function(){var a=($(this).parent().parent().parent().next("div").find($("input[name^='label']")).val(),$(this).parent().parent().parent().next("div").find($("input[name^='name']")).val());"idno"===a||(b+="<option value='"+a+"'>"+a+"</option>")}),a.html(b)}function validateURL(a){var b=/^((https?|ftp):\/\/)?([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;return b.test(a)}function checkForSpaces(a){return/\s/g.test(a)}function removeHtml(a){return a.replace(/&/g,"&amp;").replace(/>/g,"").replace(/</g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"")}function isEmpty(a){return!a||0===a.length}function removeItemFromID(a,b){var c=b.selectedIndex;if(-1!=c){for(i=b.length-1;i>=0;i--)b.options[i].selected&&(b.options[i]=null);b.length>0&&(b.selectedIndex=0==c?0:c-1)}}function selectAllOnSubmit(a){var b=document.getElementById(a);if(null!=b)for(i=b.length-1;i>=0;i--)b.options[i].selected=!0}function entrySubmit(){return selectAllOnSubmit("selectedEntryUsers"),selectAllOnSubmit("selectedViewUsers"),selectAllOnSubmit("selectedUsersAdmins"),!0}function settingsBindings(){var a=$("#GroupingsPreview");$("#GroupingsPreview").on("click","li",function(b){b.stopPropagation(),$(this).hasClass("activeField well")||(a.find(".activeField").removeClass("activeField well"),$(this).addClass("activeField well"),showSettings($(this).prop("id")))}),$("#groupingsSettings_grouping").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val(),e=b.find(".groupingPreview"),f=e.find("i"),g=e.find("ul"),h=e.contents();h.slice(h.index(f)+1,h.index(g)).remove(),g.before(d),b.find("input[name^=nav_grouping_]").val(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_label").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").text(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_url").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").prop("href",d),$("#nav_url_"+c).val(d)})}function showSettings(a){if($("#groupingsSettings").children().hide(),$("#groupingTab a[href='#groupingsSettings']").tab("show"),void 0===a)$("#noGroupingSelected").show();else{var b=a.split("_")[1],c=$("#nav_type_"+b).val(),d=$("#nav_grouping_"+b);if("grouping"==c)$("#groupingsSettings_container_grouping").show(),$("#groupingsSettings_grouping").val(d.val()).keyup();else{switch(c){case"logout":case"link":$("#groupingsSettings_container_label").show(),$("#groupingsSettings_container_url").show();break;case"export":case"objectForm":case"metadataForm":$("#groupingsSettings_container_label").show()}if("objectForm"==c||"metadataForm"==c?$("#groupingsSettings_label").prop("disabled",!0):$("#groupingsSettings_label").removeAttr("disabled"),"grouping"!=c){var e=d.parents("li").parents("li");if(e.length>0){var f=e.prop("id").split("_")[1];d.val($("#nav_grouping_"+f).val())}else d.val("")}else $("#groupingsSettings_grouping").val(d.val());$("#groupingsSettings_label").val($("#nav_label_"+b).val()).keyup(),$("#groupingsSettings_url").val($("#nav_url_"+b).val()).keyup()}}}function addNew(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c={};$(a).data("type")&&(c.type=b=$(a).data("type"),c.label=$("a",a).text()),$(a).data("formid")&&(c.formID=$(a).data("formid"));var d=0;$("#GroupingsPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");d<=b[1]&&(d=parseInt(b[1])+1)}}),$(a).attr({id:"GroupingsPreview_"+d}).html('<div class="groupingPreview">'+newGroupingPreview(b,c)+'</div><div class="groupingValues">'+newGroupingValues(d,b,c)+"</div>"),$("#GroupingsPreview_"+d).click()}function newGroupingPreview(a,b){var c;return c='<i class="icon-remove"></i>',c+="New Grouping"==a||"grouping"==a?'<ul class="unstyled sortable"></ul>':void 0===b||null===b?'<a href="#">[Link]</a>':'<a href="'+(void 0!==b.url?b.url:"")+'">'+(void 0!==b.label?b.label:"Untitled")+"</a>"}function newGroupingValues(a,b,c){var d;switch(void 0===c&&(c={}),b){case"New Grouping":case"grouping":b=c.type="grouping";break;case"Log Out":case"logout":b=c.type="logout";break;case"Export Link":case"export":b=c.type="export";break;case"Link":case"link":b=c.type="link"}switch(d='<input type="hidden" id="nav_position_'+a+'" name="nav_position_'+a+'" value="'+(void 0!==c.position?c.position:"")+'">',d+='<input type="hidden" id="nav_type_'+a+'" name="nav_type_'+a+'" value="'+(void 0!==c.type?c.type:b)+'">',d+='<input type="hidden" id="nav_label_'+a+'" name="nav_label_'+a+'" value="'+(void 0!==c.label?c.label:"Untitled")+'">',d+='<input type="hidden" id="nav_url_'+a+'" name="nav_url_'+a+'" value="'+(void 0!==c.url?c.url:"")+'">',d+='<input type="hidden" id="nav_grouping_'+a+'" name="nav_grouping_'+a+'" value="'+(void 0!==c.grouping?c.grouping:"")+'">',b){case"objectForm":case"metadataForm":d+='<input type="hidden" id="nav_formID_'+a+'" name="nav_formID_'+a+'" value="'+(void 0!==c.formID?c.formID:"")+'">'}return d}function sortableNav(){$("#navigation ul.sortable").sortable({connectWith:"#navigation ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("New Grouping"==$(b.item).text()&&"GroupingsPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNew(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableNav()}})}function removeFormPreviewItem(a){if(confirm("Are you sure you want to remove this field?")){var b=a.parent().parent();"fieldset"==a.parent().next().children(":input[name^=type_]").val()&&b.after(a.next().find("li"));var c=$(".addFieldNav").parent();b.removeClass("well activeField").remove(),c.hasClass("active")||($(".addFieldNav").click().tab("show"),$("#formPreview li:first-child").trigger("click")),$("#formSettings_formMetadata").not(":checked")&&(0===$(":input[name^=type_][value=idno]",formPreview).length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}}function applyFormPreview(){var a;a="undefined"==typeof globalFieldID?$("#formPreview").children().find(".fieldPreview"):$("#formPreview_"+globalFieldID).find(".fieldPreview"),a.each(function(){var a=$(this).find(".fieldLabels"),b=$(this).find(".controls").children(),c=$(this).next(),d=c.find($('input[name^="placeholder"]')).val(),e=(c.find($('input[name^="type"]')).val(),c.find($('input[name^="name"]')).val()),f=(c.find($('input[name^="style"]')).val(),c.find($('input[name^="label"]')).val()),g=c.find($('input[name^="id"]')).val(),h=c.find($('input[name^="class"]')).val(),i=c.find($('input[name^="value"]')).val(),j=c.find($('input[name^="disabled"')).val(),k=c.find($('input[name^="readonly"')).val();c.find($('input[name^="hidden"]')).val(),c.find($('input[name^="choicesOptions"]')).val(),c.find($('input[name^="choicesType"]')).val(),b.attr({placeholder:d,name:e,id:g,"class":h}),b.val(i),"true"===j||"true"===k?(b.prop("readonly",!0).addClass("disabled"),b.prop("disabled",!0).addClass("disabled")):(b.prop("readonly",!1).removeClass("disabled"),b.prop("disabled",!1).removeClass("disabled")),i.length&&b.val(i),a.html(f)})}function sortableForm(){$("#formCreator ul.sortable").sortable({connectWith:"#formCreator ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("Field Set"==$(b.item).text()&&"formPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNewField(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableForm()}}),calculatePosition()}function calculatePosition(){$("#formCreator ul.sortable").children("li").each(function(a){$(this).attr("data-position",a),$(this).find("[data-bind='position']").val(a)})}function showFieldSettings(a){var b=$("#fieldSettings_form"),c=$("#fieldSettings_fieldset_form");if(void 0===a)$("#noFieldSelected").show(),c.hide(),b.hide();else{var d,e,f,g=a,h=$("#type_"+g).val(),i=$("#fieldset_"+g);if($("#noFieldSelected").hide(),"fieldset"==h)c.show(),b.hide();else{c.hide(),b.show(),b.find(".dataSettings").children().hide(),b.find(".default").show();var j=$("#fieldSettings_name"),k=$("#fieldSettings_options_required"),l=$("#fieldSettings_options_duplicates"),m=$("#fieldSettings_options_displayTable"),n=$("#fieldSettings_options_readonly"),o=$("#fieldSettings_options_disabled");switch("idno"==h?(j.prop("readonly",!0).val("idno").keyup(),k.prop({checked:!0,disabled:!0}).change(),l.prop({checked:!0,disabled:!0}).change(),m.prop({checked:!0,disabled:!0}).change(),n.prop({checked:!0,disabled:!0}).change(),o.prop({checked:!1,disabled:!0}).change()):"file"==h?m.removeAttr("checked").change().prop("disabled",!0):(j.removeAttr("readonly"),k.removeAttr("disabled"),l.removeAttr("disabled"),n.removeAttr("disabled"),o.removeAttr("disabled"),m.removeAttr("disabled")),h){case"idno":$("#fieldSettings_container_idno").parent().show();break;case"text":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_externalUpdate").parent().hide(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"textarea":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"radio":case"checkbox":case"select":case"multiselect":$("#fieldSettings_container_choices").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;case"number":$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().show(),$("#fieldSettings_range_format").parent().removeClass("span6").addClass("span4"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="value">Value</option><option value="digits">Digits</option>');break;case"wysiwyg":$("#fieldSettings_container_placeholder").hide(),$("#fieldSettings_container_value").hide();break;case"file":$("#fieldSettings_container_file_allowedExtensions").parent().show(),$("#fieldSettings_container_file_options").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;default:$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show()}var p=$("#choicesOptions_"+g).val();if(void 0!==p){var q=$("#fieldSettings_choices_manual");for(d=p.split("%,%"),e="",f=0;f<d.length;f++)e+=addChoice(d[f],$("#choicesDefault_"+g).val());q.html(e).find("input[name=fieldSettings_choices_text]").keyup()}var r=$("#allowedExtensions_"+g).val();if(void 0!==r){var s=$("#fieldSettings_file_allowedExtensions");for(d=r.split("%,%"),e="",s.html(""),f=0;f<d.length;f++)e+=addAllowedExtension(d[f]);s.append(e),s.find(":input[name=fieldSettings_allowedExtension_text]:first").keyup()}var t=$("#metadataStandard_"+g).val();if(void 0!==t){var u=$("#metadataStandard_options");for(d=t.split("%,%"),e="",u.html(""),f=0;f<d.length;f++)e+=addMetadataStandard(d[f]);u.append(e),$(".mdStandardSelect").each(function(){var a=$(this).data("selectvalue");$(this).val(a)})}if("fieldset"!=h){var v=i.parents("li").parents("li");if(v.length>0){var w=v.prop("id").split("_")[1];i.val($("#fieldset_"+w).val())}else i.val("")}else $("#fieldSettings_fieldset").val(i.val());-1!=$.inArray(h,["idno","text","textarea","date","time","wysiwyg"])?$("#fieldVariablesLink").show():$("#fieldVariablesLink").hide(),$("#fieldSettings_externalUpdate_formSelect").change(function(){var a=$(this).val();void 0===choicesFields[a]&&(choicesFields[a]="",$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var b=JSON.parse(a);$.each(b,function(a,b){var c="";$.each(b,function(a,b){c+='<option value="'+b.name+'">'+b.label+"</option>"}),choicesFields[a]=c})})),$("#externalUpdateForm_"+g).val(a).change(),$("#fieldSettings_externalUpdate_fieldSelect").html(choicesFields[a]).change()}),$(".uxOptions").find("input").change(function(){var a=$(this).data("bindmodel"),b=$("."+a);$(this).is(":checked")||$(this).value?b.show():b.hide()}),enableChoiceFunctionality()}}}function fieldSettingsBindings(){var a=$("#formPreview");a.children("li").removeClass("activeField"),$("#fieldSettings_form").find("[data-bindmodel]").bind("change keyup",bindToHiddenForm),a.on("click","li",function(b){if(b.stopPropagation(),$(b.target).is(".icon-remove"))console.log($(this)),removeFormPreviewItem($(b.target));else{var c=$(this).data("id");globalFieldID=c,a.find("[data-bind]").bind("change",setOriginalValues),$(this).hasClass("activeField")||(a.find(".activeField").removeClass("activeField"),$(this).addClass("activeField"),$("#fieldTab a[href='#fieldSettings']").tab("show"),showFieldSettings(c),setInitialBind(),applyFormPreview())}})}function setInitialBind(){var a=globalFieldID;if("undefined"!=typeof a){var b=$("#formPreview").find("[data-id='"+a+"']"),c=b.find(".fieldValues");c.find("[data-bind]").change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues)}}function setOriginalValues(){var a=globalFieldID,b=$(this).data("bind"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#fieldSettings_form").find("[data-bindmodel='"+b+"']"),e=$("#formPreview").find("[data-id='"+a+"']"),f=e.find(".fieldPreview");if("name"==b&&(c=$.trim(c),evaluateSpace(c,d)),"idnoFormat"==b&&(idnoValues.idnoFormat=c),"startIncrement"==b&&(idnoValues.startIncrement=c),"help"==b){console.log(c);var g=c.split("|")[0],h=c.split("|")[1].escapeHtml().sanitizeInput(),c="undefined"==h?"":h;$(this).val(g+"|"+h),$("#fieldSettings_help_textarea").val(c).hide(),$("#fieldSettings_help_url").hide().val(c),$("#fieldSettings_help_type").val(g).change()}d.is("input[type=checkbox]")?"true"==c?d.prop("checked",!0):d.prop("checked",!1):d.is("select")?d.find('option[value="'+c+'"]').prop("selected",!0):d.is("input[type=number]")?d.val(parseInt(c)):d.val(c),d.is($("#fieldSettings_choices_type"))&&("manual"==c?($("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide()):($("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show())),"managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"validation"==b&&("regexp"==c?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide()),"choicesForm"==b&&("null"==c||void 0==c?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error"))),"choicesDefault"==b&&$('input[value="'+c+'"]').prev().addClass("active"),"choicesField"==b&&($("#fieldSettings_choices_formSelect").change(),$("#fieldSettings_choices_fieldSelect").val(c).change())}function bindToHiddenForm(){var a=globalFieldID;if("undefined"!=typeof a){var b=$(this).data("bindmodel"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#formPreview").find("[data-id='"+a+"']"),e=($("#formPreview_"+a).find(".fieldLabels"),d.find(".fieldValues")),f=d.find(".fieldPreview");if(e.find("[data-bind='"+b+"']").val(c),"name"==b&&(evaluateSpace(c,$(this)),titleField()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"choicesType"==b)if("manual"==c)$("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide(),$("#choicesForm_"+a).val("");else{$("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show();var g=e.find($('input[name^="type"]')).val();"multiselect"==g?f.find(".controls").find($("select")).html():"checkbox"==g||"radio"==g?f.find(".controls").find($("label")).remove():"select"==g&&f.find($(".controls")).find($("select")).html(output)}if("managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"idnoFormat"==b||"startIncrement"==b||"idnoConfirm"==b){$("#fieldSettings_container_idno_confirm").removeClass("hidden").show();var h=$("#fieldSettings_idno_confirm").is(":checked");h===!1&&idnoValues.idnoFormat?$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled")}if("validation"==b){var i=$("#fieldSettings_validation").val();"regexp"===i?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide().val("")}if(("helpText"==b||"helpURL"==b)&&formatHelpForHiddenField(e),"helpType"==b){switch($(this).val()){case"text":case"html":$("#fieldSettings_help_textarea").show().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden");break;case"web":$("#fieldSettings_help_url").show().removeClass("hidden"),$("#fieldSettings_help_textarea").hide().removeClass("hidden");break;case"none":case"default":$("#fieldSettings_help_textarea").hide().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden")}formatHelpForHiddenField(e)}applyFormPreview()}}function formatHelpForHiddenField(a){var b,c=$("#fieldSettings_help_type").val(),d=globalFieldID;"text"==c||"html"==c?(b=$("#fieldSettings_help_textarea").val().sanitizeInput().escapeHtml(),console.log(b)):(b=$("#fieldSettings_help_url").val(),console.log(b),validateURL(b)?$("#fieldSettings_help_url").removeClass("has-error"):$("#fieldSettings_help_url").addClass("has-error"));var e=c+"|"+b;$("#fieldSettings_help_text").val(e),a.find("[data-bind='help']").val(e),$(".helpPreview").popover("destroy"),$(".helpPreview").hide(),"html"===c||"text"===c?($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help",content:"<div>"+b.unEscapeHtml()+"</div>",trigger:"click",html:!0})):"web"===c&&($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help Url",content:'<div><a href="'+b+'">'+b+"</a></div>",trigger:"click",html:!0}))}function evaluateSpace(a,b){checkForSpaces(a)?(b.addClass("has-error testy"),$(".noSpacesAlert").show(),$("input[type=submit]").addClass("disabled").attr("disabled",!0)):(b.removeClass("has-error"),$("input[type=submit]").removeClass("disabled").removeAttr("disabled"),$(".noSpacesAlert").hide())}function getFormFields(){var a="";return $.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(b){var c=JSON.parse(b);$.each(c,function(b,c){$.each(c,function(b,c){a+='<option value="'+c.name+'">'+c.label+"</option>"})})}),a}function evaluateCheck(a){return a.is(":checked")?!0:!1}function formSettingsBindings(){$("#formTitle").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formTitle").focus()}),$("#formSettings_formTitle").keyup(function(){$("#formTitle").html($(this).val()),0!==$(this).val().length?$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled")}).keyup(),$("#formDescription").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formDescription").focus()}),$("#formSettings_formDescription").keyup(function(){$("#formDescription").html($(this).val())}).keyup(),$("#formSettings_formMetadata").change(function(){var a=$("#fieldAdd"),b=$("#formPreview").find("input[name^=type_][value=idno]");$(this).is(":checked")?($("#formSettings_linkTitle_container").show(),0===b.length?($("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):confirm("Enabling this will remove any existing ID Number fields. Do you want to continue?")?(b.parent().parent().remove(),$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):$(this).removeAttr("checked")):($("#formSettings_linkTitle_container").hide(),a.find("li:contains('ID Number')").show(),a.find("li:contains('Paragraph Text')").show(),a.find("li:contains('Radio')").show(),a.find("li:contains('Checkboxes')").show(),a.find("li:contains('Dropdown')").show(),a.find("li:contains('Multi-Select')").show(),a.find("li:contains('File Upload')").show(),a.find("li:contains('WYSIWYG')").show(),a.find("li:contains('Field Set')").parent().show().prev().show(),0===b.length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}).change()}function modalBindings(){$("#formTypeSelector").modal({show:!1,keyboard:!1,backdrop:"static"}).on("click","button:contains('Metadata')",function(){$(".nav-tabs li:nth-child(3) a").click(),$("#formSettings_formMetadata").prop("checked",!0).change(),$("#formTypeSelector").modal("hide")}).on("click","button:contains('Object')",function(){var a=$("#fieldAdd"),b=($("#formPreview .well"),$("#fieldSettings_label")),c=$("#fieldSettings_options_sortable"),d=$("#fieldSettings_options_searchable");a.find("li:contains('ID Number')").click(),b.val("IDNO").keyup(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),a.find("li:contains('Single Line Text')").click(),$("#fieldSettings_name").val("title").keyup(),b.val("Title").keyup(),$("#fieldSettings_options_required").prop("checked",!0).change(),$("#fieldSettings_options_duplicates").prop("checked",!0).change(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),$("#fieldSettings_options_displayTable").prop("checked",!0).change(),$("#fieldTab li:last a").click(),$("#formPreview li").removeClass("activeField"),$("#formSettings_formMetadata").removeAttr("checked").change(),$("#formTypeSelector").modal("hide"),$("#formSettings_formTitle")})}function addNewField(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c=0;$("#formPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");c<=b[1]&&(c=parseInt(b[1])+1)}}),$(a).attr({id:"formPreview_"+c,"data-id":c}).html('<div class="fieldPreview">'+newFieldPreview(c,b)+'</div><div class="fieldValues">'+newFieldValues(c,b)+"</div>"),$("#formPreview_"+c).click(),$("#formSettings_formMetadata").not(":checked")&&(0===$("#formPreview").find("input[name^=type_][value=idno]").length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}function newFieldPreview(a,b,c){var d="";if(void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.choicesOptions="First Choice%,%Second Choice",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),("idno"!=b&&"ID Number"!=b||0!==numIDNOs)&&(d+='<i class="icon-remove"></i>'),d+='<span class="fa fa-question-circle helpPreview"></span>',"Field Set"==b||"fieldset"==b)d+='<fieldset><legend></legend><ul class="unstyled sortable"></ul></fieldset>';else{switch(d+='<div class="control-group"><label class="control-label fieldLabels">Untitled</label><div class="controls">',b){case"ID Number":case"idno":case"Single Line Text":case"text":d+='<input type="text">',numIDNOs++;break;case"Paragraph Text":case"textarea":d+="<textarea></textarea>";break;case"Radio":case"radio":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="radio" checked> '+b+"</label>":'<label> <input type="radio"> '+b+"</label>"})}else d+='<label class="radio"><input type="radio">First Choice</label><label class="radio"><input type="radio">Second Choice</label>';break;case"Checkboxes":case"checkbox":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="checkbox" checked> '+b+"</label>":'<label> <input type="checkbox"> '+b+"</label>"})}else d+='<label class="checkbox"><input type="checkbox">First Choice</label><label class="checkbox"><input type="checkbox">Second Choice</label>';break;case"Dropdown":case"select":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+="<select>",$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+="<select></select>";break;case"Number":case"number":d+='<input type="number">';break;case"Email":case"email":d+='<input type="email">';break;case"Phone":case"tel":d+='<input type="tel">';break;case"Date":case"date":d+='<input type="date">';break;case"Time":case"time":d+='<input type="time">';break;case"Website":case"url":d+='<input type="url">';break;case"Multi-Select":case"multiselect":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+='<select multiple></select><br><select class="selectPreview">',$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+='<select multiple></select><br><select class="selectPreview"></select>';break;case"WYSIWYG":case"wysiwyg":d+='<img src="../includes/img/wysiwyg.png">';break;case"File Upload":case"file":d+='<input type="file" disabled>'}d+="</div></div>"}return d}function newFieldValues(a,b,c){var d="";void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),c.type=determineType(b),b=c.type;var e=["name","position","type","label","value","placeholder","id","class","style","help","helpType","required","duplicates","readonly","disabled","disabledInsert","disabledUpdate","publicRelease","sortable","searchable","displayTable","hidden","validation","validationRegex","access","fieldset","metadataStandard"];switch(d+=createHiddenFields(e,a,c),b){case"idno":var f=["managedBy","idnoFormat"];d+=createHiddenFields(f,a,c),d+='<input type="hidden" id="startIncrement_'+a+'" name="startIncrement_'+a+'"   data-bind="startIncrement"    value="'+(void 0!==c.startIncrement?c.startIncrement:"1")+'">',d+='<input type="hidden" id="idnoConfirm_'+a+'"    name="idnoConfirm_'+a+'"      data-bind"idnoConfirm"        value="false">';break;case"text":var g=["externalUpdateForm","externalUpdateField","min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"textarea":case"number":var g=["min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"radio":case"checkbox":case"select":case"multiselect":var h=["choicesType","choicesNull","choicesDefault","choicesForm","choicesField","choicesFieldDefault"];d+=createHiddenFields(h,a,c),d+='<input type="hidden" id="choicesOptions_'+a+'" name="choicesOptions_'+a+'" data-bind="choicesOptions" value="'+(void 0!==c.choicesOptions?c.choicesOptions:"First Choice%,%Second Choice")+'">';break;case"file":var i=["bgProcessing","multipleFiles","combine","ocr","convert","convertHeight","convertWidth","watermark","watermarkImage","watermarkLocation","border","borderHeight","borderWidth","borderColor","thumbnail","convertAudio","bitRate","audioFormat","convertVideo","videoHeight","videoWidth","videobitRate","aspectRatio","videoFormat","videothumbnail","videoThumbFrames","videoThumbHeight","videoThumbWidth","videoFormatThumb"];d+=createHiddenFields(i,a,c),d+='<input type="hidden" id="allowedExtensions_'+a+'" name="allowedExtensions_'+a+'"     data-bind="allowedExtensions"    value="'+(void 0!==c.allowedExtensions?c.allowedExtensions:"tif%,%tiff%,%jpg")+'">',d+='<input type="hidden" id="convertResolution_'+a+'" name="convertResolution_'+a+'"     data-bind="convertResolution"    value="'+(void 0!==c.convertResolution?c.convertResolution:"192")+'">',d+='<input type="hidden" id="convertFormat_'+a+'"     name="convertFormat_'+a+'"         data-bind="convertFormat"        value="'+(void 0!==c.convertFormat?c.convertFormat:"JPG")+'">',d+='<input type="hidden" id="thumbnailHeight_'+a+'"   name="thumbnailHeight_'+a+'"       data-bind="thumbnailHeight"      value="'+(void 0!==c.thumbnailHeight?c.thumbnailHeight:"150")+'">',d+='<input type="hidden" id="thumbnailWidth_'+a+'"    name="thumbnailWidth_'+a+'"        data-bind="thumbnailWidth"       value="'+(void 0!==c.thumbnailWidth?c.thumbnailWidth:"150")+'">',d+='<input type="hidden" id="thumbnailFormat_'+a+'"   name="thumbnailFormat_'+a+'"       data-bind="thumbnailFormat"      value="'+(void 0!==c.thumbnailFormat?c.thumbnailFormat:"JPG")+'">',d+='<input type="hidden" id="help_'+a+'"   name="help_'+a+'"       data-bind="help"      value="'+(void 0!==c.help?c.help:"none|")+'">'}return d}function determineValidation(a){switch(a){case"Number":case"number":return"integer";case"Email":case"email":return"emailAddr";case"Phone":case"tel":return"phoneNumber";case"Date":case"date":return"date";case"Website":case"url":return"url";default:return}}function determineType(a){switch(a){case"ID Number":case"idno":return"idno";case"Single Line Text":case"text":return"text";case"Paragraph Text":case"textarea":return"textarea";case"Radio":case"radio":return"radio";case"Checkboxes":case"checkbox":return"checkbox";case"Dropdown":case"select":return"select";case"Number":case"number":return"number";case"Email":case"email":return"email";case"Phone":case"tel":return"tel";case"Date":case"date":return"date";
case"Time":case"time":return"time";case"Website":case"url":return"url";case"Multi-Select":case"multiselect":return"multiselect";case"WYSIWYG":case"wysiwyg":return"wysiwyg";case"File Upload":case"file":return"file";case"Field Set":case"fieldset":return"fieldset";default:return}}function createHiddenFields(a,b,c){return output="",$.each(a,function(a,d){var e=d+"_"+b,f=void 0!==c[d]?c[d]:"";output+='<input type="hidden" id="'+e+'" name="'+e+'" data-bind="'+d+'" value="'+f+'"/>'}),output}function addChoice(a,b){return"undefined"==typeof a?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':"undefined"==typeof b?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn'+(a==b?" active":"")+'" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>'}function addAllowedExtension(a){return"undefined"==typeof a&&(a=""),'<div class="row-fluid input-append extensionItem" data-itemtype="extension"><input name="fieldSettings_allowedExtension_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add an extension."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this extension."><i class="icon-remove"></i></button></div>'}function addMetadataStandard(a){"undefined"==typeof a&&(a="");var b=metadataSchema,c=a.split(" : ")[1],d=a.split(" : ")[0];"undefined"==typeof c&&(c=""),"undefined"==typeof d&&(d="");var e='<select class="input-block-level form-control mdStandardSelect" id="fieldSettings_standardType" name="fieldSettings_standardType" data-selectvalue="'+d+'"><option value=""> None </option>'+b+"</select>";return'<div class="row-fluid input-append metadata-item" data-itemtype="metadataStandard">'+e+'<input name="fieldSettings_metadataIdentifer" type="text" value="'+c+'"><button name="add" class="btn" type="button" title="Add Metadata Standard"><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove Metadata Standard"><i class="icon-remove"></i></button></div>'}function enableChoiceFunctionality(){$(".choicesItem").find($("input[type=text], select")).bind("change keyup",modifyChoiceBinding).change(),$(".extensionItem").find($("input[type=text], select")).bind("change keyup",extensionBinding).change(),$(".metadata-item").find($("input[type=text], select")).bind("change keyup",metadataBinding).change(),$("#fieldSettings_choices_null").change(function(){$(".input-append").find("input[type=text]").change()}),$(".input-append").find("button").click(function(){var a=$(this).attr("name"),b=$(this).parent().data("itemtype");if("add"==a)"choice"==b?$(this).parent().after(addChoice()):"extension"==b?$(this).parent().after(addAllowedExtension()):$(this).parent().after(addMetadataStandard()),$(".input-append").find("button").unbind("click"),enableChoiceFunctionality();else if("remove"==a)$(this).parent().remove(),$(".input-append").find($("input[type=text]")).change();else if("default"==a){var c=$(this).next().val(),d=globalFieldID;$("#choicesDefault_"+d).val(c),$('button[name="default"]').removeClass("active"),$(this).hasClass("focus")&&$(this).addClass("selected")}}),$("#fieldSettings_choices_formSelect").change(function(){var a=$(this).val();if("null"==a?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error")),void 0===choicesFields[a]){var b;choicesFields[null]=b,$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var c=JSON.parse(a);$.each(c,function(a,c){b="<option value> Select A Field</option>",$.each(c,function(a,c){b+='<option value="'+c.name+'">'+c.label+"</option>"}),choicesFields[a]=b})})}$("#fieldSettings_choices_fieldSelect").html(choicesFields[a])})}function modifyChoiceBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".choicesOptions").val(b).change(),$("#fieldSettings_choices_null").is(":checked")&&a.unshift("Make A Selection");for(var c=$("#formPreview_"+globalFieldID),d=c.find($("#type_"+globalFieldID)).val(),e="",f=0;f<a.length;f++)"multiselect"==d||"select"==d?e+="<option value='"+a[f]+"'>"+a[f]+"</option>":"checkbox"==d?e+="<label for='checkbox'><input type='checkbox'/>"+a[f]+"</label>":"radio"==d&&(e+="<label for='checkbox'><input type='radio'/>"+a[f]+"</label>");if("multiselect"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}else if("checkbox"==d||"radio"==d){var g=c.find($(".controls"));g.find($("label")).remove(),g.append(e)}else if("select"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}}function extensionBinding(){var a=[];$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".allowedExtensions").val(b).change();var c=$("#fieldSettings_file_allowedExtensions").children().length;1>=c?$("#allowedExtensionsAlert").show():$("#allowedExtensionsAlert").hide(),1>c&&$(this).parent().after(addAllowedExtension())}function metadataBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){var c=$(this).prev("select").val();value=c+" : "+$(this).val(),a[b]=value});var b=a.join("%,%");$(".metadataStandard").val(b).change()}function titleField(){var a=$("#formSettings_objectTitleField"),b="";$("#formPreview").find($(":input[type=text]")).each(function(){var a=($(this).parent().parent().parent().next("div").find($("input[name^='label']")).val(),$(this).parent().parent().parent().next("div").find($("input[name^='name']")).val());"idno"===a||(b+="<option value='"+a+"'>"+a+"</option>")}),a.html(b)}function validateURL(a){var b=/^((https?|ftp):\/\/)?([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;return b.test(a)}function checkForSpaces(a){return/\s/g.test(a)}function removeHtml(a){return a.replace(/&/g,"&amp;").replace(/>/g,"").replace(/</g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"")}function isEmpty(a){return!a||0===a.length}function removeItemFromID(a,b){var c=b.selectedIndex;if(-1!=c){for(i=b.length-1;i>=0;i--)b.options[i].selected&&(b.options[i]=null);b.length>0&&(b.selectedIndex=0==c?0:c-1)}}function selectAllOnSubmit(a){var b=document.getElementById(a);if(null!=b)for(i=b.length-1;i>=0;i--)b.options[i].selected=!0}function entrySubmit(){return selectAllOnSubmit("selectedEntryUsers"),selectAllOnSubmit("selectedViewUsers"),selectAllOnSubmit("selectedUsersAdmins"),!0}function settingsBindings(){var a=$("#GroupingsPreview");$("#GroupingsPreview").on("click","li",function(b){b.stopPropagation(),$(this).hasClass("activeField well")||(a.find(".activeField").removeClass("activeField well"),$(this).addClass("activeField well"),showSettings($(this).prop("id")))}),$("#groupingsSettings_grouping").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val(),e=b.find(".groupingPreview"),f=e.find("i"),g=e.find("ul"),h=e.contents();h.slice(h.index(f)+1,h.index(g)).remove(),g.before(d),b.find("input[name^=nav_grouping_]").val(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_label").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").text(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_url").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").prop("href",d),$("#nav_url_"+c).val(d)})}function showSettings(a){if($("#groupingsSettings").children().hide(),$("#groupingTab a[href='#groupingsSettings']").tab("show"),void 0===a)$("#noGroupingSelected").show();else{var b=a.split("_")[1],c=$("#nav_type_"+b).val(),d=$("#nav_grouping_"+b);if("grouping"==c)$("#groupingsSettings_container_grouping").show(),$("#groupingsSettings_grouping").val(d.val()).keyup();else{switch(c){case"logout":case"link":$("#groupingsSettings_container_label").show(),$("#groupingsSettings_container_url").show();break;case"export":case"objectForm":case"metadataForm":$("#groupingsSettings_container_label").show()}if("objectForm"==c||"metadataForm"==c?$("#groupingsSettings_label").prop("disabled",!0):$("#groupingsSettings_label").removeAttr("disabled"),"grouping"!=c){var e=d.parents("li").parents("li");if(e.length>0){var f=e.prop("id").split("_")[1];d.val($("#nav_grouping_"+f).val())}else d.val("")}else $("#groupingsSettings_grouping").val(d.val());$("#groupingsSettings_label").val($("#nav_label_"+b).val()).keyup(),$("#groupingsSettings_url").val($("#nav_url_"+b).val()).keyup()}}}function addNew(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c={};$(a).data("type")&&(c.type=b=$(a).data("type"),c.label=$("a",a).text()),$(a).data("formid")&&(c.formID=$(a).data("formid"));var d=0;$("#GroupingsPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");d<=b[1]&&(d=parseInt(b[1])+1)}}),$(a).attr({id:"GroupingsPreview_"+d}).html('<div class="groupingPreview">'+newGroupingPreview(b,c)+'</div><div class="groupingValues">'+newGroupingValues(d,b,c)+"</div>"),$("#GroupingsPreview_"+d).click()}function newGroupingPreview(a,b){var c;return c='<i class="icon-remove"></i>',c+="New Grouping"==a||"grouping"==a?'<ul class="unstyled sortable"></ul>':void 0===b||null===b?'<a href="#">[Link]</a>':'<a href="'+(void 0!==b.url?b.url:"")+'">'+(void 0!==b.label?b.label:"Untitled")+"</a>"}function newGroupingValues(a,b,c){var d;switch(void 0===c&&(c={}),b){case"New Grouping":case"grouping":b=c.type="grouping";break;case"Log Out":case"logout":b=c.type="logout";break;case"Export Link":case"export":b=c.type="export";break;case"Link":case"link":b=c.type="link"}switch(d='<input type="hidden" id="nav_position_'+a+'" name="nav_position_'+a+'" value="'+(void 0!==c.position?c.position:"")+'">',d+='<input type="hidden" id="nav_type_'+a+'" name="nav_type_'+a+'" value="'+(void 0!==c.type?c.type:b)+'">',d+='<input type="hidden" id="nav_label_'+a+'" name="nav_label_'+a+'" value="'+(void 0!==c.label?c.label:"Untitled")+'">',d+='<input type="hidden" id="nav_url_'+a+'" name="nav_url_'+a+'" value="'+(void 0!==c.url?c.url:"")+'">',d+='<input type="hidden" id="nav_grouping_'+a+'" name="nav_grouping_'+a+'" value="'+(void 0!==c.grouping?c.grouping:"")+'">',b){case"objectForm":case"metadataForm":d+='<input type="hidden" id="nav_formID_'+a+'" name="nav_formID_'+a+'" value="'+(void 0!==c.formID?c.formID:"")+'">'}return d}function sortableNav(){$("#navigation ul.sortable").sortable({connectWith:"#navigation ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("New Grouping"==$(b.item).text()&&"GroupingsPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNew(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableNav()}})}function removeFormPreviewItem(a){if(confirm("Are you sure you want to remove this field?")){var b=a.parent().parent();"fieldset"==a.parent().next().children(":input[name^=type_]").val()&&b.after(a.next().find("li"));var c=$(".addFieldNav").parent();b.removeClass("well activeField").remove(),c.hasClass("active")||($(".addFieldNav").click().tab("show"),$("#formPreview li:first-child").trigger("click")),$("#formSettings_formMetadata").not(":checked")&&(0===$(":input[name^=type_][value=idno]",formPreview).length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}}function applyFormPreview(){var a;a="undefined"==typeof globalFieldID?$("#formPreview").children().find(".fieldPreview"):$("#formPreview_"+globalFieldID).find(".fieldPreview"),a.each(function(){var a=$(this).find(".fieldLabels"),b=$(this).find(".controls").children(),c=$(this).next(),d=c.find($('input[name^="placeholder"]')).val(),e=(c.find($('input[name^="type"]')).val(),c.find($('input[name^="name"]')).val()),f=(c.find($('input[name^="style"]')).val(),c.find($('input[name^="label"]')).val()),g=c.find($('input[name^="id"]')).val(),h=c.find($('input[name^="class"]')).val(),i=c.find($('input[name^="value"]')).val(),j=c.find($('input[name^="disabled"')).val(),k=c.find($('input[name^="readonly"')).val();c.find($('input[name^="hidden"]')).val(),c.find($('input[name^="choicesOptions"]')).val(),c.find($('input[name^="choicesType"]')).val(),b.attr({placeholder:d,name:e,id:g,"class":h}),b.val(i),"true"===j||"true"===k?(b.prop("readonly",!0).addClass("disabled"),b.prop("disabled",!0).addClass("disabled")):(b.prop("readonly",!1).removeClass("disabled"),b.prop("disabled",!1).removeClass("disabled")),i.length&&b.val(i),a.html(f)})}function sortableForm(){$("#formCreator ul.sortable").sortable({connectWith:"#formCreator ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("Field Set"==$(b.item).text()&&"formPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNewField(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableForm()}}),calculatePosition()}function calculatePosition(){$("#formCreator ul.sortable").children("li").each(function(a){$(this).attr("data-position",a),$(this).find("[data-bind='position']").val(a)})}function showFieldSettings(a){var b=$("#fieldSettings_form"),c=$("#fieldSettings_fieldset_form");if(void 0===a)$("#noFieldSelected").show(),c.hide(),b.hide();else{var d,e,f,g=a,h=$("#type_"+g).val(),i=$("#fieldset_"+g);if($("#noFieldSelected").hide(),"fieldset"==h)c.show(),b.hide();else{c.hide(),b.show(),b.find(".dataSettings").children().hide(),b.find(".default").show();var j=$("#fieldSettings_name"),k=$("#fieldSettings_options_required"),l=$("#fieldSettings_options_duplicates"),m=$("#fieldSettings_options_displayTable"),n=$("#fieldSettings_options_readonly"),o=$("#fieldSettings_options_disabled");switch("idno"==h?(j.prop("readonly",!0).val("idno").keyup(),k.prop({checked:!0,disabled:!0}).change(),l.prop({checked:!0,disabled:!0}).change(),m.prop({checked:!0,disabled:!0}).change(),n.prop({checked:!0,disabled:!0}).change(),o.prop({checked:!1,disabled:!0}).change()):"file"==h?m.removeAttr("checked").change().prop("disabled",!0):(j.removeAttr("readonly"),k.removeAttr("disabled"),l.removeAttr("disabled"),n.removeAttr("disabled"),o.removeAttr("disabled"),m.removeAttr("disabled")),h){case"idno":$("#fieldSettings_container_idno").parent().show();break;case"text":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_externalUpdate").parent().hide(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"textarea":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"radio":case"checkbox":case"select":case"multiselect":$("#fieldSettings_container_choices").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;case"number":$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().show(),$("#fieldSettings_range_format").parent().removeClass("span6").addClass("span4"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="value">Value</option><option value="digits">Digits</option>');break;case"wysiwyg":$("#fieldSettings_container_placeholder").hide(),$("#fieldSettings_container_value").hide();break;case"file":$("#fieldSettings_container_file_allowedExtensions").parent().show(),$("#fieldSettings_container_file_options").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;default:$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show()}var p=$("#choicesOptions_"+g).val();if(void 0!==p){var q=$("#fieldSettings_choices_manual");for(d=p.split("%,%"),e="",f=0;f<d.length;f++)e+=addChoice(d[f],$("#choicesDefault_"+g).val());q.html(e).find("input[name=fieldSettings_choices_text]").keyup()}var r=$("#allowedExtensions_"+g).val();if(void 0!==r){var s=$("#fieldSettings_file_allowedExtensions");for(d=r.split("%,%"),e="",s.html(""),f=0;f<d.length;f++)e+=addAllowedExtension(d[f]);s.append(e),s.find(":input[name=fieldSettings_allowedExtension_text]:first").keyup()}var t=$("#metadataStandard_"+g).val();if(void 0!==t){var u=$("#metadataStandard_options");for(d=t.split("%,%"),e="",u.html(""),f=0;f<d.length;f++)e+=addMetadataStandard(d[f]);u.append(e),$(".mdStandardSelect").each(function(){var a=$(this).data("selectvalue");$(this).val(a)})}if("fieldset"!=h){var v=i.parents("li").parents("li");if(v.length>0){var w=v.prop("id").split("_")[1];i.val($("#fieldset_"+w).val())}else i.val("")}else $("#fieldSettings_fieldset").val(i.val());-1!=$.inArray(h,["idno","text","textarea","date","time","wysiwyg"])?$("#fieldVariablesLink").show():$("#fieldVariablesLink").hide(),$("#fieldSettings_externalUpdate_formSelect").change(function(){var a=$(this).val();void 0===choicesFields[a]&&(choicesFields[a]="",$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var b=JSON.parse(a);$.each(b,function(a,b){var c="";$.each(b,function(a,b){c+='<option value="'+b.name+'">'+b.label+"</option>"}),choicesFields[a]=c})})),$("#externalUpdateForm_"+g).val(a).change(),$("#fieldSettings_externalUpdate_fieldSelect").html(choicesFields[a]).change()}),$(".uxOptions").find("input").change(function(){var a=$(this).data("bindmodel"),b=$("."+a);$(this).is(":checked")||$(this).value?b.show():b.hide()}),enableChoiceFunctionality()}}}function fieldSettingsBindings(){var a=$("#formPreview");a.children("li").removeClass("activeField"),$("#fieldSettings_form").find("[data-bindmodel]").bind("change keyup",bindToHiddenForm),a.on("click","li",function(b){if(b.stopPropagation(),$(b.target).is(".icon-remove"))console.log($(this)),removeFormPreviewItem($(b.target));else{var c=$(this).data("id");globalFieldID=c,a.find("[data-bind]").bind("change",setOriginalValues),$(this).hasClass("activeField")||(a.find(".activeField").removeClass("activeField"),$(this).addClass("activeField"),$("#fieldTab a[href='#fieldSettings']").tab("show"),showFieldSettings(c),setInitialBind(),applyFormPreview())}})}function setInitialBind(){var a=globalFieldID;if("undefined"!=typeof a){var b=$("#formPreview").find("[data-id='"+a+"']"),c=b.find(".fieldValues");c.find("[data-bind]").change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues)}}function setOriginalValues(){var a=globalFieldID,b=$(this).data("bind"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#fieldSettings_form").find("[data-bindmodel='"+b+"']"),e=$("#formPreview").find("[data-id='"+a+"']"),f=e.find(".fieldPreview");if("name"==b&&(c=$.trim(c),evaluateSpace(c,d)),"idnoFormat"==b&&(idnoValues.idnoFormat=c),"startIncrement"==b&&(idnoValues.startIncrement=c),"help"==b){console.log("value");var g=c.split("|")[0],h=c.split("|")[1],c="undefined"==h?"":h;$(this).val(g+"|"+h),$("#fieldSettings_help_textarea").val(c).hide(),$("#fieldSettings_help_url").hide().val(c),$("#fieldSettings_help_type").val(g).change()}d.is("input[type=checkbox]")?"true"==c?d.prop("checked",!0):d.prop("checked",!1):d.is("select")?d.find('option[value="'+c+'"]').prop("selected",!0):d.is("input[type=number]")?d.val(parseInt(c)):d.val(c),d.is($("#fieldSettings_choices_type"))&&("manual"==c?($("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide()):($("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show())),"managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"validation"==b&&("regexp"==c?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide()),"choicesForm"==b&&("null"==c||void 0==c?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error"))),"choicesDefault"==b&&$('input[value="'+c+'"]').prev().addClass("active"),"choicesField"==b&&($("#fieldSettings_choices_formSelect").change(),$("#fieldSettings_choices_fieldSelect").val(c).change())}function bindToHiddenForm(){var a=globalFieldID;if("undefined"!=typeof a){var b=$(this).data("bindmodel"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#formPreview").find("[data-id='"+a+"']"),e=($("#formPreview_"+a).find(".fieldLabels"),d.find(".fieldValues")),f=d.find(".fieldPreview");if(e.find("[data-bind='"+b+"']").val(c),"name"==b&&(evaluateSpace(c,$(this)),titleField()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"choicesType"==b)if("manual"==c)$("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide(),$("#choicesForm_"+a).val("");else{$("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show();var g=e.find($('input[name^="type"]')).val();"multiselect"==g?f.find(".controls").find($("select")).html():"checkbox"==g||"radio"==g?f.find(".controls").find($("label")).remove():"select"==g&&f.find($(".controls")).find($("select")).html(output)}if("managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"idnoFormat"==b||"startIncrement"==b||"idnoConfirm"==b){$("#fieldSettings_container_idno_confirm").removeClass("hidden").show();var h=$("#fieldSettings_idno_confirm").is(":checked");h===!1&&idnoValues.idnoFormat?$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled")}if("validation"==b){var i=$("#fieldSettings_validation").val();"regexp"===i?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide().val("")}if(("helpText"==b||"helpURL"==b)&&formatHelpForHiddenField(e),"helpType"==b){switch($(this).val()){case"text":case"html":$("#fieldSettings_help_textarea").show().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden");break;case"web":$("#fieldSettings_help_url").show().removeClass("hidden"),$("#fieldSettings_help_textarea").hide().removeClass("hidden");break;case"none":case"default":$("#fieldSettings_help_textarea").hide().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden")}formatHelpForHiddenField(e)}applyFormPreview()}}function formatHelpForHiddenField(a){var b,c=$("#fieldSettings_help_type").val(),d=globalFieldID;"text"==c||"html"==c?(b=$("#fieldSettings_help_textarea").val().sanitizeInput().escapeHtml(),console.log(b)):(b=$("#fieldSettings_help_url").val(),console.log(b),validateURL(b)?$("#fieldSettings_help_url").removeClass("has-error"):$("#fieldSettings_help_url").addClass("has-error"));var e=c+"|"+b;$("#fieldSettings_help_text").val(e),a.find("[data-bind='help']").val(e),$(".helpPreview").popover("destroy"),$(".helpPreview").hide(),"html"===c||"text"===c?($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help",content:"<div>"+b.unEscapeHtml()+"</div>",trigger:"click",html:!0})):"web"===c&&($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help Url",content:'<div><a href="'+b+'">'+b+"</a></div>",trigger:"click",html:!0}))}function evaluateSpace(a,b){checkForSpaces(a)?(b.addClass("has-error testy"),$(".noSpacesAlert").show(),$("input[type=submit]").addClass("disabled").attr("disabled",!0)):(b.removeClass("has-error"),$("input[type=submit]").removeClass("disabled").removeAttr("disabled"),$(".noSpacesAlert").hide())}function getFormFields(){var a="";return $.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(b){var c=JSON.parse(b);$.each(c,function(b,c){$.each(c,function(b,c){a+='<option value="'+c.name+'">'+c.label+"</option>"})})}),a}function evaluateCheck(a){return a.is(":checked")?!0:!1}function formSettingsBindings(){$("#formTitle").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formTitle").focus()}),$("#formSettings_formTitle").keyup(function(){$("#formTitle").html($(this).val()),0!==$(this).val().length?$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled")}).keyup(),$("#formDescription").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formDescription").focus()}),$("#formSettings_formDescription").keyup(function(){$("#formDescription").html($(this).val())}).keyup(),$("#formSettings_formMetadata").change(function(){var a=$("#fieldAdd"),b=$("#formPreview").find("input[name^=type_][value=idno]");$(this).is(":checked")?($("#formSettings_linkTitle_container").show(),0===b.length?($("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):confirm("Enabling this will remove any existing ID Number fields. Do you want to continue?")?(b.parent().parent().remove(),$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):$(this).removeAttr("checked")):($("#formSettings_linkTitle_container").hide(),a.find("li:contains('ID Number')").show(),a.find("li:contains('Paragraph Text')").show(),a.find("li:contains('Radio')").show(),a.find("li:contains('Checkboxes')").show(),a.find("li:contains('Dropdown')").show(),a.find("li:contains('Multi-Select')").show(),a.find("li:contains('File Upload')").show(),a.find("li:contains('WYSIWYG')").show(),a.find("li:contains('Field Set')").parent().show().prev().show(),0===b.length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}).change()}function modalBindings(){$("#formTypeSelector").modal({show:!1,keyboard:!1,backdrop:"static"}).on("click","button:contains('Metadata')",function(){$(".nav-tabs li:nth-child(3) a").click(),$("#formSettings_formMetadata").prop("checked",!0).change(),$("#formTypeSelector").modal("hide")}).on("click","button:contains('Object')",function(){var a=$("#fieldAdd"),b=($("#formPreview .well"),$("#fieldSettings_label")),c=$("#fieldSettings_options_sortable"),d=$("#fieldSettings_options_searchable");a.find("li:contains('ID Number')").click(),b.val("IDNO").keyup(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),a.find("li:contains('Single Line Text')").click(),$("#fieldSettings_name").val("title").keyup(),b.val("Title").keyup(),$("#fieldSettings_options_required").prop("checked",!0).change(),$("#fieldSettings_options_duplicates").prop("checked",!0).change(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),$("#fieldSettings_options_displayTable").prop("checked",!0).change(),$("#fieldTab li:last a").click(),$("#formPreview li").removeClass("activeField"),$("#formSettings_formMetadata").removeAttr("checked").change(),$("#formTypeSelector").modal("hide"),$("#formSettings_formTitle")})}function addNewField(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c=0;$("#formPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");c<=b[1]&&(c=parseInt(b[1])+1)}}),$(a).attr({id:"formPreview_"+c,"data-id":c}).html('<div class="fieldPreview">'+newFieldPreview(c,b)+'</div><div class="fieldValues">'+newFieldValues(c,b)+"</div>"),$("#formPreview_"+c).click(),$("#formSettings_formMetadata").not(":checked")&&(0===$("#formPreview").find("input[name^=type_][value=idno]").length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}function newFieldPreview(a,b,c){var d="";if(void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.choicesOptions="First Choice%,%Second Choice",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),("idno"!=b&&"ID Number"!=b||0!==numIDNOs)&&(d+='<i class="icon-remove"></i>'),d+='<span class="fa fa-question-circle helpPreview"></span>',"Field Set"==b||"fieldset"==b)d+='<fieldset><legend></legend><ul class="unstyled sortable"></ul></fieldset>';else{switch(d+='<div class="control-group"><label class="control-label fieldLabels">Untitled</label><div class="controls">',b){case"ID Number":
case"idno":case"Single Line Text":case"text":d+='<input type="text">',numIDNOs++;break;case"Paragraph Text":case"textarea":d+="<textarea></textarea>";break;case"Radio":case"radio":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="radio" checked> '+b+"</label>":'<label> <input type="radio"> '+b+"</label>"})}else d+='<label class="radio"><input type="radio">First Choice</label><label class="radio"><input type="radio">Second Choice</label>';break;case"Checkboxes":case"checkbox":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="checkbox" checked> '+b+"</label>":'<label> <input type="checkbox"> '+b+"</label>"})}else d+='<label class="checkbox"><input type="checkbox">First Choice</label><label class="checkbox"><input type="checkbox">Second Choice</label>';break;case"Dropdown":case"select":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+="<select>",$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+="<select></select>";break;case"Number":case"number":d+='<input type="number">';break;case"Email":case"email":d+='<input type="email">';break;case"Phone":case"tel":d+='<input type="tel">';break;case"Date":case"date":d+='<input type="date">';break;case"Time":case"time":d+='<input type="time">';break;case"Website":case"url":d+='<input type="url">';break;case"Multi-Select":case"multiselect":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+='<select multiple></select><br><select class="selectPreview">',$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+='<select multiple></select><br><select class="selectPreview"></select>';break;case"WYSIWYG":case"wysiwyg":d+='<img src="../includes/img/wysiwyg.png">';break;case"File Upload":case"file":d+='<input type="file" disabled>'}d+="</div></div>"}return d}function newFieldValues(a,b,c){var d="";void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),c.type=determineType(b),b=c.type;var e=["name","position","type","label","value","placeholder","id","class","style","help","helpType","required","duplicates","readonly","disabled","disabledInsert","disabledUpdate","publicRelease","sortable","searchable","displayTable","hidden","validation","validationRegex","access","fieldset","metadataStandard"];switch(d+=createHiddenFields(e,a,c),b){case"idno":var f=["managedBy","idnoFormat"];d+=createHiddenFields(f,a,c),d+='<input type="hidden" id="startIncrement_'+a+'" name="startIncrement_'+a+'"   data-bind="startIncrement"    value="'+(void 0!==c.startIncrement?c.startIncrement:"1")+'">',d+='<input type="hidden" id="idnoConfirm_'+a+'"    name="idnoConfirm_'+a+'"      data-bind"idnoConfirm"        value="false">';break;case"text":var g=["externalUpdateForm","externalUpdateField","min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"textarea":case"number":var g=["min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"radio":case"checkbox":case"select":case"multiselect":var h=["choicesType","choicesNull","choicesDefault","choicesForm","choicesField","choicesFieldDefault"];d+=createHiddenFields(h,a,c),d+='<input type="hidden" id="choicesOptions_'+a+'" name="choicesOptions_'+a+'" data-bind="choicesOptions" value="'+(void 0!==c.choicesOptions?c.choicesOptions:"First Choice%,%Second Choice")+'">';break;case"file":var i=["bgProcessing","multipleFiles","combine","ocr","convert","convertHeight","convertWidth","watermark","watermarkImage","watermarkLocation","border","borderHeight","borderWidth","borderColor","thumbnail","convertAudio","bitRate","audioFormat","convertVideo","videoHeight","videoWidth","videobitRate","aspectRatio","videoFormat","videothumbnail","videoThumbFrames","videoThumbHeight","videoThumbWidth","videoFormatThumb"];d+=createHiddenFields(i,a,c),d+='<input type="hidden" id="allowedExtensions_'+a+'" name="allowedExtensions_'+a+'"     data-bind="allowedExtensions"    value="'+(void 0!==c.allowedExtensions?c.allowedExtensions:"tif%,%tiff%,%jpg")+'">',d+='<input type="hidden" id="convertResolution_'+a+'" name="convertResolution_'+a+'"     data-bind="convertResolution"    value="'+(void 0!==c.convertResolution?c.convertResolution:"192")+'">',d+='<input type="hidden" id="convertFormat_'+a+'"     name="convertFormat_'+a+'"         data-bind="convertFormat"        value="'+(void 0!==c.convertFormat?c.convertFormat:"JPG")+'">',d+='<input type="hidden" id="thumbnailHeight_'+a+'"   name="thumbnailHeight_'+a+'"       data-bind="thumbnailHeight"      value="'+(void 0!==c.thumbnailHeight?c.thumbnailHeight:"150")+'">',d+='<input type="hidden" id="thumbnailWidth_'+a+'"    name="thumbnailWidth_'+a+'"        data-bind="thumbnailWidth"       value="'+(void 0!==c.thumbnailWidth?c.thumbnailWidth:"150")+'">',d+='<input type="hidden" id="thumbnailFormat_'+a+'"   name="thumbnailFormat_'+a+'"       data-bind="thumbnailFormat"      value="'+(void 0!==c.thumbnailFormat?c.thumbnailFormat:"JPG")+'">',d+='<input type="hidden" id="help_'+a+'"   name="help_'+a+'"       data-bind="help"      value="'+(void 0!==c.help?c.help:"none|")+'">'}return d}function determineValidation(a){switch(a){case"Number":case"number":return"integer";case"Email":case"email":return"emailAddr";case"Phone":case"tel":return"phoneNumber";case"Date":case"date":return"date";case"Website":case"url":return"url";default:return}}function determineType(a){switch(a){case"ID Number":case"idno":return"idno";case"Single Line Text":case"text":return"text";case"Paragraph Text":case"textarea":return"textarea";case"Radio":case"radio":return"radio";case"Checkboxes":case"checkbox":return"checkbox";case"Dropdown":case"select":return"select";case"Number":case"number":return"number";case"Email":case"email":return"email";case"Phone":case"tel":return"tel";case"Date":case"date":return"date";case"Time":case"time":return"time";case"Website":case"url":return"url";case"Multi-Select":case"multiselect":return"multiselect";case"WYSIWYG":case"wysiwyg":return"wysiwyg";case"File Upload":case"file":return"file";case"Field Set":case"fieldset":return"fieldset";default:return}}function createHiddenFields(a,b,c){return output="",$.each(a,function(a,d){var e=d+"_"+b,f=void 0!==c[d]?c[d]:"";output+='<input type="hidden" id="'+e+'" name="'+e+'" data-bind="'+d+'" value="'+f+'"/>'}),output}function addChoice(a,b){return"undefined"==typeof a?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':"undefined"==typeof b?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn'+(a==b?" active":"")+'" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>'}function addAllowedExtension(a){return"undefined"==typeof a&&(a=""),'<div class="row-fluid input-append extensionItem" data-itemtype="extension"><input name="fieldSettings_allowedExtension_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add an extension."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this extension."><i class="icon-remove"></i></button></div>'}function addMetadataStandard(a){"undefined"==typeof a&&(a="");var b=metadataSchema,c=a.split(" : ")[1],d=a.split(" : ")[0];"undefined"==typeof c&&(c=""),"undefined"==typeof d&&(d="");var e='<select class="input-block-level form-control mdStandardSelect" id="fieldSettings_standardType" name="fieldSettings_standardType" data-selectvalue="'+d+'"><option value=""> None </option>'+b+"</select>";return'<div class="row-fluid input-append metadata-item" data-itemtype="metadataStandard">'+e+'<input name="fieldSettings_metadataIdentifer" type="text" value="'+c+'"><button name="add" class="btn" type="button" title="Add Metadata Standard"><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove Metadata Standard"><i class="icon-remove"></i></button></div>'}function enableChoiceFunctionality(){$(".choicesItem").find($("input[type=text], select")).bind("change keyup",modifyChoiceBinding).change(),$(".extensionItem").find($("input[type=text], select")).bind("change keyup",extensionBinding).change(),$(".metadata-item").find($("input[type=text], select")).bind("change keyup",metadataBinding).change(),$("#fieldSettings_choices_null").change(function(){$(".input-append").find("input[type=text]").change()}),$(".input-append").find("button").click(function(){var a=$(this).attr("name"),b=$(this).parent().data("itemtype");if("add"==a)"choice"==b?$(this).parent().after(addChoice()):"extension"==b?$(this).parent().after(addAllowedExtension()):$(this).parent().after(addMetadataStandard()),$(".input-append").find("button").unbind("click"),enableChoiceFunctionality();else if("remove"==a)$(this).parent().remove(),$(".input-append").find($("input[type=text]")).change();else if("default"==a){var c=$(this).next().val(),d=globalFieldID;$("#choicesDefault_"+d).val(c),$('button[name="default"]').removeClass("active"),$(this).hasClass("focus")&&$(this).addClass("selected")}}),$("#fieldSettings_choices_formSelect").change(function(){var a=$(this).val();if("null"==a?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error")),void 0===choicesFields[a]){var b;choicesFields[null]=b,$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var c=JSON.parse(a);$.each(c,function(a,c){b="<option value> Select A Field</option>",$.each(c,function(a,c){b+='<option value="'+c.name+'">'+c.label+"</option>"}),choicesFields[a]=b})})}$("#fieldSettings_choices_fieldSelect").html(choicesFields[a])})}function modifyChoiceBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".choicesOptions").val(b).change(),$("#fieldSettings_choices_null").is(":checked")&&a.unshift("Make A Selection");for(var c=$("#formPreview_"+globalFieldID),d=c.find($("#type_"+globalFieldID)).val(),e="",f=0;f<a.length;f++)"multiselect"==d||"select"==d?e+="<option value='"+a[f]+"'>"+a[f]+"</option>":"checkbox"==d?e+="<label for='checkbox'><input type='checkbox'/>"+a[f]+"</label>":"radio"==d&&(e+="<label for='checkbox'><input type='radio'/>"+a[f]+"</label>");if("multiselect"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}else if("checkbox"==d||"radio"==d){var g=c.find($(".controls"));g.find($("label")).remove(),g.append(e)}else if("select"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}}function extensionBinding(){var a=[];$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".allowedExtensions").val(b).change();var c=$("#fieldSettings_file_allowedExtensions").children().length;1>=c?$("#allowedExtensionsAlert").show():$("#allowedExtensionsAlert").hide(),1>c&&$(this).parent().after(addAllowedExtension())}function metadataBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){var c=$(this).prev("select").val();value=c+" : "+$(this).val(),a[b]=value});var b=a.join("%,%");$(".metadataStandard").val(b).change()}function titleField(){var a=$("#formSettings_objectTitleField"),b="";$("#formPreview").find($(":input[type=text]")).each(function(){var a=($(this).parent().parent().parent().next("div").find($("input[name^='label']")).val(),$(this).parent().parent().parent().next("div").find($("input[name^='name']")).val());"idno"===a||(b+="<option value='"+a+"'>"+a+"</option>")}),a.html(b)}function validateURL(a){var b=/^((https?|ftp):\/\/)?([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;return b.test(a)}function checkForSpaces(a){return/\s/g.test(a)}function removeHtml(a){return a.replace(/&/g,"&amp;").replace(/>/g,"").replace(/</g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"")}function isEmpty(a){return!a||0===a.length}function removeItemFromID(a,b){var c=b.selectedIndex;if(-1!=c){for(i=b.length-1;i>=0;i--)b.options[i].selected&&(b.options[i]=null);b.length>0&&(b.selectedIndex=0==c?0:c-1)}}function selectAllOnSubmit(a){var b=document.getElementById(a);if(null!=b)for(i=b.length-1;i>=0;i--)b.options[i].selected=!0}function entrySubmit(){return selectAllOnSubmit("selectedEntryUsers"),selectAllOnSubmit("selectedViewUsers"),selectAllOnSubmit("selectedUsersAdmins"),!0}function settingsBindings(){var a=$("#GroupingsPreview");$("#GroupingsPreview").on("click","li",function(b){b.stopPropagation(),$(this).hasClass("activeField well")||(a.find(".activeField").removeClass("activeField well"),$(this).addClass("activeField well"),showSettings($(this).prop("id")))}),$("#groupingsSettings_grouping").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val(),e=b.find(".groupingPreview"),f=e.find("i"),g=e.find("ul"),h=e.contents();h.slice(h.index(f)+1,h.index(g)).remove(),g.before(d),b.find("input[name^=nav_grouping_]").val(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_label").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").text(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_url").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").prop("href",d),$("#nav_url_"+c).val(d)})}function showSettings(a){if($("#groupingsSettings").children().hide(),$("#groupingTab a[href='#groupingsSettings']").tab("show"),void 0===a)$("#noGroupingSelected").show();else{var b=a.split("_")[1],c=$("#nav_type_"+b).val(),d=$("#nav_grouping_"+b);if("grouping"==c)$("#groupingsSettings_container_grouping").show(),$("#groupingsSettings_grouping").val(d.val()).keyup();else{switch(c){case"logout":case"link":$("#groupingsSettings_container_label").show(),$("#groupingsSettings_container_url").show();break;case"export":case"objectForm":case"metadataForm":$("#groupingsSettings_container_label").show()}if("objectForm"==c||"metadataForm"==c?$("#groupingsSettings_label").prop("disabled",!0):$("#groupingsSettings_label").removeAttr("disabled"),"grouping"!=c){var e=d.parents("li").parents("li");if(e.length>0){var f=e.prop("id").split("_")[1];d.val($("#nav_grouping_"+f).val())}else d.val("")}else $("#groupingsSettings_grouping").val(d.val());$("#groupingsSettings_label").val($("#nav_label_"+b).val()).keyup(),$("#groupingsSettings_url").val($("#nav_url_"+b).val()).keyup()}}}function addNew(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c={};$(a).data("type")&&(c.type=b=$(a).data("type"),c.label=$("a",a).text()),$(a).data("formid")&&(c.formID=$(a).data("formid"));var d=0;$("#GroupingsPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");d<=b[1]&&(d=parseInt(b[1])+1)}}),$(a).attr({id:"GroupingsPreview_"+d}).html('<div class="groupingPreview">'+newGroupingPreview(b,c)+'</div><div class="groupingValues">'+newGroupingValues(d,b,c)+"</div>"),$("#GroupingsPreview_"+d).click()}function newGroupingPreview(a,b){var c;return c='<i class="icon-remove"></i>',c+="New Grouping"==a||"grouping"==a?'<ul class="unstyled sortable"></ul>':void 0===b||null===b?'<a href="#">[Link]</a>':'<a href="'+(void 0!==b.url?b.url:"")+'">'+(void 0!==b.label?b.label:"Untitled")+"</a>"}function newGroupingValues(a,b,c){var d;switch(void 0===c&&(c={}),b){case"New Grouping":case"grouping":b=c.type="grouping";break;case"Log Out":case"logout":b=c.type="logout";break;case"Export Link":case"export":b=c.type="export";break;case"Link":case"link":b=c.type="link"}switch(d='<input type="hidden" id="nav_position_'+a+'" name="nav_position_'+a+'" value="'+(void 0!==c.position?c.position:"")+'">',d+='<input type="hidden" id="nav_type_'+a+'" name="nav_type_'+a+'" value="'+(void 0!==c.type?c.type:b)+'">',d+='<input type="hidden" id="nav_label_'+a+'" name="nav_label_'+a+'" value="'+(void 0!==c.label?c.label:"Untitled")+'">',d+='<input type="hidden" id="nav_url_'+a+'" name="nav_url_'+a+'" value="'+(void 0!==c.url?c.url:"")+'">',d+='<input type="hidden" id="nav_grouping_'+a+'" name="nav_grouping_'+a+'" value="'+(void 0!==c.grouping?c.grouping:"")+'">',b){case"objectForm":case"metadataForm":d+='<input type="hidden" id="nav_formID_'+a+'" name="nav_formID_'+a+'" value="'+(void 0!==c.formID?c.formID:"")+'">'}return d}function sortableNav(){$("#navigation ul.sortable").sortable({connectWith:"#navigation ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("New Grouping"==$(b.item).text()&&"GroupingsPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNew(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableNav()}})}function removeFormPreviewItem(a){if(confirm("Are you sure you want to remove this field?")){var b=a.parent().parent();"fieldset"==a.parent().next().children(":input[name^=type_]").val()&&b.after(a.next().find("li"));var c=$(".addFieldNav").parent();b.removeClass("well activeField").remove(),c.hasClass("active")||($(".addFieldNav").click().tab("show"),$("#formPreview li:first-child").trigger("click")),$("#formSettings_formMetadata").not(":checked")&&(0===$(":input[name^=type_][value=idno]",formPreview).length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}}function applyFormPreview(){var a;a="undefined"==typeof globalFieldID?$("#formPreview").children().find(".fieldPreview"):$("#formPreview_"+globalFieldID).find(".fieldPreview"),a.each(function(){var a=$(this).find(".fieldLabels"),b=$(this).find(".controls").children(),c=$(this).next(),d=c.find($('input[name^="placeholder"]')).val(),e=(c.find($('input[name^="type"]')).val(),c.find($('input[name^="name"]')).val()),f=(c.find($('input[name^="style"]')).val(),c.find($('input[name^="label"]')).val()),g=c.find($('input[name^="id"]')).val(),h=c.find($('input[name^="class"]')).val(),i=c.find($('input[name^="value"]')).val(),j=c.find($('input[name^="disabled"')).val(),k=c.find($('input[name^="readonly"')).val();c.find($('input[name^="hidden"]')).val(),c.find($('input[name^="choicesOptions"]')).val(),c.find($('input[name^="choicesType"]')).val(),b.attr({placeholder:d,name:e,id:g,"class":h}),b.val(i),"true"===j||"true"===k?(b.prop("readonly",!0).addClass("disabled"),b.prop("disabled",!0).addClass("disabled")):(b.prop("readonly",!1).removeClass("disabled"),b.prop("disabled",!1).removeClass("disabled")),i.length&&b.val(i),a.html(f)})}function sortableForm(){$("#formCreator ul.sortable").sortable({connectWith:"#formCreator ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("Field Set"==$(b.item).text()&&"formPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNewField(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableForm()}}),calculatePosition()}function calculatePosition(){$("#formCreator ul.sortable").children("li").each(function(a){$(this).attr("data-position",a),$(this).find("[data-bind='position']").val(a)})}function showFieldSettings(a){var b=$("#fieldSettings_form"),c=$("#fieldSettings_fieldset_form");if(void 0===a)$("#noFieldSelected").show(),c.hide(),b.hide();else{var d,e,f,g=a,h=$("#type_"+g).val(),i=$("#fieldset_"+g);if($("#noFieldSelected").hide(),"fieldset"==h)c.show(),b.hide();else{c.hide(),b.show(),b.find(".dataSettings").children().hide(),b.find(".default").show();var j=$("#fieldSettings_name"),k=$("#fieldSettings_options_required"),l=$("#fieldSettings_options_duplicates"),m=$("#fieldSettings_options_displayTable"),n=$("#fieldSettings_options_readonly"),o=$("#fieldSettings_options_disabled");switch("idno"==h?(j.prop("readonly",!0).val("idno").keyup(),k.prop({checked:!0,disabled:!0}).change(),l.prop({checked:!0,disabled:!0}).change(),m.prop({checked:!0,disabled:!0}).change(),n.prop({checked:!0,disabled:!0}).change(),o.prop({checked:!1,disabled:!0}).change()):"file"==h?m.removeAttr("checked").change().prop("disabled",!0):(j.removeAttr("readonly"),k.removeAttr("disabled"),l.removeAttr("disabled"),n.removeAttr("disabled"),o.removeAttr("disabled"),m.removeAttr("disabled")),h){case"idno":$("#fieldSettings_container_idno").parent().show();break;case"text":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_externalUpdate").parent().hide(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"textarea":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"radio":case"checkbox":case"select":case"multiselect":$("#fieldSettings_container_choices").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;case"number":$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().show(),$("#fieldSettings_range_format").parent().removeClass("span6").addClass("span4"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="value">Value</option><option value="digits">Digits</option>');break;case"wysiwyg":$("#fieldSettings_container_placeholder").hide(),$("#fieldSettings_container_value").hide();break;case"file":$("#fieldSettings_container_file_allowedExtensions").parent().show(),$("#fieldSettings_container_file_options").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;default:$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show()}var p=$("#choicesOptions_"+g).val();if(void 0!==p){var q=$("#fieldSettings_choices_manual");for(d=p.split("%,%"),e="",f=0;f<d.length;f++)e+=addChoice(d[f],$("#choicesDefault_"+g).val());q.html(e).find("input[name=fieldSettings_choices_text]").keyup()}var r=$("#allowedExtensions_"+g).val();if(void 0!==r){var s=$("#fieldSettings_file_allowedExtensions");for(d=r.split("%,%"),e="",s.html(""),f=0;f<d.length;f++)e+=addAllowedExtension(d[f]);s.append(e),s.find(":input[name=fieldSettings_allowedExtension_text]:first").keyup()}var t=$("#metadataStandard_"+g).val();if(void 0!==t){var u=$("#metadataStandard_options");for(d=t.split("%,%"),e="",u.html(""),f=0;f<d.length;f++)e+=addMetadataStandard(d[f]);u.append(e),$(".mdStandardSelect").each(function(){var a=$(this).data("selectvalue");$(this).val(a)})}if("fieldset"!=h){var v=i.parents("li").parents("li");if(v.length>0){var w=v.prop("id").split("_")[1];i.val($("#fieldset_"+w).val())}else i.val("")}else $("#fieldSettings_fieldset").val(i.val());-1!=$.inArray(h,["idno","text","textarea","date","time","wysiwyg"])?$("#fieldVariablesLink").show():$("#fieldVariablesLink").hide(),$("#fieldSettings_externalUpdate_formSelect").change(function(){var a=$(this).val();void 0===choicesFields[a]&&(choicesFields[a]="",$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var b=JSON.parse(a);$.each(b,function(a,b){var c="";$.each(b,function(a,b){c+='<option value="'+b.name+'">'+b.label+"</option>"}),choicesFields[a]=c})})),$("#externalUpdateForm_"+g).val(a).change(),$("#fieldSettings_externalUpdate_fieldSelect").html(choicesFields[a]).change()}),$(".uxOptions").find("input").change(function(){var a=$(this).data("bindmodel"),b=$("."+a);$(this).is(":checked")||$(this).value?b.show():b.hide()}),enableChoiceFunctionality()}}}function fieldSettingsBindings(){var a=$("#formPreview");a.children("li").removeClass("activeField"),$("#fieldSettings_form").find("[data-bindmodel]").bind("change keyup",bindToHiddenForm),a.on("click","li",function(b){if(b.stopPropagation(),$(b.target).is(".icon-remove"))console.log($(this)),removeFormPreviewItem($(b.target));else{var c=$(this).data("id");globalFieldID=c,a.find("[data-bind]").bind("change",setOriginalValues),$(this).hasClass("activeField")||(a.find(".activeField").removeClass("activeField"),$(this).addClass("activeField"),$("#fieldTab a[href='#fieldSettings']").tab("show"),showFieldSettings(c),setInitialBind(),applyFormPreview())}})}function setInitialBind(){var a=globalFieldID;if("undefined"!=typeof a){var b=$("#formPreview").find("[data-id='"+a+"']"),c=b.find(".fieldValues");c.find("[data-bind]").change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues)}}function setOriginalValues(){var a=globalFieldID,b=$(this).data("bind"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#fieldSettings_form").find("[data-bindmodel='"+b+"']"),e=$("#formPreview").find("[data-id='"+a+"']"),f=e.find(".fieldPreview");if("name"==b&&(c=$.trim(c),evaluateSpace(c,d)),"idnoFormat"==b&&(idnoValues.idnoFormat=c),"startIncrement"==b&&(idnoValues.startIncrement=c),"help"==b){var g=c.split("|")[0],h=c.split("|")[1],c="undefined"==h?"":h;$(this).val(g+"|"+h),$("#fieldSettings_help_textarea").val(c).hide(),$("#fieldSettings_help_url").hide().val(c),$("#fieldSettings_help_type").val(g).change()}d.is("input[type=checkbox]")?"true"==c?d.prop("checked",!0):d.prop("checked",!1):d.is("select")?d.find('option[value="'+c+'"]').prop("selected",!0):d.is("input[type=number]")?d.val(parseInt(c)):d.val(c),d.is($("#fieldSettings_choices_type"))&&("manual"==c?($("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide()):($("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show())),"managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"validation"==b&&("regexp"==c?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide()),"choicesForm"==b&&("null"==c||void 0==c?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error"))),"choicesDefault"==b&&$('input[value="'+c+'"]').prev().addClass("active"),"choicesField"==b&&($("#fieldSettings_choices_formSelect").change(),$("#fieldSettings_choices_fieldSelect").val(c).change())}function bindToHiddenForm(){var a=globalFieldID;if("undefined"!=typeof a){var b=$(this).data("bindmodel"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#formPreview").find("[data-id='"+a+"']"),e=($("#formPreview_"+a).find(".fieldLabels"),d.find(".fieldValues")),f=d.find(".fieldPreview");if(e.find("[data-bind='"+b+"']").val(c),"name"==b&&(evaluateSpace(c,$(this)),titleField()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"choicesType"==b)if("manual"==c)$("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide(),$("#choicesForm_"+a).val("");else{$("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show();var g=e.find($('input[name^="type"]')).val();"multiselect"==g?f.find(".controls").find($("select")).html():"checkbox"==g||"radio"==g?f.find(".controls").find($("label")).remove():"select"==g&&f.find($(".controls")).find($("select")).html(output)}if("managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"idnoFormat"==b||"startIncrement"==b||"idnoConfirm"==b){$("#fieldSettings_container_idno_confirm").removeClass("hidden").show();var h=$("#fieldSettings_idno_confirm").is(":checked");h===!1&&idnoValues.idnoFormat?$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled")}if("validation"==b){var i=$("#fieldSettings_validation").val();"regexp"===i?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide().val("")}if(("helpText"==b||"helpURL"==b)&&formatHelpForHiddenField(e),"helpType"==b){switch($(this).val()){case"text":case"html":$("#fieldSettings_help_textarea").show().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden");break;case"web":$("#fieldSettings_help_url").show().removeClass("hidden"),$("#fieldSettings_help_textarea").hide().removeClass("hidden");break;case"none":case"default":$("#fieldSettings_help_textarea").hide().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden")}formatHelpForHiddenField(e)}applyFormPreview()}}function formatHelpForHiddenField(a){var b,c=$("#fieldSettings_help_type").val(),d=globalFieldID;"text"==c||"html"==c?(b=$("#fieldSettings_help_textarea").val().sanitizeInput().escapeHtml(),console.log(b)):(b=$("#fieldSettings_help_url").val(),console.log(b),validateURL(b)?$("#fieldSettings_help_url").removeClass("has-error"):$("#fieldSettings_help_url").addClass("has-error"));var e=c+"|"+b;$("#fieldSettings_help_text").val(e),a.find("[data-bind='help']").val(e),$(".helpPreview").popover("destroy"),$(".helpPreview").hide(),"html"===c||"text"===c?($("#formPreview_"+d).find(".helpPreview").show(),
$(".helpPreview").popover({title:"Help",content:"<div>"+b.unEscapeHtml()+"</div>",trigger:"click",html:!0})):"web"===c&&($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help Url",content:'<div><a href="'+b+'">'+b+"</a></div>",trigger:"click",html:!0}))}function evaluateSpace(a,b){checkForSpaces(a)?(b.addClass("has-error testy"),$(".noSpacesAlert").show(),$("input[type=submit]").addClass("disabled").attr("disabled",!0)):(b.removeClass("has-error"),$("input[type=submit]").removeClass("disabled").removeAttr("disabled"),$(".noSpacesAlert").hide())}function getFormFields(){var a="";return $.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(b){var c=JSON.parse(b);$.each(c,function(b,c){$.each(c,function(b,c){a+='<option value="'+c.name+'">'+c.label+"</option>"})})}),a}function evaluateCheck(a){return a.is(":checked")?!0:!1}function formSettingsBindings(){$("#formTitle").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formTitle").focus()}),$("#formSettings_formTitle").keyup(function(){$("#formTitle").html($(this).val()),0!==$(this).val().length?$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled")}).keyup(),$("#formDescription").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formDescription").focus()}),$("#formSettings_formDescription").keyup(function(){$("#formDescription").html($(this).val())}).keyup(),$("#formSettings_formMetadata").change(function(){var a=$("#fieldAdd"),b=$("#formPreview").find("input[name^=type_][value=idno]");$(this).is(":checked")?($("#formSettings_linkTitle_container").show(),0===b.length?($("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):confirm("Enabling this will remove any existing ID Number fields. Do you want to continue?")?(b.parent().parent().remove(),$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):$(this).removeAttr("checked")):($("#formSettings_linkTitle_container").hide(),a.find("li:contains('ID Number')").show(),a.find("li:contains('Paragraph Text')").show(),a.find("li:contains('Radio')").show(),a.find("li:contains('Checkboxes')").show(),a.find("li:contains('Dropdown')").show(),a.find("li:contains('Multi-Select')").show(),a.find("li:contains('File Upload')").show(),a.find("li:contains('WYSIWYG')").show(),a.find("li:contains('Field Set')").parent().show().prev().show(),0===b.length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}).change()}function modalBindings(){$("#formTypeSelector").modal({show:!1,keyboard:!1,backdrop:"static"}).on("click","button:contains('Metadata')",function(){$(".nav-tabs li:nth-child(3) a").click(),$("#formSettings_formMetadata").prop("checked",!0).change(),$("#formTypeSelector").modal("hide")}).on("click","button:contains('Object')",function(){var a=$("#fieldAdd"),b=($("#formPreview .well"),$("#fieldSettings_label")),c=$("#fieldSettings_options_sortable"),d=$("#fieldSettings_options_searchable");a.find("li:contains('ID Number')").click(),b.val("IDNO").keyup(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),a.find("li:contains('Single Line Text')").click(),$("#fieldSettings_name").val("title").keyup(),b.val("Title").keyup(),$("#fieldSettings_options_required").prop("checked",!0).change(),$("#fieldSettings_options_duplicates").prop("checked",!0).change(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),$("#fieldSettings_options_displayTable").prop("checked",!0).change(),$("#fieldTab li:last a").click(),$("#formPreview li").removeClass("activeField"),$("#formSettings_formMetadata").removeAttr("checked").change(),$("#formTypeSelector").modal("hide"),$("#formSettings_formTitle")})}function addNewField(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c=0;$("#formPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");c<=b[1]&&(c=parseInt(b[1])+1)}}),$(a).attr({id:"formPreview_"+c,"data-id":c}).html('<div class="fieldPreview">'+newFieldPreview(c,b)+'</div><div class="fieldValues">'+newFieldValues(c,b)+"</div>"),$("#formPreview_"+c).click(),$("#formSettings_formMetadata").not(":checked")&&(0===$("#formPreview").find("input[name^=type_][value=idno]").length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}function newFieldPreview(a,b,c){var d="";if(void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.choicesOptions="First Choice%,%Second Choice",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),("idno"!=b&&"ID Number"!=b||0!==numIDNOs)&&(d+='<i class="icon-remove"></i>'),d+='<span class="fa fa-question-circle helpPreview"></span>',"Field Set"==b||"fieldset"==b)d+='<fieldset><legend></legend><ul class="unstyled sortable"></ul></fieldset>';else{switch(d+='<div class="control-group"><label class="control-label fieldLabels">Untitled</label><div class="controls">',b){case"ID Number":case"idno":case"Single Line Text":case"text":d+='<input type="text">',numIDNOs++;break;case"Paragraph Text":case"textarea":d+="<textarea></textarea>";break;case"Radio":case"radio":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="radio" checked> '+b+"</label>":'<label> <input type="radio"> '+b+"</label>"})}else d+='<label class="radio"><input type="radio">First Choice</label><label class="radio"><input type="radio">Second Choice</label>';break;case"Checkboxes":case"checkbox":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="checkbox" checked> '+b+"</label>":'<label> <input type="checkbox"> '+b+"</label>"})}else d+='<label class="checkbox"><input type="checkbox">First Choice</label><label class="checkbox"><input type="checkbox">Second Choice</label>';break;case"Dropdown":case"select":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+="<select>",$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+="<select></select>";break;case"Number":case"number":d+='<input type="number">';break;case"Email":case"email":d+='<input type="email">';break;case"Phone":case"tel":d+='<input type="tel">';break;case"Date":case"date":d+='<input type="date">';break;case"Time":case"time":d+='<input type="time">';break;case"Website":case"url":d+='<input type="url">';break;case"Multi-Select":case"multiselect":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+='<select multiple></select><br><select class="selectPreview">',$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+='<select multiple></select><br><select class="selectPreview"></select>';break;case"WYSIWYG":case"wysiwyg":d+='<img src="../includes/img/wysiwyg.png">';break;case"File Upload":case"file":d+='<input type="file" disabled>'}d+="</div></div>"}return d}function newFieldValues(a,b,c){var d="";void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),c.type=determineType(b),b=c.type;var e=["name","position","type","label","value","placeholder","id","class","style","help","helpType","required","duplicates","readonly","disabled","disabledInsert","disabledUpdate","publicRelease","sortable","searchable","displayTable","hidden","validation","validationRegex","access","fieldset","metadataStandard"];switch(d+=createHiddenFields(e,a,c),b){case"idno":var f=["managedBy","idnoFormat"];d+=createHiddenFields(f,a,c),d+='<input type="hidden" id="startIncrement_'+a+'" name="startIncrement_'+a+'"   data-bind="startIncrement"    value="'+(void 0!==c.startIncrement?c.startIncrement:"1")+'">',d+='<input type="hidden" id="idnoConfirm_'+a+'"    name="idnoConfirm_'+a+'"      data-bind"idnoConfirm"        value="false">';break;case"text":var g=["externalUpdateForm","externalUpdateField","min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"textarea":case"number":var g=["min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"radio":case"checkbox":case"select":case"multiselect":var h=["choicesType","choicesNull","choicesDefault","choicesForm","choicesField","choicesFieldDefault"];d+=createHiddenFields(h,a,c),d+='<input type="hidden" id="choicesOptions_'+a+'" name="choicesOptions_'+a+'" data-bind="choicesOptions" value="'+(void 0!==c.choicesOptions?c.choicesOptions:"First Choice%,%Second Choice")+'">';break;case"file":var i=["bgProcessing","multipleFiles","combine","ocr","convert","convertHeight","convertWidth","watermark","watermarkImage","watermarkLocation","border","borderHeight","borderWidth","borderColor","thumbnail","convertAudio","bitRate","audioFormat","convertVideo","videoHeight","videoWidth","videobitRate","aspectRatio","videoFormat","videothumbnail","videoThumbFrames","videoThumbHeight","videoThumbWidth","videoFormatThumb"];d+=createHiddenFields(i,a,c),d+='<input type="hidden" id="allowedExtensions_'+a+'" name="allowedExtensions_'+a+'"     data-bind="allowedExtensions"    value="'+(void 0!==c.allowedExtensions?c.allowedExtensions:"tif%,%tiff%,%jpg")+'">',d+='<input type="hidden" id="convertResolution_'+a+'" name="convertResolution_'+a+'"     data-bind="convertResolution"    value="'+(void 0!==c.convertResolution?c.convertResolution:"192")+'">',d+='<input type="hidden" id="convertFormat_'+a+'"     name="convertFormat_'+a+'"         data-bind="convertFormat"        value="'+(void 0!==c.convertFormat?c.convertFormat:"JPG")+'">',d+='<input type="hidden" id="thumbnailHeight_'+a+'"   name="thumbnailHeight_'+a+'"       data-bind="thumbnailHeight"      value="'+(void 0!==c.thumbnailHeight?c.thumbnailHeight:"150")+'">',d+='<input type="hidden" id="thumbnailWidth_'+a+'"    name="thumbnailWidth_'+a+'"        data-bind="thumbnailWidth"       value="'+(void 0!==c.thumbnailWidth?c.thumbnailWidth:"150")+'">',d+='<input type="hidden" id="thumbnailFormat_'+a+'"   name="thumbnailFormat_'+a+'"       data-bind="thumbnailFormat"      value="'+(void 0!==c.thumbnailFormat?c.thumbnailFormat:"JPG")+'">',d+='<input type="hidden" id="help_'+a+'"   name="help_'+a+'"       data-bind="help"      value="'+(void 0!==c.help?c.help:"none|")+'">'}return d}function determineValidation(a){switch(a){case"Number":case"number":return"integer";case"Email":case"email":return"emailAddr";case"Phone":case"tel":return"phoneNumber";case"Date":case"date":return"date";case"Website":case"url":return"url";default:return}}function determineType(a){switch(a){case"ID Number":case"idno":return"idno";case"Single Line Text":case"text":return"text";case"Paragraph Text":case"textarea":return"textarea";case"Radio":case"radio":return"radio";case"Checkboxes":case"checkbox":return"checkbox";case"Dropdown":case"select":return"select";case"Number":case"number":return"number";case"Email":case"email":return"email";case"Phone":case"tel":return"tel";case"Date":case"date":return"date";case"Time":case"time":return"time";case"Website":case"url":return"url";case"Multi-Select":case"multiselect":return"multiselect";case"WYSIWYG":case"wysiwyg":return"wysiwyg";case"File Upload":case"file":return"file";case"Field Set":case"fieldset":return"fieldset";default:return}}function createHiddenFields(a,b,c){return output="",$.each(a,function(a,d){var e=d+"_"+b,f=void 0!==c[d]?c[d]:"";output+='<input type="hidden" id="'+e+'" name="'+e+'" data-bind="'+d+'" value="'+f+'"/>'}),output}function addChoice(a,b){return"undefined"==typeof a?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':"undefined"==typeof b?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn'+(a==b?" active":"")+'" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>'}function addAllowedExtension(a){return"undefined"==typeof a&&(a=""),'<div class="row-fluid input-append extensionItem" data-itemtype="extension"><input name="fieldSettings_allowedExtension_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add an extension."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this extension."><i class="icon-remove"></i></button></div>'}function addMetadataStandard(a){"undefined"==typeof a&&(a="");var b=metadataSchema,c=a.split(" : ")[1],d=a.split(" : ")[0];"undefined"==typeof c&&(c=""),"undefined"==typeof d&&(d="");var e='<select class="input-block-level form-control mdStandardSelect" id="fieldSettings_standardType" name="fieldSettings_standardType" data-selectvalue="'+d+'"><option value=""> None </option>'+b+"</select>";return'<div class="row-fluid input-append metadata-item" data-itemtype="metadataStandard">'+e+'<input name="fieldSettings_metadataIdentifer" type="text" value="'+c+'"><button name="add" class="btn" type="button" title="Add Metadata Standard"><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove Metadata Standard"><i class="icon-remove"></i></button></div>'}function enableChoiceFunctionality(){$(".choicesItem").find($("input[type=text], select")).bind("change keyup",modifyChoiceBinding).change(),$(".extensionItem").find($("input[type=text], select")).bind("change keyup",extensionBinding).change(),$(".metadata-item").find($("input[type=text], select")).bind("change keyup",metadataBinding).change(),$("#fieldSettings_choices_null").change(function(){$(".input-append").find("input[type=text]").change()}),$(".input-append").find("button").click(function(){var a=$(this).attr("name"),b=$(this).parent().data("itemtype");if("add"==a)"choice"==b?$(this).parent().after(addChoice()):"extension"==b?$(this).parent().after(addAllowedExtension()):$(this).parent().after(addMetadataStandard()),$(".input-append").find("button").unbind("click"),enableChoiceFunctionality();else if("remove"==a)$(this).parent().remove(),$(".input-append").find($("input[type=text]")).change();else if("default"==a){var c=$(this).next().val(),d=globalFieldID;$("#choicesDefault_"+d).val(c),$('button[name="default"]').removeClass("active"),$(this).hasClass("focus")&&$(this).addClass("selected")}}),$("#fieldSettings_choices_formSelect").change(function(){var a=$(this).val();if("null"==a?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error")),void 0===choicesFields[a]){var b;choicesFields[null]=b,$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var c=JSON.parse(a);$.each(c,function(a,c){b="<option value> Select A Field</option>",$.each(c,function(a,c){b+='<option value="'+c.name+'">'+c.label+"</option>"}),choicesFields[a]=b})})}$("#fieldSettings_choices_fieldSelect").html(choicesFields[a])})}function modifyChoiceBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".choicesOptions").val(b).change(),$("#fieldSettings_choices_null").is(":checked")&&a.unshift("Make A Selection");for(var c=$("#formPreview_"+globalFieldID),d=c.find($("#type_"+globalFieldID)).val(),e="",f=0;f<a.length;f++)"multiselect"==d||"select"==d?e+="<option value='"+a[f]+"'>"+a[f]+"</option>":"checkbox"==d?e+="<label for='checkbox'><input type='checkbox'/>"+a[f]+"</label>":"radio"==d&&(e+="<label for='checkbox'><input type='radio'/>"+a[f]+"</label>");if("multiselect"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}else if("checkbox"==d||"radio"==d){var g=c.find($(".controls"));g.find($("label")).remove(),g.append(e)}else if("select"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}}function extensionBinding(){var a=[];$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".allowedExtensions").val(b).change();var c=$("#fieldSettings_file_allowedExtensions").children().length;1>=c?$("#allowedExtensionsAlert").show():$("#allowedExtensionsAlert").hide(),1>c&&$(this).parent().after(addAllowedExtension())}function metadataBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){var c=$(this).prev("select").val();value=c+" : "+$(this).val(),a[b]=value});var b=a.join("%,%");$(".metadataStandard").val(b).change()}function titleField(){var a=$("#formSettings_objectTitleField"),b="";$("#formPreview").find($(":input[type=text]")).each(function(){var a=($(this).parent().parent().parent().next("div").find($("input[name^='label']")).val(),$(this).parent().parent().parent().next("div").find($("input[name^='name']")).val());"idno"===a||(b+="<option value='"+a+"'>"+a+"</option>")}),a.html(b)}function validateURL(a){var b=/^((https?|ftp):\/\/)?([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;return b.test(a)}function checkForSpaces(a){return/\s/g.test(a)}function removeHtml(a){return a.replace(/&/g,"&amp;").replace(/>/g,"").replace(/</g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"")}function isEmpty(a){return!a||0===a.length}function removeItemFromID(a,b){var c=b.selectedIndex;if(-1!=c){for(i=b.length-1;i>=0;i--)b.options[i].selected&&(b.options[i]=null);b.length>0&&(b.selectedIndex=0==c?0:c-1)}}function selectAllOnSubmit(a){var b=document.getElementById(a);if(null!=b)for(i=b.length-1;i>=0;i--)b.options[i].selected=!0}function entrySubmit(){return selectAllOnSubmit("selectedEntryUsers"),selectAllOnSubmit("selectedViewUsers"),selectAllOnSubmit("selectedUsersAdmins"),!0}function settingsBindings(){var a=$("#GroupingsPreview");$("#GroupingsPreview").on("click","li",function(b){b.stopPropagation(),$(this).hasClass("activeField well")||(a.find(".activeField").removeClass("activeField well"),$(this).addClass("activeField well"),showSettings($(this).prop("id")))}),$("#groupingsSettings_grouping").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val(),e=b.find(".groupingPreview"),f=e.find("i"),g=e.find("ul"),h=e.contents();h.slice(h.index(f)+1,h.index(g)).remove(),g.before(d),b.find("input[name^=nav_grouping_]").val(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_label").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").text(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_url").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").prop("href",d),$("#nav_url_"+c).val(d)})}function showSettings(a){if($("#groupingsSettings").children().hide(),$("#groupingTab a[href='#groupingsSettings']").tab("show"),void 0===a)$("#noGroupingSelected").show();else{var b=a.split("_")[1],c=$("#nav_type_"+b).val(),d=$("#nav_grouping_"+b);if("grouping"==c)$("#groupingsSettings_container_grouping").show(),$("#groupingsSettings_grouping").val(d.val()).keyup();else{switch(c){case"logout":case"link":$("#groupingsSettings_container_label").show(),$("#groupingsSettings_container_url").show();break;case"export":case"objectForm":case"metadataForm":$("#groupingsSettings_container_label").show()}if("objectForm"==c||"metadataForm"==c?$("#groupingsSettings_label").prop("disabled",!0):$("#groupingsSettings_label").removeAttr("disabled"),"grouping"!=c){var e=d.parents("li").parents("li");if(e.length>0){var f=e.prop("id").split("_")[1];d.val($("#nav_grouping_"+f).val())}else d.val("")}else $("#groupingsSettings_grouping").val(d.val());$("#groupingsSettings_label").val($("#nav_label_"+b).val()).keyup(),$("#groupingsSettings_url").val($("#nav_url_"+b).val()).keyup()}}}function addNew(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c={};$(a).data("type")&&(c.type=b=$(a).data("type"),c.label=$("a",a).text()),$(a).data("formid")&&(c.formID=$(a).data("formid"));var d=0;$("#GroupingsPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");d<=b[1]&&(d=parseInt(b[1])+1)}}),$(a).attr({id:"GroupingsPreview_"+d}).html('<div class="groupingPreview">'+newGroupingPreview(b,c)+'</div><div class="groupingValues">'+newGroupingValues(d,b,c)+"</div>"),$("#GroupingsPreview_"+d).click()}function newGroupingPreview(a,b){var c;return c='<i class="icon-remove"></i>',c+="New Grouping"==a||"grouping"==a?'<ul class="unstyled sortable"></ul>':void 0===b||null===b?'<a href="#">[Link]</a>':'<a href="'+(void 0!==b.url?b.url:"")+'">'+(void 0!==b.label?b.label:"Untitled")+"</a>"}function newGroupingValues(a,b,c){var d;switch(void 0===c&&(c={}),b){case"New Grouping":case"grouping":b=c.type="grouping";break;case"Log Out":case"logout":b=c.type="logout";break;case"Export Link":case"export":b=c.type="export";break;case"Link":case"link":b=c.type="link"}switch(d='<input type="hidden" id="nav_position_'+a+'" name="nav_position_'+a+'" value="'+(void 0!==c.position?c.position:"")+'">',d+='<input type="hidden" id="nav_type_'+a+'" name="nav_type_'+a+'" value="'+(void 0!==c.type?c.type:b)+'">',d+='<input type="hidden" id="nav_label_'+a+'" name="nav_label_'+a+'" value="'+(void 0!==c.label?c.label:"Untitled")+'">',d+='<input type="hidden" id="nav_url_'+a+'" name="nav_url_'+a+'" value="'+(void 0!==c.url?c.url:"")+'">',d+='<input type="hidden" id="nav_grouping_'+a+'" name="nav_grouping_'+a+'" value="'+(void 0!==c.grouping?c.grouping:"")+'">',b){case"objectForm":case"metadataForm":d+='<input type="hidden" id="nav_formID_'+a+'" name="nav_formID_'+a+'" value="'+(void 0!==c.formID?c.formID:"")+'">'}return d}function sortableNav(){$("#navigation ul.sortable").sortable({connectWith:"#navigation ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("New Grouping"==$(b.item).text()&&"GroupingsPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNew(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableNav()}})}function removeFormPreviewItem(a){if(confirm("Are you sure you want to remove this field?")){var b=a.parent().parent();"fieldset"==a.parent().next().children(":input[name^=type_]").val()&&b.after(a.next().find("li"));var c=$(".addFieldNav").parent();b.removeClass("well activeField").remove(),c.hasClass("active")||($(".addFieldNav").click().tab("show"),$("#formPreview li:first-child").trigger("click")),$("#formSettings_formMetadata").not(":checked")&&(0===$(":input[name^=type_][value=idno]",formPreview).length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}}function applyFormPreview(){var a;a="undefined"==typeof globalFieldID?$("#formPreview").children().find(".fieldPreview"):$("#formPreview_"+globalFieldID).find(".fieldPreview"),a.each(function(){var a=$(this).find(".fieldLabels"),b=$(this).find(".controls").children(),c=$(this).next(),d=c.find($('input[name^="placeholder"]')).val(),e=(c.find($('input[name^="type"]')).val(),c.find($('input[name^="name"]')).val()),f=(c.find($('input[name^="style"]')).val(),c.find($('input[name^="label"]')).val()),g=c.find($('input[name^="id"]')).val(),h=c.find($('input[name^="class"]')).val(),i=c.find($('input[name^="value"]')).val(),j=c.find($('input[name^="disabled"')).val(),k=c.find($('input[name^="readonly"')).val();c.find($('input[name^="hidden"]')).val(),c.find($('input[name^="choicesOptions"]')).val(),c.find($('input[name^="choicesType"]')).val(),b.attr({placeholder:d,name:e,id:g,"class":h}),b.val(i),"true"===j||"true"===k?(b.prop("readonly",!0).addClass("disabled"),b.prop("disabled",!0).addClass("disabled")):(b.prop("readonly",!1).removeClass("disabled"),b.prop("disabled",!1).removeClass("disabled")),i.length&&b.val(i),a.html(f)})}function sortableForm(){$("#formCreator ul.sortable").sortable({connectWith:"#formCreator ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("Field Set"==$(b.item).text()&&"formPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNewField(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableForm()}}),calculatePosition()}function calculatePosition(){$("#formCreator ul.sortable").children("li").each(function(a){$(this).attr("data-position",a),$(this).find("[data-bind='position']").val(a)})}function showFieldSettings(a){var b=$("#fieldSettings_form"),c=$("#fieldSettings_fieldset_form");if(void 0===a)$("#noFieldSelected").show(),c.hide(),b.hide();else{var d,e,f,g=a,h=$("#type_"+g).val(),i=$("#fieldset_"+g);if($("#noFieldSelected").hide(),"fieldset"==h)c.show(),b.hide();else{c.hide(),b.show(),b.find(".dataSettings").children().hide(),b.find(".default").show();var j=$("#fieldSettings_name"),k=$("#fieldSettings_options_required"),l=$("#fieldSettings_options_duplicates"),m=$("#fieldSettings_options_displayTable"),n=$("#fieldSettings_options_readonly"),o=$("#fieldSettings_options_disabled");switch("idno"==h?(j.prop("readonly",!0).val("idno").keyup(),k.prop({checked:!0,disabled:!0}).change(),l.prop({checked:!0,disabled:!0}).change(),m.prop({checked:!0,disabled:!0}).change(),n.prop({checked:!0,disabled:!0}).change(),o.prop({checked:!1,disabled:!0}).change()):"file"==h?m.removeAttr("checked").change().prop("disabled",!0):(j.removeAttr("readonly"),k.removeAttr("disabled"),l.removeAttr("disabled"),n.removeAttr("disabled"),o.removeAttr("disabled"),m.removeAttr("disabled")),h){case"idno":$("#fieldSettings_container_idno").parent().show();break;case"text":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_externalUpdate").parent().hide(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"textarea":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"radio":case"checkbox":case"select":case"multiselect":$("#fieldSettings_container_choices").parent().show();break;case"number":$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().show(),$("#fieldSettings_range_format").parent().removeClass("span6").addClass("span4"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="value">Value</option><option value="digits">Digits</option>');break;case"wysiwyg":$("#fieldSettings_container_placeholder").hide(),$("#fieldSettings_container_value").hide();break;case"file":$("#fieldSettings_container_file_allowedExtensions").parent().show(),$("#fieldSettings_container_file_options").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;default:$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show()}var p=$("#choicesOptions_"+g).val();if(void 0!==p){var q=$("#fieldSettings_choices_manual");for(d=p.split("%,%"),e="",f=0;f<d.length;f++)e+=addChoice(d[f],$("#choicesDefault_"+g).val());q.html(e).find("input[name=fieldSettings_choices_text]").keyup()}var r=$("#allowedExtensions_"+g).val();if(void 0!==r){var s=$("#fieldSettings_file_allowedExtensions");for(d=r.split("%,%"),e="",s.html(""),f=0;f<d.length;f++)e+=addAllowedExtension(d[f]);s.append(e),s.find(":input[name=fieldSettings_allowedExtension_text]:first").keyup()}var t=$("#metadataStandard_"+g).val();if(void 0!==t){var u=$("#metadataStandard_options");for(d=t.split("%,%"),e="",u.html(""),f=0;f<d.length;f++)e+=addMetadataStandard(d[f]);u.append(e),$(".mdStandardSelect").each(function(){var a=$(this).data("selectvalue");$(this).val(a)})}if("fieldset"!=h){var v=i.parents("li").parents("li");if(v.length>0){var w=v.prop("id").split("_")[1];i.val($("#fieldset_"+w).val())}else i.val("")}else $("#fieldSettings_fieldset").val(i.val());-1!=$.inArray(h,["idno","text","textarea","date","time","wysiwyg"])?$("#fieldVariablesLink").show():$("#fieldVariablesLink").hide(),$("#fieldSettings_externalUpdate_formSelect").change(function(){var a=$(this).val();void 0===choicesFields[a]&&(choicesFields[a]="",$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var b=JSON.parse(a);$.each(b,function(a,b){var c="";$.each(b,function(a,b){c+='<option value="'+b.name+'">'+b.label+"</option>"}),choicesFields[a]=c;
})})),$("#externalUpdateForm_"+g).val(a).change(),$("#fieldSettings_externalUpdate_fieldSelect").html(choicesFields[a]).change()}),$(".uxOptions").find("input").change(function(){var a=$(this).data("bindmodel"),b=$("."+a);$(this).is(":checked")||$(this).value?b.show():b.hide()}),enableChoiceFunctionality()}}}function fieldSettingsBindings(){var a=$("#formPreview");a.children("li").removeClass("activeField"),$("#fieldSettings_form").find("[data-bindmodel]").bind("change keyup",bindToHiddenForm),a.on("click","li",function(b){if(b.stopPropagation(),$(b.target).is(".icon-remove"))console.log($(this)),removeFormPreviewItem($(b.target));else{var c=$(this).data("id");globalFieldID=c,a.find("[data-bind]").bind("change",setOriginalValues),$(this).hasClass("activeField")||(a.find(".activeField").removeClass("activeField"),$(this).addClass("activeField"),$("#fieldTab a[href='#fieldSettings']").tab("show"),showFieldSettings(c),setInitialBind(),applyFormPreview())}})}function setInitialBind(){var a=globalFieldID;if("undefined"!=typeof a){var b=$("#formPreview").find("[data-id='"+a+"']"),c=b.find(".fieldValues");c.find("[data-bind]").change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues)}}function setOriginalValues(){var a=globalFieldID,b=$(this).data("bind"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#fieldSettings_form").find("[data-bindmodel='"+b+"']"),e=$("#formPreview").find("[data-id='"+a+"']"),f=e.find(".fieldPreview");if("name"==b&&(c=$.trim(c),evaluateSpace(c,d)),"idnoFormat"==b&&(idnoValues.idnoFormat=c),"startIncrement"==b&&(idnoValues.startIncrement=c),"help"==b){var g=c.split("|")[0],h=c.split("|")[1],c="undefined"==h?"":h;$(this).val(g+"|"+h),$("#fieldSettings_help_textarea").val(c).hide(),$("#fieldSettings_help_url").hide().val(c),$("#fieldSettings_help_type").val(g).change()}d.is("input[type=checkbox]")?"true"==c?d.prop("checked",!0):d.prop("checked",!1):d.is("select")?d.find('option[value="'+c+'"]').prop("selected",!0):d.is("input[type=number]")?d.val(parseInt(c)):d.val(c),d.is($("#fieldSettings_choices_type"))&&("manual"==c?($("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide()):($("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show())),"managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"validation"==b&&("regexp"==c?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide()),"choicesForm"==b&&("null"==c||void 0==c?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error"))),"choicesDefault"==b&&$('input[value="'+c+'"]').prev().addClass("active"),"choicesField"==b&&($("#fieldSettings_choices_formSelect").change(),$("#fieldSettings_choices_fieldSelect").val(c).change())}function bindToHiddenForm(){var a=globalFieldID;if("undefined"!=typeof a){var b=$(this).data("bindmodel"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#formPreview").find("[data-id='"+a+"']"),e=($("#formPreview_"+a).find(".fieldLabels"),d.find(".fieldValues")),f=d.find(".fieldPreview");if(e.find("[data-bind='"+b+"']").val(c),"name"==b&&(evaluateSpace(c,$(this)),titleField()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"choicesType"==b)if("manual"==c)$("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide(),$("#choicesForm_"+a).val("");else{$("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show();var g=e.find($('input[name^="type"]')).val();"multiselect"==g?f.find(".controls").find($("select")).html():"checkbox"==g||"radio"==g?f.find(".controls").find($("label")).remove():"select"==g&&f.find($(".controls")).find($("select")).html(output)}if("managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"idnoFormat"==b||"startIncrement"==b||"idnoConfirm"==b){$("#fieldSettings_container_idno_confirm").removeClass("hidden").show();var h=$("#fieldSettings_idno_confirm").is(":checked");h===!1&&idnoValues.idnoFormat?$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled")}if("validation"==b){var i=$("#fieldSettings_validation").val();"regexp"===i?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide().val("")}if(("helpText"==b||"helpURL"==b)&&formatHelpForHiddenField(e),"helpType"==b){switch($(this).val()){case"text":case"html":$("#fieldSettings_help_textarea").show().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden");break;case"web":$("#fieldSettings_help_url").show().removeClass("hidden"),$("#fieldSettings_help_textarea").hide().removeClass("hidden");break;case"none":case"default":$("#fieldSettings_help_textarea").hide().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden")}formatHelpForHiddenField(e)}applyFormPreview()}}function formatHelpForHiddenField(a){var b,c=$("#fieldSettings_help_type").val(),d=globalFieldID;"text"==c||"html"==c?(b=$("#fieldSettings_help_textarea").val().sanitizeInput().escapeHtml(),console.log(b)):(b=$("#fieldSettings_help_url").val(),console.log(b),validateURL(b)?$("#fieldSettings_help_url").removeClass("has-error"):$("#fieldSettings_help_url").addClass("has-error"));var e=c+"|"+b;$("#fieldSettings_help_text").val(e),a.find("[data-bind='help']").val(e),$(".helpPreview").popover("destroy"),$(".helpPreview").hide(),"html"===c||"text"===c?($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help",content:"<div>"+b.unEscapeHtml()+"</div>",trigger:"click",html:!0})):"web"===c&&($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help Url",content:'<div><a href="'+b+'">'+b+"</a></div>",trigger:"click",html:!0}))}function evaluateSpace(a,b){checkForSpaces(a)?(b.addClass("has-error testy"),$(".noSpacesAlert").show(),$("input[type=submit]").addClass("disabled").attr("disabled",!0)):(b.removeClass("has-error"),$("input[type=submit]").removeClass("disabled").removeAttr("disabled"),$(".noSpacesAlert").hide())}function getFormFields(){var a="";return $.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(b){var c=JSON.parse(b);$.each(c,function(b,c){$.each(c,function(b,c){a+='<option value="'+c.name+'">'+c.label+"</option>"})})}),a}function evaluateCheck(a){return a.is(":checked")?!0:!1}function formSettingsBindings(){$("#formTitle").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formTitle").focus()}),$("#formSettings_formTitle").keyup(function(){$("#formTitle").html($(this).val()),0!==$(this).val().length?$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled")}).keyup(),$("#formDescription").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formDescription").focus()}),$("#formSettings_formDescription").keyup(function(){$("#formDescription").html($(this).val())}).keyup(),$("#formSettings_formMetadata").change(function(){var a=$("#fieldAdd"),b=$("#formPreview").find("input[name^=type_][value=idno]");$(this).is(":checked")?($("#formSettings_linkTitle_container").show(),0===b.length?($("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):confirm("Enabling this will remove any existing ID Number fields. Do you want to continue?")?(b.parent().parent().remove(),$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):$(this).removeAttr("checked")):($("#formSettings_linkTitle_container").hide(),a.find("li:contains('ID Number')").show(),a.find("li:contains('Paragraph Text')").show(),a.find("li:contains('Radio')").show(),a.find("li:contains('Checkboxes')").show(),a.find("li:contains('Dropdown')").show(),a.find("li:contains('Multi-Select')").show(),a.find("li:contains('File Upload')").show(),a.find("li:contains('WYSIWYG')").show(),a.find("li:contains('Field Set')").parent().show().prev().show(),0===b.length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}).change()}function modalBindings(){$("#formTypeSelector").modal({show:!1,keyboard:!1,backdrop:"static"}).on("click","button:contains('Metadata')",function(){$(".nav-tabs li:nth-child(3) a").click(),$("#formSettings_formMetadata").prop("checked",!0).change(),$("#formTypeSelector").modal("hide")}).on("click","button:contains('Object')",function(){var a=$("#fieldAdd"),b=($("#formPreview .well"),$("#fieldSettings_label")),c=$("#fieldSettings_options_sortable"),d=$("#fieldSettings_options_searchable");a.find("li:contains('ID Number')").click(),b.val("IDNO").keyup(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),a.find("li:contains('Single Line Text')").click(),$("#fieldSettings_name").val("title").keyup(),b.val("Title").keyup(),$("#fieldSettings_options_required").prop("checked",!0).change(),$("#fieldSettings_options_duplicates").prop("checked",!0).change(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),$("#fieldSettings_options_displayTable").prop("checked",!0).change(),$("#fieldTab li:last a").click(),$("#formPreview li").removeClass("activeField"),$("#formSettings_formMetadata").removeAttr("checked").change(),$("#formTypeSelector").modal("hide"),$("#formSettings_formTitle")})}function addNewField(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c=0;$("#formPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");c<=b[1]&&(c=parseInt(b[1])+1)}}),$(a).attr({id:"formPreview_"+c,"data-id":c}).html('<div class="fieldPreview">'+newFieldPreview(c,b)+'</div><div class="fieldValues">'+newFieldValues(c,b)+"</div>"),$("#formPreview_"+c).click(),$("#formSettings_formMetadata").not(":checked")&&(0===$("#formPreview").find("input[name^=type_][value=idno]").length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}function newFieldPreview(a,b,c){var d="";if(void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.choicesOptions="First Choice%,%Second Choice",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),("idno"!=b&&"ID Number"!=b||0!==numIDNOs)&&(d+='<i class="icon-remove"></i>'),d+='<span class="fa fa-question-circle helpPreview"></span>',"Field Set"==b||"fieldset"==b)d+='<fieldset><legend></legend><ul class="unstyled sortable"></ul></fieldset>';else{switch(d+='<div class="control-group"><label class="control-label fieldLabels">Untitled</label><div class="controls">',b){case"ID Number":case"idno":case"Single Line Text":case"text":d+='<input type="text">',numIDNOs++;break;case"Paragraph Text":case"textarea":d+="<textarea></textarea>";break;case"Radio":case"radio":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="radio" checked> '+b+"</label>":'<label> <input type="radio"> '+b+"</label>"})}else d+='<label class="radio"><input type="radio">First Choice</label><label class="radio"><input type="radio">Second Choice</label>';break;case"Checkboxes":case"checkbox":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="checkbox" checked> '+b+"</label>":'<label> <input type="checkbox"> '+b+"</label>"})}else d+='<label class="checkbox"><input type="checkbox">First Choice</label><label class="checkbox"><input type="checkbox">Second Choice</label>';break;case"Dropdown":case"select":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+="<select>",$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+="<select></select>";break;case"Number":case"number":d+='<input type="number">';break;case"Email":case"email":d+='<input type="email">';break;case"Phone":case"tel":d+='<input type="tel">';break;case"Date":case"date":d+='<input type="date">';break;case"Time":case"time":d+='<input type="time">';break;case"Website":case"url":d+='<input type="url">';break;case"Multi-Select":case"multiselect":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+='<select multiple></select><br><select class="selectPreview">',$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+='<select multiple></select><br><select class="selectPreview"></select>';break;case"WYSIWYG":case"wysiwyg":d+='<img src="../includes/img/wysiwyg.png">';break;case"File Upload":case"file":d+='<input type="file" disabled>'}d+="</div></div>"}return d}function newFieldValues(a,b,c){var d="";void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),c.type=determineType(b),b=c.type;var e=["name","position","type","label","value","placeholder","id","class","style","help","helpType","required","duplicates","readonly","disabled","disabledInsert","disabledUpdate","publicRelease","sortable","searchable","displayTable","hidden","validation","validationRegex","access","fieldset","metadataStandard"];switch(d+=createHiddenFields(e,a,c),b){case"idno":var f=["managedBy","idnoFormat"];d+=createHiddenFields(f,a,c),d+='<input type="hidden" id="startIncrement_'+a+'" name="startIncrement_'+a+'"   data-bind="startIncrement"    value="'+(void 0!==c.startIncrement?c.startIncrement:"1")+'">',d+='<input type="hidden" id="idnoConfirm_'+a+'"    name="idnoConfirm_'+a+'"      data-bind"idnoConfirm"        value="false">';break;case"text":var g=["externalUpdateForm","externalUpdateField","min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"textarea":case"number":var g=["min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"radio":case"checkbox":case"select":case"multiselect":var h=["choicesType","choicesNull","choicesDefault","choicesForm","choicesField","choicesFieldDefault"];d+=createHiddenFields(h,a,c),d+='<input type="hidden" id="choicesOptions_'+a+'" name="choicesOptions_'+a+'" data-bind="choicesOptions" value="'+(void 0!==c.choicesOptions?c.choicesOptions:"First Choice%,%Second Choice")+'">';break;case"file":var i=["bgProcessing","multipleFiles","combine","ocr","convert","convertHeight","convertWidth","watermark","watermarkImage","watermarkLocation","border","borderHeight","borderWidth","borderColor","thumbnail","convertAudio","bitRate","audioFormat","convertVideo","videoHeight","videoWidth","videobitRate","aspectRatio","videoFormat","videothumbnail","videoThumbFrames","videoThumbHeight","videoThumbWidth","videoFormatThumb"];d+=createHiddenFields(i,a,c),d+='<input type="hidden" id="allowedExtensions_'+a+'" name="allowedExtensions_'+a+'"     data-bind="allowedExtensions"    value="'+(void 0!==c.allowedExtensions?c.allowedExtensions:"tif%,%tiff%,%jpg")+'">',d+='<input type="hidden" id="convertResolution_'+a+'" name="convertResolution_'+a+'"     data-bind="convertResolution"    value="'+(void 0!==c.convertResolution?c.convertResolution:"192")+'">',d+='<input type="hidden" id="convertFormat_'+a+'"     name="convertFormat_'+a+'"         data-bind="convertFormat"        value="'+(void 0!==c.convertFormat?c.convertFormat:"JPG")+'">',d+='<input type="hidden" id="thumbnailHeight_'+a+'"   name="thumbnailHeight_'+a+'"       data-bind="thumbnailHeight"      value="'+(void 0!==c.thumbnailHeight?c.thumbnailHeight:"150")+'">',d+='<input type="hidden" id="thumbnailWidth_'+a+'"    name="thumbnailWidth_'+a+'"        data-bind="thumbnailWidth"       value="'+(void 0!==c.thumbnailWidth?c.thumbnailWidth:"150")+'">',d+='<input type="hidden" id="thumbnailFormat_'+a+'"   name="thumbnailFormat_'+a+'"       data-bind="thumbnailFormat"      value="'+(void 0!==c.thumbnailFormat?c.thumbnailFormat:"JPG")+'">',d+='<input type="hidden" id="help_'+a+'"   name="help_'+a+'"       data-bind="help"      value="'+(void 0!==c.help?c.help:"none|")+'">'}return d}function determineValidation(a){switch(a){case"Number":case"number":return"integer";case"Email":case"email":return"emailAddr";case"Phone":case"tel":return"phoneNumber";case"Date":case"date":return"date";case"Website":case"url":return"url";default:return}}function determineType(a){switch(a){case"ID Number":case"idno":return"idno";case"Single Line Text":case"text":return"text";case"Paragraph Text":case"textarea":return"textarea";case"Radio":case"radio":return"radio";case"Checkboxes":case"checkbox":return"checkbox";case"Dropdown":case"select":return"select";case"Number":case"number":return"number";case"Email":case"email":return"email";case"Phone":case"tel":return"tel";case"Date":case"date":return"date";case"Time":case"time":return"time";case"Website":case"url":return"url";case"Multi-Select":case"multiselect":return"multiselect";case"WYSIWYG":case"wysiwyg":return"wysiwyg";case"File Upload":case"file":return"file";case"Field Set":case"fieldset":return"fieldset";default:return}}function createHiddenFields(a,b,c){return output="",$.each(a,function(a,d){var e=d+"_"+b,f=void 0!==c[d]?c[d]:"";output+='<input type="hidden" id="'+e+'" name="'+e+'" data-bind="'+d+'" value="'+f+'"/>'}),output}function addChoice(a,b){return"undefined"==typeof a?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':"undefined"==typeof b?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn'+(a==b?" active":"")+'" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>'}function addAllowedExtension(a){return"undefined"==typeof a&&(a=""),'<div class="row-fluid input-append extensionItem" data-itemtype="extension"><input name="fieldSettings_allowedExtension_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add an extension."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this extension."><i class="icon-remove"></i></button></div>'}function addMetadataStandard(a){"undefined"==typeof a&&(a="");var b=metadataSchema,c=a.split(" : ")[1],d=a.split(" : ")[0];"undefined"==typeof c&&(c=""),"undefined"==typeof d&&(d="");var e='<select class="input-block-level form-control mdStandardSelect" id="fieldSettings_standardType" name="fieldSettings_standardType" data-selectvalue="'+d+'"><option value=""> None </option>'+b+"</select>";return'<div class="row-fluid input-append metadata-item" data-itemtype="metadataStandard">'+e+'<input name="fieldSettings_metadataIdentifer" type="text" value="'+c+'"><button name="add" class="btn" type="button" title="Add Metadata Standard"><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove Metadata Standard"><i class="icon-remove"></i></button></div>'}function enableChoiceFunctionality(){$(".choicesItem").find($("input[type=text], select")).bind("change keyup",modifyChoiceBinding).change(),$(".extensionItem").find($("input[type=text], select")).bind("change keyup",extensionBinding).change(),$(".metadata-item").find($("input[type=text], select")).bind("change keyup",metadataBinding).change(),$("#fieldSettings_choices_null").change(function(){$(".input-append").find("input[type=text]").change()}),$(".input-append").find("button").click(function(){var a=$(this).attr("name"),b=$(this).parent().data("itemtype");if("add"==a)"choice"==b?$(this).parent().after(addChoice()):"extension"==b?$(this).parent().after(addAllowedExtension()):$(this).parent().after(addMetadataStandard()),$(".input-append").find("button").unbind("click"),enableChoiceFunctionality();else if("remove"==a)$(this).parent().remove(),$(".input-append").find($("input[type=text]")).change();else if("default"==a){var c=$(this).next().val(),d=globalFieldID;$("#choicesDefault_"+d).val(c),$('button[name="default"]').removeClass("active"),$(this).hasClass("focus")&&$(this).addClass("selected")}}),$("#fieldSettings_choices_formSelect").change(function(){var a=$(this).val();if("null"==a?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error")),void 0===choicesFields[a]){var b;choicesFields[null]=b,$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var c=JSON.parse(a);$.each(c,function(a,c){b="<option value> Select A Field</option>",$.each(c,function(a,c){b+='<option value="'+c.name+'">'+c.label+"</option>"}),choicesFields[a]=b})})}$("#fieldSettings_choices_fieldSelect").html(choicesFields[a])})}function modifyChoiceBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".choicesOptions").val(b).change(),$("#fieldSettings_choices_null").is(":checked")&&a.unshift("Make A Selection");for(var c=$("#formPreview_"+globalFieldID),d=c.find($("#type_"+globalFieldID)).val(),e="",f=0;f<a.length;f++)"multiselect"==d||"select"==d?e+="<option value='"+a[f]+"'>"+a[f]+"</option>":"checkbox"==d?e+="<label for='checkbox'><input type='checkbox'/>"+a[f]+"</label>":"radio"==d&&(e+="<label for='checkbox'><input type='radio'/>"+a[f]+"</label>");if("multiselect"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}else if("checkbox"==d||"radio"==d){var g=c.find($(".controls"));g.find($("label")).remove(),g.append(e)}else if("select"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}}function extensionBinding(){var a=[];$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".allowedExtensions").val(b).change();var c=$("#fieldSettings_file_allowedExtensions").children().length;1>=c?$("#allowedExtensionsAlert").show():$("#allowedExtensionsAlert").hide(),1>c&&$(this).parent().after(addAllowedExtension())}function metadataBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){var c=$(this).prev("select").val();value=c+" : "+$(this).val(),a[b]=value});var b=a.join("%,%");$(".metadataStandard").val(b).change()}function titleField(){var a=$("#formSettings_objectTitleField"),b="";$("#formPreview").find($(":input[type=text]")).each(function(){var a=($(this).parent().parent().parent().next("div").find($("input[name^='label']")).val(),$(this).parent().parent().parent().next("div").find($("input[name^='name']")).val());"idno"===a||(b+="<option value='"+a+"'>"+a+"</option>")}),a.html(b)}function validateURL(a){var b=/^((https?|ftp):\/\/)?([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;return b.test(a)}function checkForSpaces(a){return/\s/g.test(a)}function removeHtml(a){return a.replace(/&/g,"&amp;").replace(/>/g,"").replace(/</g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"")}function isEmpty(a){return!a||0===a.length}function removeItemFromID(a,b){var c=b.selectedIndex;if(-1!=c){for(i=b.length-1;i>=0;i--)b.options[i].selected&&(b.options[i]=null);b.length>0&&(b.selectedIndex=0==c?0:c-1)}}function selectAllOnSubmit(a){var b=document.getElementById(a);if(null!=b)for(i=b.length-1;i>=0;i--)b.options[i].selected=!0}function entrySubmit(){return selectAllOnSubmit("selectedEntryUsers"),selectAllOnSubmit("selectedViewUsers"),selectAllOnSubmit("selectedUsersAdmins"),!0}function settingsBindings(){var a=$("#GroupingsPreview");$("#GroupingsPreview").on("click","li",function(b){b.stopPropagation(),$(this).hasClass("activeField well")||(a.find(".activeField").removeClass("activeField well"),$(this).addClass("activeField well"),showSettings($(this).prop("id")))}),$("#groupingsSettings_grouping").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val(),e=b.find(".groupingPreview"),f=e.find("i"),g=e.find("ul"),h=e.contents();h.slice(h.index(f)+1,h.index(g)).remove(),g.before(d),b.find("input[name^=nav_grouping_]").val(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_label").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").text(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_url").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").prop("href",d),$("#nav_url_"+c).val(d)})}function showSettings(a){if($("#groupingsSettings").children().hide(),$("#groupingTab a[href='#groupingsSettings']").tab("show"),void 0===a)$("#noGroupingSelected").show();else{var b=a.split("_")[1],c=$("#nav_type_"+b).val(),d=$("#nav_grouping_"+b);if("grouping"==c)$("#groupingsSettings_container_grouping").show(),$("#groupingsSettings_grouping").val(d.val()).keyup();else{switch(c){case"logout":case"link":$("#groupingsSettings_container_label").show(),$("#groupingsSettings_container_url").show();break;case"export":case"objectForm":case"metadataForm":$("#groupingsSettings_container_label").show()}if("objectForm"==c||"metadataForm"==c?$("#groupingsSettings_label").prop("disabled",!0):$("#groupingsSettings_label").removeAttr("disabled"),"grouping"!=c){var e=d.parents("li").parents("li");if(e.length>0){var f=e.prop("id").split("_")[1];d.val($("#nav_grouping_"+f).val())}else d.val("")}else $("#groupingsSettings_grouping").val(d.val());$("#groupingsSettings_label").val($("#nav_label_"+b).val()).keyup(),$("#groupingsSettings_url").val($("#nav_url_"+b).val()).keyup()}}}function addNew(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c={};$(a).data("type")&&(c.type=b=$(a).data("type"),c.label=$("a",a).text()),$(a).data("formid")&&(c.formID=$(a).data("formid"));var d=0;$("#GroupingsPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");d<=b[1]&&(d=parseInt(b[1])+1)}}),$(a).attr({id:"GroupingsPreview_"+d}).html('<div class="groupingPreview">'+newGroupingPreview(b,c)+'</div><div class="groupingValues">'+newGroupingValues(d,b,c)+"</div>"),$("#GroupingsPreview_"+d).click()}function newGroupingPreview(a,b){var c;return c='<i class="icon-remove"></i>',c+="New Grouping"==a||"grouping"==a?'<ul class="unstyled sortable"></ul>':void 0===b||null===b?'<a href="#">[Link]</a>':'<a href="'+(void 0!==b.url?b.url:"")+'">'+(void 0!==b.label?b.label:"Untitled")+"</a>"}function newGroupingValues(a,b,c){var d;switch(void 0===c&&(c={}),b){case"New Grouping":case"grouping":b=c.type="grouping";break;case"Log Out":case"logout":b=c.type="logout";break;case"Export Link":case"export":b=c.type="export";break;case"Link":case"link":b=c.type="link"}switch(d='<input type="hidden" id="nav_position_'+a+'" name="nav_position_'+a+'" value="'+(void 0!==c.position?c.position:"")+'">',d+='<input type="hidden" id="nav_type_'+a+'" name="nav_type_'+a+'" value="'+(void 0!==c.type?c.type:b)+'">',d+='<input type="hidden" id="nav_label_'+a+'" name="nav_label_'+a+'" value="'+(void 0!==c.label?c.label:"Untitled")+'">',d+='<input type="hidden" id="nav_url_'+a+'" name="nav_url_'+a+'" value="'+(void 0!==c.url?c.url:"")+'">',d+='<input type="hidden" id="nav_grouping_'+a+'" name="nav_grouping_'+a+'" value="'+(void 0!==c.grouping?c.grouping:"")+'">',b){case"objectForm":case"metadataForm":d+='<input type="hidden" id="nav_formID_'+a+'" name="nav_formID_'+a+'" value="'+(void 0!==c.formID?c.formID:"")+'">'}return d}function sortableNav(){$("#navigation ul.sortable").sortable({connectWith:"#navigation ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("New Grouping"==$(b.item).text()&&"GroupingsPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNew(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableNav()}})}function removeFormPreviewItem(a){if(confirm("Are you sure you want to remove this field?")){var b=a.parent().parent();"fieldset"==a.parent().next().children(":input[name^=type_]").val()&&b.after(a.next().find("li"));var c=$(".addFieldNav").parent();b.removeClass("well activeField").remove(),c.hasClass("active")||($(".addFieldNav").click().tab("show"),$("#formPreview li:first-child").trigger("click")),$("#formSettings_formMetadata").not(":checked")&&(0===$(":input[name^=type_][value=idno]",formPreview).length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}}function applyFormPreview(){var a;a="undefined"==typeof globalFieldID?$("#formPreview").children().find(".fieldPreview"):$("#formPreview_"+globalFieldID).find(".fieldPreview"),a.each(function(){var a=$(this).find(".fieldLabels"),b=$(this).find(".controls").children(),c=$(this).next(),d=c.find($('input[name^="placeholder"]')).val(),e=(c.find($('input[name^="type"]')).val(),
c.find($('input[name^="name"]')).val()),f=(c.find($('input[name^="style"]')).val(),c.find($('input[name^="label"]')).val()),g=c.find($('input[name^="id"]')).val(),h=c.find($('input[name^="class"]')).val(),i=c.find($('input[name^="value"]')).val(),j=c.find($('input[name^="disabled"')).val(),k=c.find($('input[name^="readonly"')).val();c.find($('input[name^="hidden"]')).val(),c.find($('input[name^="choicesOptions"]')).val(),c.find($('input[name^="choicesType"]')).val(),b.attr({placeholder:d,name:e,id:g,"class":h}),b.val(i),"true"===j||"true"===k?(b.prop("readonly",!0).addClass("disabled"),b.prop("disabled",!0).addClass("disabled")):(b.prop("readonly",!1).removeClass("disabled"),b.prop("disabled",!1).removeClass("disabled")),i.length&&b.val(i),a.html(f)})}function sortableForm(){$("#formCreator ul.sortable").sortable({connectWith:"#formCreator ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("Field Set"==$(b.item).text()&&"formPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNewField(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableForm()}}),calculatePosition()}function calculatePosition(){$("#formCreator ul.sortable").children("li").each(function(a){$(this).attr("data-position",a),$(this).find("[data-bind='position']").val(a)})}function showFieldSettings(a){var b=$("#fieldSettings_form"),c=$("#fieldSettings_fieldset_form");if(void 0===a)$("#noFieldSelected").show(),c.hide(),b.hide();else{var d,e,f,g=a,h=$("#type_"+g).val(),i=$("#fieldset_"+g);if($("#noFieldSelected").hide(),"fieldset"==h)c.show(),b.hide();else{c.hide(),b.show(),b.find(".dataSettings").children().hide(),b.find(".default").show();var j=$("#fieldSettings_name"),k=$("#fieldSettings_options_required"),l=$("#fieldSettings_options_duplicates"),m=$("#fieldSettings_options_displayTable"),n=$("#fieldSettings_options_readonly"),o=$("#fieldSettings_options_disabled");switch("idno"==h?(j.prop("readonly",!0).val("idno").keyup(),k.prop({checked:!0,disabled:!0}).change(),l.prop({checked:!0,disabled:!0}).change(),m.prop({checked:!0,disabled:!0}).change(),n.prop({checked:!0,disabled:!0}).change(),o.prop({checked:!1,disabled:!0}).change()):"file"==h?m.removeAttr("checked").change().prop("disabled",!0):(j.removeAttr("readonly"),k.removeAttr("disabled"),l.removeAttr("disabled"),n.removeAttr("disabled"),o.removeAttr("disabled"),m.removeAttr("disabled")),h){case"idno":$("#fieldSettings_container_idno").parent().show();break;case"text":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_externalUpdate").parent().hide(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"textarea":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"radio":case"checkbox":case"select":case"multiselect":$("#fieldSettings_container_choices").parent().show();break;case"number":$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().show(),$("#fieldSettings_range_format").parent().removeClass("span6").addClass("span4"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="value">Value</option><option value="digits">Digits</option>');break;case"wysiwyg":$("#fieldSettings_container_placeholder").hide(),$("#fieldSettings_container_value").hide();break;case"file":$("#fieldSettings_container_file_allowedExtensions").parent().show(),$("#fieldSettings_container_file_options").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;default:$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show()}var p=$("#choicesOptions_"+g).val();if(void 0!==p){var q=$("#fieldSettings_choices_manual");for(d=p.split("%,%"),e="",f=0;f<d.length;f++)e+=addChoice(d[f],$("#choicesDefault_"+g).val());q.html(e).find("input[name=fieldSettings_choices_text]").keyup()}var r=$("#allowedExtensions_"+g).val();if(void 0!==r){var s=$("#fieldSettings_file_allowedExtensions");for(d=r.split("%,%"),e="",s.html(""),f=0;f<d.length;f++)e+=addAllowedExtension(d[f]);s.append(e),s.find(":input[name=fieldSettings_allowedExtension_text]:first").keyup()}var t=$("#metadataStandard_"+g).val();if(void 0!==t){var u=$("#metadataStandard_options");for(d=t.split("%,%"),e="",u.html(""),f=0;f<d.length;f++)e+=addMetadataStandard(d[f]);u.append(e),$(".mdStandardSelect").each(function(){var a=$(this).data("selectvalue");$(this).val(a)})}if("fieldset"!=h){var v=i.parents("li").parents("li");if(v.length>0){var w=v.prop("id").split("_")[1];i.val($("#fieldset_"+w).val())}else i.val("")}else $("#fieldSettings_fieldset").val(i.val());-1!=$.inArray(h,["idno","text","textarea","date","time","wysiwyg"])?$("#fieldVariablesLink").show():$("#fieldVariablesLink").hide(),$("#fieldSettings_externalUpdate_formSelect").change(function(){var a=$(this).val();void 0===choicesFields[a]&&(choicesFields[a]="",$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var b=JSON.parse(a);$.each(b,function(a,b){var c="";$.each(b,function(a,b){c+='<option value="'+b.name+'">'+b.label+"</option>"}),choicesFields[a]=c})})),$("#externalUpdateForm_"+g).val(a).change(),$("#fieldSettings_externalUpdate_fieldSelect").html(choicesFields[a]).change()}),$(".uxOptions").find("input").change(function(){var a=$(this).data("bindmodel"),b=$("."+a);$(this).is(":checked")||$(this).value?b.show():b.hide()}),enableChoiceFunctionality()}}}function fieldSettingsBindings(){var a=$("#formPreview");a.children("li").removeClass("activeField"),$("#fieldSettings_form").find("[data-bindmodel]").bind("change keyup",bindToHiddenForm),a.on("click","li",function(b){if(b.stopPropagation(),$(b.target).is(".icon-remove"))console.log($(this)),removeFormPreviewItem($(b.target));else{var c=$(this).data("id");globalFieldID=c,a.find("[data-bind]").bind("change",setOriginalValues),$(this).hasClass("activeField")||(a.find(".activeField").removeClass("activeField"),$(this).addClass("activeField"),$("#fieldTab a[href='#fieldSettings']").tab("show"),showFieldSettings(c),setInitialBind(),applyFormPreview())}})}function setInitialBind(){var a=globalFieldID;if("undefined"!=typeof a){var b=$("#formPreview").find("[data-id='"+a+"']"),c=b.find(".fieldValues");c.find("[data-bind]").change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues)}}function setOriginalValues(){var a=globalFieldID,b=$(this).data("bind"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#fieldSettings_form").find("[data-bindmodel='"+b+"']"),e=$("#formPreview").find("[data-id='"+a+"']"),f=e.find(".fieldPreview");if("name"==b&&(c=$.trim(c),evaluateSpace(c,d)),"idnoFormat"==b&&(idnoValues.idnoFormat=c),"startIncrement"==b&&(idnoValues.startIncrement=c),"help"==b){var g=c.split("|")[0],h=c.split("|")[1],c="undefined"==h?"":h;$(this).val(g+"|"+h),$("#fieldSettings_help_textarea").val(c).hide(),$("#fieldSettings_help_url").hide().val(c),$("#fieldSettings_help_type").val(g).change()}d.is("input[type=checkbox]")?"true"==c?d.prop("checked",!0):d.prop("checked",!1):d.is("select")?d.find('option[value="'+c+'"]').prop("selected",!0):d.is("input[type=number]")?d.val(parseInt(c)):d.val(c),d.is($("#fieldSettings_choices_type"))&&("manual"==c?($("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide()):($("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show())),"managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"validation"==b&&("regexp"==c?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide()),"choicesForm"==b&&("null"==c||void 0==c?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error"))),"choicesDefault"==b&&$('input[value="'+c+'"]').prev().addClass("active"),"choicesField"==b&&($("#fieldSettings_choices_formSelect").change(),$("#fieldSettings_choices_fieldSelect").val(c).change())}function bindToHiddenForm(){var a=globalFieldID;if("undefined"!=typeof a){var b=$(this).data("bindmodel"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#formPreview").find("[data-id='"+a+"']"),e=($("#formPreview_"+a).find(".fieldLabels"),d.find(".fieldValues")),f=d.find(".fieldPreview");if(e.find("[data-bind='"+b+"']").val(c),"name"==b&&(evaluateSpace(c,$(this)),titleField()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"choicesType"==b)if("manual"==c)$("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide(),$("#choicesForm_"+a).val("");else{$("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show();var g=e.find($('input[name^="type"]')).val();"multiselect"==g?f.find(".controls").find($("select")).html():"checkbox"==g||"radio"==g?f.find(".controls").find($("label")).remove():"select"==g&&f.find($(".controls")).find($("select")).html(output)}if("managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"idnoFormat"==b||"startIncrement"==b||"idnoConfirm"==b){$("#fieldSettings_container_idno_confirm").removeClass("hidden").show();var h=$("#fieldSettings_idno_confirm").is(":checked");h===!1&&idnoValues.idnoFormat?$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled")}if("validation"==b){var i=$("#fieldSettings_validation").val();"regexp"===i?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide().val("")}if(("helpText"==b||"helpURL"==b)&&formatHelpForHiddenField(e),"helpType"==b){switch($(this).val()){case"text":case"html":$("#fieldSettings_help_textarea").show().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden");break;case"web":$("#fieldSettings_help_url").show().removeClass("hidden"),$("#fieldSettings_help_textarea").hide().removeClass("hidden");break;case"none":case"default":$("#fieldSettings_help_textarea").hide().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden")}formatHelpForHiddenField(e)}applyFormPreview()}}function formatHelpForHiddenField(a){var b,c=$("#fieldSettings_help_type").val(),d=globalFieldID;"text"==c||"html"==c?(b=$("#fieldSettings_help_textarea").val().sanitizeInput().escapeHtml(),console.log(b)):(b=$("#fieldSettings_help_url").val(),console.log(b),validateURL(b)?$("#fieldSettings_help_url").removeClass("has-error"):$("#fieldSettings_help_url").addClass("has-error"));var e=c+"|"+b;$("#fieldSettings_help_text").val(e),a.find("[data-bind='help']").val(e),$(".helpPreview").popover("destroy"),$(".helpPreview").hide(),"html"===c||"text"===c?($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help",content:"<div>"+b+"</div>",trigger:"click",html:!0})):"web"===c&&($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help Url",content:'<div><a href="'+b+'">'+b+"</a></div>",trigger:"click",html:!0}))}function evaluateSpace(a,b){checkForSpaces(a)?(b.addClass("has-error testy"),$(".noSpacesAlert").show(),$("input[type=submit]").addClass("disabled").attr("disabled",!0)):(b.removeClass("has-error"),$("input[type=submit]").removeClass("disabled").removeAttr("disabled"),$(".noSpacesAlert").hide())}function getFormFields(){var a="";return $.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(b){var c=JSON.parse(b);$.each(c,function(b,c){$.each(c,function(b,c){a+='<option value="'+c.name+'">'+c.label+"</option>"})})}),a}function evaluateCheck(a){return a.is(":checked")?!0:!1}function formSettingsBindings(){$("#formTitle").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formTitle").focus()}),$("#formSettings_formTitle").keyup(function(){$("#formTitle").html($(this).val()),0!==$(this).val().length?$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled")}).keyup(),$("#formDescription").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formDescription").focus()}),$("#formSettings_formDescription").keyup(function(){$("#formDescription").html($(this).val())}).keyup(),$("#formSettings_formMetadata").change(function(){var a=$("#fieldAdd"),b=$("#formPreview").find("input[name^=type_][value=idno]");$(this).is(":checked")?($("#formSettings_linkTitle_container").show(),0===b.length?($("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):confirm("Enabling this will remove any existing ID Number fields. Do you want to continue?")?(b.parent().parent().remove(),$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):$(this).removeAttr("checked")):($("#formSettings_linkTitle_container").hide(),a.find("li:contains('ID Number')").show(),a.find("li:contains('Paragraph Text')").show(),a.find("li:contains('Radio')").show(),a.find("li:contains('Checkboxes')").show(),a.find("li:contains('Dropdown')").show(),a.find("li:contains('Multi-Select')").show(),a.find("li:contains('File Upload')").show(),a.find("li:contains('WYSIWYG')").show(),a.find("li:contains('Field Set')").parent().show().prev().show(),0===b.length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}).change()}function modalBindings(){$("#formTypeSelector").modal({show:!1,keyboard:!1,backdrop:"static"}).on("click","button:contains('Metadata')",function(){$(".nav-tabs li:nth-child(3) a").click(),$("#formSettings_formMetadata").prop("checked",!0).change(),$("#formTypeSelector").modal("hide")}).on("click","button:contains('Object')",function(){var a=$("#fieldAdd"),b=($("#formPreview .well"),$("#fieldSettings_label")),c=$("#fieldSettings_options_sortable"),d=$("#fieldSettings_options_searchable");a.find("li:contains('ID Number')").click(),b.val("IDNO").keyup(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),a.find("li:contains('Single Line Text')").click(),$("#fieldSettings_name").val("title").keyup(),b.val("Title").keyup(),$("#fieldSettings_options_required").prop("checked",!0).change(),$("#fieldSettings_options_duplicates").prop("checked",!0).change(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),$("#fieldSettings_options_displayTable").prop("checked",!0).change(),$("#fieldTab li:last a").click(),$("#formPreview li").removeClass("activeField"),$("#formSettings_formMetadata").removeAttr("checked").change(),$("#formTypeSelector").modal("hide"),$("#formSettings_formTitle")})}function addNewField(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c=0;$("#formPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");c<=b[1]&&(c=parseInt(b[1])+1)}}),$(a).attr({id:"formPreview_"+c,"data-id":c}).html('<div class="fieldPreview">'+newFieldPreview(c,b)+'</div><div class="fieldValues">'+newFieldValues(c,b)+"</div>"),$("#formPreview_"+c).click(),$("#formSettings_formMetadata").not(":checked")&&(0===$("#formPreview").find("input[name^=type_][value=idno]").length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}function newFieldPreview(a,b,c){var d="";if(void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.choicesOptions="First Choice%,%Second Choice",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),("idno"!=b&&"ID Number"!=b||0!==numIDNOs)&&(d+='<i class="icon-remove"></i>'),d+='<span class="fa fa-question-circle helpPreview"></span>',"Field Set"==b||"fieldset"==b)d+='<fieldset><legend></legend><ul class="unstyled sortable"></ul></fieldset>';else{switch(d+='<div class="control-group"><label class="control-label fieldLabels">Untitled</label><div class="controls">',b){case"ID Number":case"idno":case"Single Line Text":case"text":d+='<input type="text">',numIDNOs++;break;case"Paragraph Text":case"textarea":d+="<textarea></textarea>";break;case"Radio":case"radio":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="radio" checked> '+b+"</label>":'<label> <input type="radio"> '+b+"</label>"})}else d+='<label class="radio"><input type="radio">First Choice</label><label class="radio"><input type="radio">Second Choice</label>';break;case"Checkboxes":case"checkbox":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="checkbox" checked> '+b+"</label>":'<label> <input type="checkbox"> '+b+"</label>"})}else d+='<label class="checkbox"><input type="checkbox">First Choice</label><label class="checkbox"><input type="checkbox">Second Choice</label>';break;case"Dropdown":case"select":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+="<select>",$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+="<select></select>";break;case"Number":case"number":d+='<input type="number">';break;case"Email":case"email":d+='<input type="email">';break;case"Phone":case"tel":d+='<input type="tel">';break;case"Date":case"date":d+='<input type="date">';break;case"Time":case"time":d+='<input type="time">';break;case"Website":case"url":d+='<input type="url">';break;case"Multi-Select":case"multiselect":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+='<select multiple></select><br><select class="selectPreview">',$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+='<select multiple></select><br><select class="selectPreview"></select>';break;case"WYSIWYG":case"wysiwyg":d+='<img src="../includes/img/wysiwyg.png">';break;case"File Upload":case"file":d+='<input type="file" disabled>'}d+="</div></div>"}return d}function newFieldValues(a,b,c){var d="";void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),c.type=determineType(b),b=c.type;var e=["name","position","type","label","value","placeholder","id","class","style","help","helpType","required","duplicates","readonly","disabled","disabledInsert","disabledUpdate","publicRelease","sortable","searchable","displayTable","hidden","validation","validationRegex","access","fieldset","metadataStandard"];switch(d+=createHiddenFields(e,a,c),b){case"idno":var f=["managedBy","idnoFormat"];d+=createHiddenFields(f,a,c),d+='<input type="hidden" id="startIncrement_'+a+'" name="startIncrement_'+a+'"   data-bind="startIncrement"    value="'+(void 0!==c.startIncrement?c.startIncrement:"1")+'">',d+='<input type="hidden" id="idnoConfirm_'+a+'"    name="idnoConfirm_'+a+'"      data-bind"idnoConfirm"        value="false">';break;case"text":var g=["externalUpdateForm","externalUpdateField","min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"textarea":case"number":var g=["min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"radio":case"checkbox":case"select":case"multiselect":var h=["choicesType","choicesNull","choicesDefault","choicesForm","choicesField","choicesFieldDefault"];d+=createHiddenFields(h,a,c),d+='<input type="hidden" id="choicesOptions_'+a+'" name="choicesOptions_'+a+'" data-bind="choicesOptions" value="'+(void 0!==c.choicesOptions?c.choicesOptions:"First Choice%,%Second Choice")+'">';break;case"file":var i=["bgProcessing","multipleFiles","combine","ocr","convert","convertHeight","convertWidth","watermark","watermarkImage","watermarkLocation","border","borderHeight","borderWidth","borderColor","thumbnail","convertAudio","bitRate","audioFormat","convertVideo","videoHeight","videoWidth","videobitRate","aspectRatio","videoFormat","videothumbnail","videoThumbFrames","videoThumbHeight","videoThumbWidth","videoFormatThumb"];d+=createHiddenFields(i,a,c),d+='<input type="hidden" id="allowedExtensions_'+a+'" name="allowedExtensions_'+a+'"     data-bind="allowedExtensions"    value="'+(void 0!==c.allowedExtensions?c.allowedExtensions:"tif%,%tiff%,%jpg")+'">',d+='<input type="hidden" id="convertResolution_'+a+'" name="convertResolution_'+a+'"     data-bind="convertResolution"    value="'+(void 0!==c.convertResolution?c.convertResolution:"192")+'">',d+='<input type="hidden" id="convertFormat_'+a+'"     name="convertFormat_'+a+'"         data-bind="convertFormat"        value="'+(void 0!==c.convertFormat?c.convertFormat:"JPG")+'">',d+='<input type="hidden" id="thumbnailHeight_'+a+'"   name="thumbnailHeight_'+a+'"       data-bind="thumbnailHeight"      value="'+(void 0!==c.thumbnailHeight?c.thumbnailHeight:"150")+'">',d+='<input type="hidden" id="thumbnailWidth_'+a+'"    name="thumbnailWidth_'+a+'"        data-bind="thumbnailWidth"       value="'+(void 0!==c.thumbnailWidth?c.thumbnailWidth:"150")+'">',d+='<input type="hidden" id="thumbnailFormat_'+a+'"   name="thumbnailFormat_'+a+'"       data-bind="thumbnailFormat"      value="'+(void 0!==c.thumbnailFormat?c.thumbnailFormat:"JPG")+'">',d+='<input type="hidden" id="help_'+a+'"   name="help_'+a+'"       data-bind="help"      value="'+(void 0!==c.help?c.help:"none|")+'">'}return d}function determineValidation(a){switch(a){case"Number":case"number":return"integer";case"Email":case"email":return"emailAddr";case"Phone":case"tel":return"phoneNumber";case"Date":case"date":return"date";case"Website":case"url":return"url";default:return}}function determineType(a){switch(a){case"ID Number":case"idno":return"idno";case"Single Line Text":case"text":return"text";case"Paragraph Text":case"textarea":return"textarea";case"Radio":case"radio":return"radio";case"Checkboxes":case"checkbox":return"checkbox";case"Dropdown":case"select":return"select";case"Number":case"number":return"number";case"Email":case"email":return"email";case"Phone":case"tel":return"tel";case"Date":case"date":return"date";case"Time":case"time":return"time";case"Website":case"url":return"url";case"Multi-Select":case"multiselect":return"multiselect";case"WYSIWYG":case"wysiwyg":return"wysiwyg";case"File Upload":case"file":return"file";case"Field Set":case"fieldset":return"fieldset";default:return}}function createHiddenFields(a,b,c){return output="",$.each(a,function(a,d){var e=d+"_"+b,f=void 0!==c[d]?c[d]:"";output+='<input type="hidden" id="'+e+'" name="'+e+'" data-bind="'+d+'" value="'+f+'"/>'}),output}function addChoice(a,b){return"undefined"==typeof a?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':"undefined"==typeof b?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn'+(a==b?" active":"")+'" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>'}function addAllowedExtension(a){return"undefined"==typeof a&&(a=""),'<div class="row-fluid input-append extensionItem" data-itemtype="extension"><input name="fieldSettings_allowedExtension_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add an extension."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this extension."><i class="icon-remove"></i></button></div>'}function addMetadataStandard(a){"undefined"==typeof a&&(a="");var b=metadataSchema,c=a.split(" : ")[1],d=a.split(" : ")[0];"undefined"==typeof c&&(c=""),"undefined"==typeof d&&(d="");var e='<select class="input-block-level form-control mdStandardSelect" id="fieldSettings_standardType" name="fieldSettings_standardType" data-selectvalue="'+d+'"><option value=""> None </option>'+b+"</select>";return'<div class="row-fluid input-append metadata-item" data-itemtype="metadataStandard">'+e+'<input name="fieldSettings_metadataIdentifer" type="text" value="'+c+'"><button name="add" class="btn" type="button" title="Add Metadata Standard"><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove Metadata Standard"><i class="icon-remove"></i></button></div>'}function enableChoiceFunctionality(){$(".choicesItem").find($("input[type=text], select")).bind("change keyup",modifyChoiceBinding).change(),$(".extensionItem").find($("input[type=text], select")).bind("change keyup",extensionBinding).change(),$(".metadata-item").find($("input[type=text], select")).bind("change keyup",metadataBinding).change(),$("#fieldSettings_choices_null").change(function(){$(".input-append").find("input[type=text]").change()}),$(".input-append").find("button").click(function(){var a=$(this).attr("name"),b=$(this).parent().data("itemtype");if("add"==a)"choice"==b?$(this).parent().after(addChoice()):"extension"==b?$(this).parent().after(addAllowedExtension()):$(this).parent().after(addMetadataStandard()),$(".input-append").find("button").unbind("click"),enableChoiceFunctionality();else if("remove"==a)$(this).parent().remove(),$(".input-append").find($("input[type=text]")).change();else if("default"==a){var c=$(this).next().val(),d=globalFieldID;$("#choicesDefault_"+d).val(c),$('button[name="default"]').removeClass("active"),$(this).hasClass("focus")&&$(this).addClass("selected")}}),$("#fieldSettings_choices_formSelect").change(function(){var a=$(this).val();if("null"==a?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error")),void 0===choicesFields[a]){var b;choicesFields[null]=b,$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var c=JSON.parse(a);$.each(c,function(a,c){b="<option value> Select A Field</option>",$.each(c,function(a,c){b+='<option value="'+c.name+'">'+c.label+"</option>"}),choicesFields[a]=b})})}$("#fieldSettings_choices_fieldSelect").html(choicesFields[a])})}function modifyChoiceBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".choicesOptions").val(b).change(),$("#fieldSettings_choices_null").is(":checked")&&a.unshift("Make A Selection");for(var c=$("#formPreview_"+globalFieldID),d=c.find($("#type_"+globalFieldID)).val(),e="",f=0;f<a.length;f++)"multiselect"==d||"select"==d?e+="<option value='"+a[f]+"'>"+a[f]+"</option>":"checkbox"==d?e+="<label for='checkbox'><input type='checkbox'/>"+a[f]+"</label>":"radio"==d&&(e+="<label for='checkbox'><input type='radio'/>"+a[f]+"</label>");if("multiselect"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}else if("checkbox"==d||"radio"==d){var g=c.find($(".controls"));g.find($("label")).remove(),g.append(e)}else if("select"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}}function extensionBinding(){var a=[];$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".allowedExtensions").val(b).change();var c=$("#fieldSettings_file_allowedExtensions").children().length;1>=c?$("#allowedExtensionsAlert").show():$("#allowedExtensionsAlert").hide(),1>c&&$(this).parent().after(addAllowedExtension())}function metadataBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){var c=$(this).prev("select").val();value=c+" : "+$(this).val(),a[b]=value});var b=a.join("%,%");$(".metadataStandard").val(b).change()}function titleField(){var a=$("#formSettings_objectTitleField"),b="";$("#formPreview").find($(":input[type=text]")).each(function(){var a=($(this).parent().parent().parent().next("div").find($("input[name^='label']")).val(),$(this).parent().parent().parent().next("div").find($("input[name^='name']")).val());"idno"===a||(b+="<option value='"+a+"'>"+a+"</option>")}),a.html(b)}function validateURL(a){var b=/^((https?|ftp):\/\/)?([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;
return b.test(a)}function checkForSpaces(a){return/\s/g.test(a)}function removeHtml(a){return a.replace(/&/g,"&amp;").replace(/>/g,"").replace(/</g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"")}function isEmpty(a){return!a||0===a.length}function removeItemFromID(a,b){var c=b.selectedIndex;if(-1!=c){for(i=b.length-1;i>=0;i--)b.options[i].selected&&(b.options[i]=null);b.length>0&&(b.selectedIndex=0==c?0:c-1)}}function selectAllOnSubmit(a){var b=document.getElementById(a);if(null!=b)for(i=b.length-1;i>=0;i--)b.options[i].selected=!0}function entrySubmit(){return selectAllOnSubmit("selectedEntryUsers"),selectAllOnSubmit("selectedViewUsers"),selectAllOnSubmit("selectedUsersAdmins"),!0}function settingsBindings(){var a=$("#GroupingsPreview");$("#GroupingsPreview").on("click","li",function(b){b.stopPropagation(),$(this).hasClass("activeField well")||(a.find(".activeField").removeClass("activeField well"),$(this).addClass("activeField well"),showSettings($(this).prop("id")))}),$("#groupingsSettings_grouping").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val(),e=b.find(".groupingPreview"),f=e.find("i"),g=e.find("ul"),h=e.contents();h.slice(h.index(f)+1,h.index(g)).remove(),g.before(d),b.find("input[name^=nav_grouping_]").val(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_label").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").text(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_url").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").prop("href",d),$("#nav_url_"+c).val(d)})}function showSettings(a){if($("#groupingsSettings").children().hide(),$("#groupingTab a[href='#groupingsSettings']").tab("show"),void 0===a)$("#noGroupingSelected").show();else{var b=a.split("_")[1],c=$("#nav_type_"+b).val(),d=$("#nav_grouping_"+b);if("grouping"==c)$("#groupingsSettings_container_grouping").show(),$("#groupingsSettings_grouping").val(d.val()).keyup();else{switch(c){case"logout":case"link":$("#groupingsSettings_container_label").show(),$("#groupingsSettings_container_url").show();break;case"export":case"objectForm":case"metadataForm":$("#groupingsSettings_container_label").show()}if("objectForm"==c||"metadataForm"==c?$("#groupingsSettings_label").prop("disabled",!0):$("#groupingsSettings_label").removeAttr("disabled"),"grouping"!=c){var e=d.parents("li").parents("li");if(e.length>0){var f=e.prop("id").split("_")[1];d.val($("#nav_grouping_"+f).val())}else d.val("")}else $("#groupingsSettings_grouping").val(d.val());$("#groupingsSettings_label").val($("#nav_label_"+b).val()).keyup(),$("#groupingsSettings_url").val($("#nav_url_"+b).val()).keyup()}}}function addNew(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c={};$(a).data("type")&&(c.type=b=$(a).data("type"),c.label=$("a",a).text()),$(a).data("formid")&&(c.formID=$(a).data("formid"));var d=0;$("#GroupingsPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");d<=b[1]&&(d=parseInt(b[1])+1)}}),$(a).attr({id:"GroupingsPreview_"+d}).html('<div class="groupingPreview">'+newGroupingPreview(b,c)+'</div><div class="groupingValues">'+newGroupingValues(d,b,c)+"</div>"),$("#GroupingsPreview_"+d).click()}function newGroupingPreview(a,b){var c;return c='<i class="icon-remove"></i>',c+="New Grouping"==a||"grouping"==a?'<ul class="unstyled sortable"></ul>':void 0===b||null===b?'<a href="#">[Link]</a>':'<a href="'+(void 0!==b.url?b.url:"")+'">'+(void 0!==b.label?b.label:"Untitled")+"</a>"}function newGroupingValues(a,b,c){var d;switch(void 0===c&&(c={}),b){case"New Grouping":case"grouping":b=c.type="grouping";break;case"Log Out":case"logout":b=c.type="logout";break;case"Export Link":case"export":b=c.type="export";break;case"Link":case"link":b=c.type="link"}switch(d='<input type="hidden" id="nav_position_'+a+'" name="nav_position_'+a+'" value="'+(void 0!==c.position?c.position:"")+'">',d+='<input type="hidden" id="nav_type_'+a+'" name="nav_type_'+a+'" value="'+(void 0!==c.type?c.type:b)+'">',d+='<input type="hidden" id="nav_label_'+a+'" name="nav_label_'+a+'" value="'+(void 0!==c.label?c.label:"Untitled")+'">',d+='<input type="hidden" id="nav_url_'+a+'" name="nav_url_'+a+'" value="'+(void 0!==c.url?c.url:"")+'">',d+='<input type="hidden" id="nav_grouping_'+a+'" name="nav_grouping_'+a+'" value="'+(void 0!==c.grouping?c.grouping:"")+'">',b){case"objectForm":case"metadataForm":d+='<input type="hidden" id="nav_formID_'+a+'" name="nav_formID_'+a+'" value="'+(void 0!==c.formID?c.formID:"")+'">'}return d}function sortableNav(){$("#navigation ul.sortable").sortable({connectWith:"#navigation ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("New Grouping"==$(b.item).text()&&"GroupingsPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNew(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableNav()}})}function removeFormPreviewItem(a){if(confirm("Are you sure you want to remove this field?")){var b=a.parent().parent();"fieldset"==a.parent().next().children(":input[name^=type_]").val()&&b.after(a.next().find("li"));var c=$(".addFieldNav").parent();b.removeClass("well activeField").remove(),c.hasClass("active")||($(".addFieldNav").click().tab("show"),$("#formPreview li:first-child").trigger("click")),$("#formSettings_formMetadata").not(":checked")&&(0===$(":input[name^=type_][value=idno]",formPreview).length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}}function applyFormPreview(){var a;a="undefined"==typeof globalFieldID?$("#formPreview").children().find(".fieldPreview"):$("#formPreview_"+globalFieldID).find(".fieldPreview"),a.each(function(){var a=$(this).find(".fieldLabels"),b=$(this).find(".controls").children(),c=$(this).next(),d=c.find($('input[name^="placeholder"]')).val(),e=(c.find($('input[name^="type"]')).val(),c.find($('input[name^="name"]')).val()),f=(c.find($('input[name^="style"]')).val(),c.find($('input[name^="label"]')).val()),g=c.find($('input[name^="id"]')).val(),h=c.find($('input[name^="class"]')).val(),i=c.find($('input[name^="value"]')).val(),j=c.find($('input[name^="disabled"')).val(),k=c.find($('input[name^="readonly"')).val();c.find($('input[name^="hidden"]')).val(),c.find($('input[name^="choicesOptions"]')).val(),c.find($('input[name^="choicesType"]')).val(),b.attr({placeholder:d,name:e,id:g,"class":h}),b.val(i),"true"===j||"true"===k?(b.prop("readonly",!0).addClass("disabled"),b.prop("disabled",!0).addClass("disabled")):(b.prop("readonly",!1).removeClass("disabled"),b.prop("disabled",!1).removeClass("disabled")),i.length&&b.val(i),a.html(f)})}function sortableForm(){$("#formCreator ul.sortable").sortable({connectWith:"#formCreator ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("Field Set"==$(b.item).text()&&"formPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNewField(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableForm()}}),calculatePosition()}function calculatePosition(){$("#formCreator ul.sortable").children("li").each(function(a){$(this).attr("data-position",a),$(this).find("[data-bind='position']").val(a)})}function showFieldSettings(a){var b=$("#fieldSettings_form"),c=$("#fieldSettings_fieldset_form");if(void 0===a)$("#noFieldSelected").show(),c.hide(),b.hide();else{var d,e,f,g=a,h=$("#type_"+g).val(),i=$("#fieldset_"+g);if($("#noFieldSelected").hide(),"fieldset"==h)c.show(),b.hide();else{c.hide(),b.show(),b.find(".dataSettings").children().hide(),b.find(".default").show();var j=$("#fieldSettings_name"),k=$("#fieldSettings_options_required"),l=$("#fieldSettings_options_duplicates"),m=$("#fieldSettings_options_displayTable"),n=$("#fieldSettings_options_readonly"),o=$("#fieldSettings_options_disabled");switch("idno"==h?(j.prop("readonly",!0).val("idno").keyup(),k.prop({checked:!0,disabled:!0}).change(),l.prop({checked:!0,disabled:!0}).change(),m.prop({checked:!0,disabled:!0}).change(),n.prop({checked:!0,disabled:!0}).change(),o.prop({checked:!1,disabled:!0}).change()):"file"==h?m.removeAttr("checked").change().prop("disabled",!0):(j.removeAttr("readonly"),k.removeAttr("disabled"),l.removeAttr("disabled"),n.removeAttr("disabled"),o.removeAttr("disabled"),m.removeAttr("disabled")),h){case"idno":$("#fieldSettings_container_idno").parent().show();break;case"text":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_externalUpdate").parent().hide(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"textarea":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"radio":case"checkbox":case"select":case"multiselect":$("#fieldSettings_container_choices").parent().show();break;case"number":$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().show(),$("#fieldSettings_range_format").parent().removeClass("span6").addClass("span4"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="value">Value</option><option value="digits">Digits</option>');break;case"wysiwyg":$("#fieldSettings_container_placeholder").hide(),$("#fieldSettings_container_value").hide();break;case"file":$("#fieldSettings_container_file_allowedExtensions").parent().show(),$("#fieldSettings_container_file_options").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;default:$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show()}var p=$("#choicesOptions_"+g).val();if(void 0!==p){var q=$("#fieldSettings_choices_manual");for(d=p.split("%,%"),e="",f=0;f<d.length;f++)e+=addChoice(d[f],$("#choicesDefault_"+g).val());q.html(e).find("input[name=fieldSettings_choices_text]").keyup()}var r=$("#allowedExtensions_"+g).val();if(void 0!==r){var s=$("#fieldSettings_file_allowedExtensions");for(d=r.split("%,%"),e="",s.html(""),f=0;f<d.length;f++)e+=addAllowedExtension(d[f]);s.append(e),s.find(":input[name=fieldSettings_allowedExtension_text]:first").keyup()}var t=$("#metadataStandard_"+g).val();if(void 0!==t){var u=$("#metadataStandard_options");for(d=t.split("%,%"),e="",u.html(""),f=0;f<d.length;f++)e+=addMetadataStandard(d[f]);u.append(e),$(".mdStandardSelect").each(function(){var a=$(this).data("selectvalue");$(this).val(a)})}if("fieldset"!=h){var v=i.parents("li").parents("li");if(v.length>0){var w=v.prop("id").split("_")[1];i.val($("#fieldset_"+w).val())}else i.val("")}else $("#fieldSettings_fieldset").val(i.val());-1!=$.inArray(h,["idno","text","textarea","date","time","wysiwyg"])?$("#fieldVariablesLink").show():$("#fieldVariablesLink").hide(),$("#fieldSettings_externalUpdate_formSelect").change(function(){var a=$(this).val();void 0===choicesFields[a]&&(choicesFields[a]="",$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var b=JSON.parse(a);$.each(b,function(a,b){var c="";$.each(b,function(a,b){c+='<option value="'+b.name+'">'+b.label+"</option>"}),choicesFields[a]=c})})),$("#externalUpdateForm_"+g).val(a).change(),$("#fieldSettings_externalUpdate_fieldSelect").html(choicesFields[a]).change()}),$(".uxOptions").find("input").change(function(){var a=$(this).data("bindmodel"),b=$("."+a);$(this).is(":checked")||$(this).value?b.show():b.hide()}),enableChoiceFunctionality()}}}function fieldSettingsBindings(){var a=$("#formPreview");a.children("li").removeClass("activeField"),$("#fieldSettings_form").find("[data-bindmodel]").bind("change keyup",bindToHiddenForm),a.on("click","li",function(b){if(b.stopPropagation(),$(b.target).is(".icon-remove"))console.log($(this)),removeFormPreviewItem($(b.target));else{var c=$(this).data("id");globalFieldID=c,a.find("[data-bind]").bind("change",setOriginalValues),$(this).hasClass("activeField")||(a.find(".activeField").removeClass("activeField"),$(this).addClass("activeField"),$("#fieldTab a[href='#fieldSettings']").tab("show"),showFieldSettings(c),setInitialBind(),applyFormPreview())}})}function setInitialBind(){var a=globalFieldID;if("undefined"!=typeof a){var b=$("#formPreview").find("[data-id='"+a+"']"),c=b.find(".fieldValues");c.find("[data-bind]").change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues)}}function setOriginalValues(){var a=globalFieldID,b=$(this).data("bind"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#fieldSettings_form").find("[data-bindmodel='"+b+"']"),e=$("#formPreview").find("[data-id='"+a+"']"),f=e.find(".fieldPreview");if("name"==b&&(c=$.trim(c),evaluateSpace(c,d)),"idnoFormat"==b&&(idnoValues.idnoFormat=c),"startIncrement"==b&&(idnoValues.startIncrement=c),"help"==b){var g=c.split("|")[0],h=c.split("|")[1],c="undefined"==h?"":h;$(this).val(g+"|"+h),$("#fieldSettings_help_textarea").val(c).hide(),$("#fieldSettings_help_url").hide().val(c),$("#fieldSettings_help_type").val(g).change()}d.is("input[type=checkbox]")?"true"==c?d.prop("checked",!0):d.prop("checked",!1):d.is("select")?d.find('option[value="'+c+'"]').prop("selected",!0):d.is("input[type=number]")?d.val(parseInt(c)):d.val(c),d.is($("#fieldSettings_choices_type"))&&("manual"==c?($("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide()):($("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show())),"managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"validation"==b&&("regexp"==c?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide()),"choicesForm"==b&&("null"==c||void 0==c?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error"))),"choicesDefault"==b&&$('input[value="'+c+'"]').prev().addClass("active"),"choicesField"==b&&($("#fieldSettings_choices_formSelect").change(),$("#fieldSettings_choices_fieldSelect").val(c).change())}function bindToHiddenForm(){var a=globalFieldID;if("undefined"!=typeof a){var b=$(this).data("bindmodel"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#formPreview").find("[data-id='"+a+"']"),e=($("#formPreview_"+a).find(".fieldLabels"),d.find(".fieldValues")),f=d.find(".fieldPreview");if(e.find("[data-bind='"+b+"']").val(c),"name"==b&&(evaluateSpace(c,$(this)),titleField()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"choicesType"==b)if("manual"==c)$("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide(),$("#choicesForm_"+a).val("");else{$("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show();var g=e.find($('input[name^="type"]')).val();"multiselect"==g?f.find(".controls").find($("select")).html():"checkbox"==g||"radio"==g?f.find(".controls").find($("label")).remove():"select"==g&&f.find($(".controls")).find($("select")).html(output)}if("managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"idnoFormat"==b||"startIncrement"==b||"idnoConfirm"==b){$("#fieldSettings_container_idno_confirm").removeClass("hidden").show();var h=$("#fieldSettings_idno_confirm").is(":checked");h===!1&&idnoValues.idnoFormat?$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled")}if("validation"==b){var i=$("#fieldSettings_validation").val();"regexp"===i?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide().val("")}if(("helpText"==b||"helpURL"==b)&&formatHelpForHiddenField(e),"helpType"==b){switch($(this).val()){case"text":case"html":$("#fieldSettings_help_textarea").show().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden");break;case"web":$("#fieldSettings_help_url").show().removeClass("hidden"),$("#fieldSettings_help_textarea").hide().removeClass("hidden");break;case"none":case"default":$("#fieldSettings_help_textarea").hide().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden")}formatHelpForHiddenField(e)}applyFormPreview()}}function formatHelpForHiddenField(a){var b,c=$("#fieldSettings_help_type").val(),d=globalFieldID;"text"==c||"html"==c?(b=$("#fieldSettings_help_textarea").val().sanitizeInput().escapeHtml(),console.log(b)):(b=$("#fieldSettings_help_url").val(),console.log(b),validateURL(b)?$("#fieldSettings_help_url").removeClass("has-error"):$("#fieldSettings_help_url").addClass("has-error"));var e=c+"|"+b;$("#fieldSettings_help_text").val(e),a.find("[data-bind='help']").val(e),$(".helpPreview").popover("destroy"),$(".helpPreview").hide(),"html"===c||"text"===c?($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help",content:"<div>"+b+"</div>",trigger:"click",html:!0})):"web"===c&&($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help Url",content:'<div><a href="'+b+'">'+b+"</a></div>",trigger:"click",html:!0}))}function evaluateSpace(a,b){checkForSpaces(a)?(b.addClass("has-error testy"),$(".noSpacesAlert").show(),$("input[type=submit]").addClass("disabled").attr("disabled",!0)):(b.removeClass("has-error"),$("input[type=submit]").removeClass("disabled").removeAttr("disabled"),$(".noSpacesAlert").hide())}function getFormFields(){var a="";return $.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(b){var c=JSON.parse(b);$.each(c,function(b,c){$.each(c,function(b,c){a+='<option value="'+c.name+'">'+c.label+"</option>"})})}),a}function evaluateCheck(a){return a.is(":checked")?!0:!1}function formSettingsBindings(){$("#formTitle").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formTitle").focus()}),$("#formSettings_formTitle").keyup(function(){$("#formTitle").html($(this).val()),0!==$(this).val().length?$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled")}).keyup(),$("#formDescription").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formDescription").focus()}),$("#formSettings_formDescription").keyup(function(){$("#formDescription").html($(this).val())}).keyup(),$("#formSettings_formMetadata").change(function(){var a=$("#fieldAdd"),b=$("#formPreview").find("input[name^=type_][value=idno]");$(this).is(":checked")?($("#formSettings_linkTitle_container").show(),0===b.length?($("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):confirm("Enabling this will remove any existing ID Number fields. Do you want to continue?")?(b.parent().parent().remove(),$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):$(this).removeAttr("checked")):($("#formSettings_linkTitle_container").hide(),a.find("li:contains('ID Number')").show(),a.find("li:contains('Paragraph Text')").show(),a.find("li:contains('Radio')").show(),a.find("li:contains('Checkboxes')").show(),a.find("li:contains('Dropdown')").show(),a.find("li:contains('Multi-Select')").show(),a.find("li:contains('File Upload')").show(),a.find("li:contains('WYSIWYG')").show(),a.find("li:contains('Field Set')").parent().show().prev().show(),0===b.length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}).change()}function modalBindings(){$("#formTypeSelector").modal({show:!1,keyboard:!1,backdrop:"static"}).on("click","button:contains('Metadata')",function(){$(".nav-tabs li:nth-child(3) a").click(),$("#formSettings_formMetadata").prop("checked",!0).change(),$("#formTypeSelector").modal("hide")}).on("click","button:contains('Object')",function(){var a=$("#fieldAdd"),b=($("#formPreview .well"),$("#fieldSettings_label")),c=$("#fieldSettings_options_sortable"),d=$("#fieldSettings_options_searchable");a.find("li:contains('ID Number')").click(),b.val("IDNO").keyup(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),a.find("li:contains('Single Line Text')").click(),$("#fieldSettings_name").val("title").keyup(),b.val("Title").keyup(),$("#fieldSettings_options_required").prop("checked",!0).change(),$("#fieldSettings_options_duplicates").prop("checked",!0).change(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),$("#fieldSettings_options_displayTable").prop("checked",!0).change(),$("#fieldTab li:last a").click(),$("#formPreview li").removeClass("activeField"),$("#formSettings_formMetadata").removeAttr("checked").change(),$("#formTypeSelector").modal("hide"),$("#formSettings_formTitle")})}function addNewField(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c=0;$("#formPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");c<=b[1]&&(c=parseInt(b[1])+1)}}),$(a).attr({id:"formPreview_"+c,"data-id":c}).html('<div class="fieldPreview">'+newFieldPreview(c,b)+'</div><div class="fieldValues">'+newFieldValues(c,b)+"</div>"),$("#formPreview_"+c).click(),$("#formSettings_formMetadata").not(":checked")&&(0===$("#formPreview").find("input[name^=type_][value=idno]").length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}function newFieldPreview(a,b,c){var d="";if(void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.choicesOptions="First Choice%,%Second Choice",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),("idno"!=b&&"ID Number"!=b||0!==numIDNOs)&&(d+='<i class="icon-remove"></i>'),d+='<span class="fa fa-question-circle helpPreview"></span>',"Field Set"==b||"fieldset"==b)d+='<fieldset><legend></legend><ul class="unstyled sortable"></ul></fieldset>';else{switch(d+='<div class="control-group"><label class="control-label fieldLabels">Untitled</label><div class="controls">',b){case"ID Number":case"idno":case"Single Line Text":case"text":d+='<input type="text">',numIDNOs++;break;case"Paragraph Text":case"textarea":d+="<textarea></textarea>";break;case"Radio":case"radio":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="radio" checked> '+b+"</label>":'<label> <input type="radio"> '+b+"</label>"})}else d+='<label class="radio"><input type="radio">First Choice</label><label class="radio"><input type="radio">Second Choice</label>';break;case"Checkboxes":case"checkbox":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="checkbox" checked> '+b+"</label>":'<label> <input type="checkbox"> '+b+"</label>"})}else d+='<label class="checkbox"><input type="checkbox">First Choice</label><label class="checkbox"><input type="checkbox">Second Choice</label>';break;case"Dropdown":case"select":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+="<select>",$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+="<select></select>";break;case"Number":case"number":d+='<input type="number">';break;case"Email":case"email":d+='<input type="email">';break;case"Phone":case"tel":d+='<input type="tel">';break;case"Date":case"date":d+='<input type="date">';break;case"Time":case"time":d+='<input type="time">';break;case"Website":case"url":d+='<input type="url">';break;case"Multi-Select":case"multiselect":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+='<select multiple></select><br><select class="selectPreview">',$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+='<select multiple></select><br><select class="selectPreview"></select>';break;case"WYSIWYG":case"wysiwyg":d+='<img src="../includes/img/wysiwyg.png">';break;case"File Upload":case"file":d+='<input type="file" disabled>'}d+="</div></div>"}return d}function newFieldValues(a,b,c){var d="";void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),c.type=determineType(b),b=c.type;var e=["name","position","type","label","value","placeholder","id","class","style","help","helpType","required","duplicates","readonly","disabled","disabledInsert","disabledUpdate","publicRelease","sortable","searchable","displayTable","hidden","validation","validationRegex","access","fieldset","metadataStandard"];switch(d+=createHiddenFields(e,a,c),b){case"idno":var f=["managedBy","idnoFormat"];d+=createHiddenFields(f,a,c),d+='<input type="hidden" id="startIncrement_'+a+'" name="startIncrement_'+a+'"   data-bind="startIncrement"    value="'+(void 0!==c.startIncrement?c.startIncrement:"1")+'">',d+='<input type="hidden" id="idnoConfirm_'+a+'"    name="idnoConfirm_'+a+'"      data-bind"idnoConfirm"        value="false">';break;case"text":var g=["externalUpdateForm","externalUpdateField","min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"textarea":case"number":var g=["min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"radio":case"checkbox":case"select":case"multiselect":var h=["choicesType","choicesNull","choicesDefault","choicesForm","choicesField","choicesFieldDefault"];d+=createHiddenFields(h,a,c),d+='<input type="hidden" id="choicesOptions_'+a+'" name="choicesOptions_'+a+'" data-bind="choicesOptions" value="'+(void 0!==c.choicesOptions?c.choicesOptions:"First Choice%,%Second Choice")+'">';break;case"file":var i=["bgProcessing","multipleFiles","combine","ocr","convert","convertHeight","convertWidth","watermark","watermarkImage","watermarkLocation","border","borderHeight","borderWidth","borderColor","thumbnail","convertAudio","bitRate","audioFormat","convertVideo","videoHeight","videoWidth","videobitRate","aspectRatio","videoFormat","videothumbnail","videoThumbFrames","videoThumbHeight","videoThumbWidth","videoFormatThumb"];d+=createHiddenFields(i,a,c),d+='<input type="hidden" id="allowedExtensions_'+a+'" name="allowedExtensions_'+a+'"     data-bind="allowedExtensions"    value="'+(void 0!==c.allowedExtensions?c.allowedExtensions:"tif%,%tiff%,%jpg")+'">',d+='<input type="hidden" id="convertResolution_'+a+'" name="convertResolution_'+a+'"     data-bind="convertResolution"    value="'+(void 0!==c.convertResolution?c.convertResolution:"192")+'">',d+='<input type="hidden" id="convertFormat_'+a+'"     name="convertFormat_'+a+'"         data-bind="convertFormat"        value="'+(void 0!==c.convertFormat?c.convertFormat:"JPG")+'">',d+='<input type="hidden" id="thumbnailHeight_'+a+'"   name="thumbnailHeight_'+a+'"       data-bind="thumbnailHeight"      value="'+(void 0!==c.thumbnailHeight?c.thumbnailHeight:"150")+'">',d+='<input type="hidden" id="thumbnailWidth_'+a+'"    name="thumbnailWidth_'+a+'"        data-bind="thumbnailWidth"       value="'+(void 0!==c.thumbnailWidth?c.thumbnailWidth:"150")+'">',d+='<input type="hidden" id="thumbnailFormat_'+a+'"   name="thumbnailFormat_'+a+'"       data-bind="thumbnailFormat"      value="'+(void 0!==c.thumbnailFormat?c.thumbnailFormat:"JPG")+'">',d+='<input type="hidden" id="help_'+a+'"   name="help_'+a+'"       data-bind="help"      value="'+(void 0!==c.help?c.help:"none|")+'">'}return d}function determineValidation(a){switch(a){case"Number":case"number":return"integer";case"Email":case"email":return"emailAddr";case"Phone":case"tel":return"phoneNumber";case"Date":case"date":return"date";case"Website":case"url":return"url";default:return}}function determineType(a){switch(a){case"ID Number":case"idno":return"idno";case"Single Line Text":case"text":return"text";case"Paragraph Text":case"textarea":return"textarea";case"Radio":case"radio":return"radio";case"Checkboxes":case"checkbox":return"checkbox";case"Dropdown":case"select":return"select";case"Number":case"number":return"number";case"Email":case"email":return"email";case"Phone":case"tel":return"tel";case"Date":case"date":return"date";case"Time":case"time":return"time";case"Website":case"url":return"url";case"Multi-Select":case"multiselect":return"multiselect";case"WYSIWYG":case"wysiwyg":return"wysiwyg";case"File Upload":case"file":return"file";case"Field Set":case"fieldset":return"fieldset";default:return}}function createHiddenFields(a,b,c){return output="",$.each(a,function(a,d){var e=d+"_"+b,f=void 0!==c[d]?c[d]:"";output+='<input type="hidden" id="'+e+'" name="'+e+'" data-bind="'+d+'" value="'+f+'"/>'}),output}function addChoice(a,b){return"undefined"==typeof a?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':"undefined"==typeof b?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn'+(a==b?" active":"")+'" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>';
}function addAllowedExtension(a){return"undefined"==typeof a&&(a=""),'<div class="row-fluid input-append extensionItem" data-itemtype="extension"><input name="fieldSettings_allowedExtension_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add an extension."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this extension."><i class="icon-remove"></i></button></div>'}function addMetadataStandard(a){"undefined"==typeof a&&(a="");var b=metadataSchema,c=a.split(" : ")[1],d=a.split(" : ")[0];"undefined"==typeof c&&(c=""),"undefined"==typeof d&&(d="");var e='<select class="input-block-level form-control mdStandardSelect" id="fieldSettings_standardType" name="fieldSettings_standardType" data-selectvalue="'+d+'"><option value=""> None </option>'+b+"</select>";return'<div class="row-fluid input-append metadata-item" data-itemtype="metadataStandard">'+e+'<input name="fieldSettings_metadataIdentifer" type="text" value="'+c+'"><button name="add" class="btn" type="button" title="Add Metadata Standard"><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove Metadata Standard"><i class="icon-remove"></i></button></div>'}function enableChoiceFunctionality(){$(".choicesItem").find($("input[type=text], select")).bind("change keyup",modifyChoiceBinding).change(),$(".extensionItem").find($("input[type=text], select")).bind("change keyup",extensionBinding).change(),$(".metadata-item").find($("input[type=text], select")).bind("change keyup",metadataBinding).change(),$("#fieldSettings_choices_null").change(function(){$(".input-append").find("input[type=text]").change()}),$(".input-append").find("button").click(function(){var a=$(this).attr("name"),b=$(this).parent().data("itemtype");if("add"==a)"choice"==b?$(this).parent().after(addChoice()):"extension"==b?$(this).parent().after(addAllowedExtension()):$(this).parent().after(addMetadataStandard()),$(".input-append").find("button").unbind("click"),enableChoiceFunctionality();else if("remove"==a)$(this).parent().remove(),$(".input-append").find($("input[type=text]")).change();else if("default"==a){var c=$(this).next().val(),d=globalFieldID;$("#choicesDefault_"+d).val(c),$('button[name="default"]').removeClass("active"),$(this).hasClass("focus")&&$(this).addClass("selected")}}),$("#fieldSettings_choices_formSelect").change(function(){var a=$(this).val();if("null"==a?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error")),void 0===choicesFields[a]){var b;choicesFields[null]=b,$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var c=JSON.parse(a);$.each(c,function(a,c){b="<option value> Select A Field</option>",$.each(c,function(a,c){b+='<option value="'+c.name+'">'+c.label+"</option>"}),choicesFields[a]=b})})}$("#fieldSettings_choices_fieldSelect").html(choicesFields[a])})}function modifyChoiceBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".choicesOptions").val(b).change(),$("#fieldSettings_choices_null").is(":checked")&&a.unshift("Make A Selection");for(var c=$("#formPreview_"+globalFieldID),d=c.find($("#type_"+globalFieldID)).val(),e="",f=0;f<a.length;f++)"multiselect"==d||"select"==d?e+="<option value='"+a[f]+"'>"+a[f]+"</option>":"checkbox"==d?e+="<label for='checkbox'><input type='checkbox'/>"+a[f]+"</label>":"radio"==d&&(e+="<label for='checkbox'><input type='radio'/>"+a[f]+"</label>");if("multiselect"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}else if("checkbox"==d||"radio"==d){var g=c.find($(".controls"));g.find($("label")).remove(),g.append(e)}else if("select"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}}function extensionBinding(){var a=[];$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".allowedExtensions").val(b).change();var c=$("#fieldSettings_file_allowedExtensions").children().length;1>=c?$("#allowedExtensionsAlert").show():$("#allowedExtensionsAlert").hide(),1>c&&$(this).parent().after(addAllowedExtension())}function metadataBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){var c=$(this).prev("select").val();value=c+" : "+$(this).val(),a[b]=value});var b=a.join("%,%");$(".metadataStandard").val(b).change()}function titleField(){var a=$("#formSettings_objectTitleField"),b="";$("#formPreview").find($(":input[type=text]")).each(function(){var a=($(this).parent().parent().parent().next("div").find($("input[name^='label']")).val(),$(this).parent().parent().parent().next("div").find($("input[name^='name']")).val());"idno"===a||(b+="<option value='"+a+"'>"+a+"</option>")}),a.html(b)}function validateURL(a){var b=/^((https?|ftp):\/\/)?([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;return b.test(a)}function checkForSpaces(a){return/\s/g.test(a)}function removeHtml(a){return a.replace(/&/g,"&amp;").replace(/>/g,"").replace(/</g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"")}function isEmpty(a){return!a||0===a.length}function removeItemFromID(a,b){var c=b.selectedIndex;if(-1!=c){for(i=b.length-1;i>=0;i--)b.options[i].selected&&(b.options[i]=null);b.length>0&&(b.selectedIndex=0==c?0:c-1)}}function selectAllOnSubmit(a){var b=document.getElementById(a);if(null!=b)for(i=b.length-1;i>=0;i--)b.options[i].selected=!0}function entrySubmit(){return selectAllOnSubmit("selectedEntryUsers"),selectAllOnSubmit("selectedViewUsers"),selectAllOnSubmit("selectedUsersAdmins"),!0}function settingsBindings(){var a=$("#GroupingsPreview");$("#GroupingsPreview").on("click","li",function(b){b.stopPropagation(),$(this).hasClass("activeField well")||(a.find(".activeField").removeClass("activeField well"),$(this).addClass("activeField well"),showSettings($(this).prop("id")))}),$("#groupingsSettings_grouping").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val(),e=b.find(".groupingPreview"),f=e.find("i"),g=e.find("ul"),h=e.contents();h.slice(h.index(f)+1,h.index(g)).remove(),g.before(d),b.find("input[name^=nav_grouping_]").val(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_label").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").text(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_url").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").prop("href",d),$("#nav_url_"+c).val(d)})}function showSettings(a){if($("#groupingsSettings").children().hide(),$("#groupingTab a[href='#groupingsSettings']").tab("show"),void 0===a)$("#noGroupingSelected").show();else{var b=a.split("_")[1],c=$("#nav_type_"+b).val(),d=$("#nav_grouping_"+b);if("grouping"==c)$("#groupingsSettings_container_grouping").show(),$("#groupingsSettings_grouping").val(d.val()).keyup();else{switch(c){case"logout":case"link":$("#groupingsSettings_container_label").show(),$("#groupingsSettings_container_url").show();break;case"export":case"objectForm":case"metadataForm":$("#groupingsSettings_container_label").show()}if("objectForm"==c||"metadataForm"==c?$("#groupingsSettings_label").prop("disabled",!0):$("#groupingsSettings_label").removeAttr("disabled"),"grouping"!=c){var e=d.parents("li").parents("li");if(e.length>0){var f=e.prop("id").split("_")[1];d.val($("#nav_grouping_"+f).val())}else d.val("")}else $("#groupingsSettings_grouping").val(d.val());$("#groupingsSettings_label").val($("#nav_label_"+b).val()).keyup(),$("#groupingsSettings_url").val($("#nav_url_"+b).val()).keyup()}}}function addNew(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c={};$(a).data("type")&&(c.type=b=$(a).data("type"),c.label=$("a",a).text()),$(a).data("formid")&&(c.formID=$(a).data("formid"));var d=0;$("#GroupingsPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");d<=b[1]&&(d=parseInt(b[1])+1)}}),$(a).attr({id:"GroupingsPreview_"+d}).html('<div class="groupingPreview">'+newGroupingPreview(b,c)+'</div><div class="groupingValues">'+newGroupingValues(d,b,c)+"</div>"),$("#GroupingsPreview_"+d).click()}function newGroupingPreview(a,b){var c;return c='<i class="icon-remove"></i>',c+="New Grouping"==a||"grouping"==a?'<ul class="unstyled sortable"></ul>':void 0===b||null===b?'<a href="#">[Link]</a>':'<a href="'+(void 0!==b.url?b.url:"")+'">'+(void 0!==b.label?b.label:"Untitled")+"</a>"}function newGroupingValues(a,b,c){var d;switch(void 0===c&&(c={}),b){case"New Grouping":case"grouping":b=c.type="grouping";break;case"Log Out":case"logout":b=c.type="logout";break;case"Export Link":case"export":b=c.type="export";break;case"Link":case"link":b=c.type="link"}switch(d='<input type="hidden" id="nav_position_'+a+'" name="nav_position_'+a+'" value="'+(void 0!==c.position?c.position:"")+'">',d+='<input type="hidden" id="nav_type_'+a+'" name="nav_type_'+a+'" value="'+(void 0!==c.type?c.type:b)+'">',d+='<input type="hidden" id="nav_label_'+a+'" name="nav_label_'+a+'" value="'+(void 0!==c.label?c.label:"Untitled")+'">',d+='<input type="hidden" id="nav_url_'+a+'" name="nav_url_'+a+'" value="'+(void 0!==c.url?c.url:"")+'">',d+='<input type="hidden" id="nav_grouping_'+a+'" name="nav_grouping_'+a+'" value="'+(void 0!==c.grouping?c.grouping:"")+'">',b){case"objectForm":case"metadataForm":d+='<input type="hidden" id="nav_formID_'+a+'" name="nav_formID_'+a+'" value="'+(void 0!==c.formID?c.formID:"")+'">'}return d}function sortableNav(){$("#navigation ul.sortable").sortable({connectWith:"#navigation ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("New Grouping"==$(b.item).text()&&"GroupingsPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNew(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableNav()}})}function removeFormPreviewItem(a){if(confirm("Are you sure you want to remove this field?")){var b=a.parent().parent();"fieldset"==a.parent().next().children(":input[name^=type_]").val()&&b.after(a.next().find("li"));var c=$(".addFieldNav").parent();b.removeClass("well activeField").remove(),c.hasClass("active")||($(".addFieldNav").click().tab("show"),$("#formPreview li:first-child").trigger("click")),$("#formSettings_formMetadata").not(":checked")&&(0===$(":input[name^=type_][value=idno]",formPreview).length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}}function applyFormPreview(){var a;a="undefined"==typeof globalFieldID?$("#formPreview").children().find(".fieldPreview"):$("#formPreview_"+globalFieldID).find(".fieldPreview"),a.each(function(){var a=$(this).find(".fieldLabels"),b=$(this).find(".controls").children(),c=$(this).next(),d=c.find($('input[name^="placeholder"]')).val(),e=(c.find($('input[name^="type"]')).val(),c.find($('input[name^="name"]')).val()),f=(c.find($('input[name^="style"]')).val(),c.find($('input[name^="label"]')).val()),g=c.find($('input[name^="id"]')).val(),h=c.find($('input[name^="class"]')).val(),i=c.find($('input[name^="value"]')).val(),j=c.find($('input[name^="disabled"')).val(),k=c.find($('input[name^="readonly"')).val();c.find($('input[name^="hidden"]')).val(),c.find($('input[name^="choicesOptions"]')).val(),c.find($('input[name^="choicesType"]')).val(),b.attr({placeholder:d,name:e,id:g,"class":h}),b.val(i),"true"===j||"true"===k?(b.prop("readonly",!0).addClass("disabled"),b.prop("disabled",!0).addClass("disabled")):(b.prop("readonly",!1).removeClass("disabled"),b.prop("disabled",!1).removeClass("disabled")),i.length&&b.val(i),a.html(f)})}function sortableForm(){$("#formCreator ul.sortable").sortable({connectWith:"#formCreator ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("Field Set"==$(b.item).text()&&"formPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNewField(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableForm()}}),calculatePosition()}function calculatePosition(){$("#formCreator ul.sortable").children("li").each(function(a){$(this).attr("data-position",a),$(this).find("[data-bind='position']").val(a)})}function showFieldSettings(a){var b=$("#fieldSettings_form"),c=$("#fieldSettings_fieldset_form");if(void 0===a)$("#noFieldSelected").show(),c.hide(),b.hide();else{var d,e,f,g=a,h=$("#type_"+g).val(),i=$("#fieldset_"+g);if($("#noFieldSelected").hide(),"fieldset"==h)c.show(),b.hide();else{c.hide(),b.show(),b.find(".dataSettings").children().hide(),b.find(".default").show();var j=$("#fieldSettings_name"),k=$("#fieldSettings_options_required"),l=$("#fieldSettings_options_duplicates"),m=$("#fieldSettings_options_displayTable"),n=$("#fieldSettings_options_readonly"),o=$("#fieldSettings_options_disabled");switch("idno"==h?(j.prop("readonly",!0).val("idno").keyup(),k.prop({checked:!0,disabled:!0}).change(),l.prop({checked:!0,disabled:!0}).change(),m.prop({checked:!0,disabled:!0}).change(),n.prop({checked:!0,disabled:!0}).change(),o.prop({checked:!1,disabled:!0}).change()):"file"==h?m.removeAttr("checked").change().prop("disabled",!0):(j.removeAttr("readonly"),k.removeAttr("disabled"),l.removeAttr("disabled"),n.removeAttr("disabled"),o.removeAttr("disabled"),m.removeAttr("disabled")),h){case"idno":$("#fieldSettings_container_idno").parent().show();break;case"text":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_externalUpdate").parent().hide(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"textarea":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"radio":case"checkbox":case"select":case"multiselect":$("#fieldSettings_container_choices").parent().show();break;case"number":$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().show(),$("#fieldSettings_range_format").parent().removeClass("span6").addClass("span4"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="value">Value</option><option value="digits">Digits</option>');break;case"wysiwyg":$("#fieldSettings_container_placeholder").hide(),$("#fieldSettings_container_value").hide();break;case"file":$("#fieldSettings_container_file_allowedExtensions").parent().show(),$("#fieldSettings_container_file_options").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;default:$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show()}var p=$("#choicesOptions_"+g).val();if(void 0!==p){var q=$("#fieldSettings_choices_manual");for(d=p.split("%,%"),e="",f=0;f<d.length;f++)e+=addChoice(d[f],$("#choicesDefault_"+g).val());q.html(e).find("input[name=fieldSettings_choices_text]").keyup()}var r=$("#allowedExtensions_"+g).val();if(void 0!==r){var s=$("#fieldSettings_file_allowedExtensions");for(d=r.split("%,%"),e="",s.html(""),f=0;f<d.length;f++)e+=addAllowedExtension(d[f]);s.append(e),s.find(":input[name=fieldSettings_allowedExtension_text]:first").keyup()}var t=$("#metadataStandard_"+g).val();if(void 0!==t){var u=$("#metadataStandard_options");for(d=t.split("%,%"),e="",u.html(""),f=0;f<d.length;f++)e+=addMetadataStandard(d[f]);u.append(e),$(".mdStandardSelect").each(function(){var a=$(this).data("selectvalue");$(this).val(a)})}if("fieldset"!=h){var v=i.parents("li").parents("li");if(v.length>0){var w=v.prop("id").split("_")[1];i.val($("#fieldset_"+w).val())}else i.val("")}else $("#fieldSettings_fieldset").val(i.val());-1!=$.inArray(h,["idno","text","textarea","date","time","wysiwyg"])?$("#fieldVariablesLink").show():$("#fieldVariablesLink").hide(),$("#fieldSettings_externalUpdate_formSelect").change(function(){var a=$(this).val();void 0===choicesFields[a]&&(choicesFields[a]="",$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var b=JSON.parse(a);$.each(b,function(a,b){var c="";$.each(b,function(a,b){c+='<option value="'+b.name+'">'+b.label+"</option>"}),choicesFields[a]=c})})),$("#externalUpdateForm_"+g).val(a).change(),$("#fieldSettings_externalUpdate_fieldSelect").html(choicesFields[a]).change()}),$(".uxOptions").find("input").change(function(){var a=$(this).data("bindmodel"),b=$("."+a);$(this).is(":checked")||$(this).value?b.show():b.hide()}),enableChoiceFunctionality()}}}function fieldSettingsBindings(){var a=$("#formPreview");a.children("li").removeClass("activeField"),$("#fieldSettings_form").find("[data-bindmodel]").bind("change keyup",bindToHiddenForm),a.on("click","li",function(b){if(b.stopPropagation(),$(b.target).is(".icon-remove"))console.log($(this)),removeFormPreviewItem($(b.target));else{var c=$(this).data("id");globalFieldID=c,a.find("[data-bind]").bind("change",setOriginalValues),$(this).hasClass("activeField")||(a.find(".activeField").removeClass("activeField"),$(this).addClass("activeField"),$("#fieldTab a[href='#fieldSettings']").tab("show"),showFieldSettings(c),setInitialBind(),applyFormPreview())}})}function setInitialBind(){var a=globalFieldID;if("undefined"!=typeof a){var b=$("#formPreview").find("[data-id='"+a+"']"),c=b.find(".fieldValues");c.find("[data-bind]").change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues)}}function setOriginalValues(){var a=globalFieldID,b=$(this).data("bind"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#fieldSettings_form").find("[data-bindmodel='"+b+"']"),e=$("#formPreview").find("[data-id='"+a+"']"),f=e.find(".fieldPreview");if("name"==b&&(c=$.trim(c),evaluateSpace(c,d)),"idnoFormat"==b&&(idnoValues.idnoFormat=c),"startIncrement"==b&&(idnoValues.startIncrement=c),"help"==b){var g=c.split("|")[0],h=c.split("|")[1],c="undefined"==h?"":h;$(this).val(g+"|"+h),$("#fieldSettings_help_textarea").val(c).hide(),$("#fieldSettings_help_url").hide().val(c),$("#fieldSettings_help_type").val(g).change()}d.is("input[type=checkbox]")?"true"==c?d.prop("checked",!0):d.prop("checked",!1):d.is("select")?d.find('option[value="'+c+'"]').prop("selected",!0):d.is("input[type=number]")?d.val(parseInt(c)):d.val(c),d.is($("#fieldSettings_choices_type"))&&("manual"==c?($("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide()):($("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show())),"managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"validation"==b&&("regexp"==c?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide()),"choicesForm"==b&&("null"==c||void 0==c?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error"))),"choicesDefault"==b&&$('input[value="'+c+'"]').prev().addClass("active"),"choicesField"==b&&($("#fieldSettings_choices_formSelect").change(),$("#fieldSettings_choices_fieldSelect").val(c).change())}function bindToHiddenForm(){var a=globalFieldID;if("undefined"!=typeof a){var b=$(this).data("bindmodel"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#formPreview").find("[data-id='"+a+"']"),e=($("#formPreview_"+a).find(".fieldLabels"),d.find(".fieldValues")),f=d.find(".fieldPreview");if(e.find("[data-bind='"+b+"']").val(c),"name"==b&&(evaluateSpace(c,$(this)),titleField()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"choicesType"==b)if("manual"==c)$("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide(),$("#choicesForm_"+a).val("");else{$("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show();var g=e.find($('input[name^="type"]')).val();"multiselect"==g?f.find(".controls").find($("select")).html():"checkbox"==g||"radio"==g?f.find(".controls").find($("label")).remove():"select"==g&&f.find($(".controls")).find($("select")).html(output)}if("managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"idnoFormat"==b||"startIncrement"==b||"idnoConfirm"==b){$("#fieldSettings_container_idno_confirm").removeClass("hidden").show();var h=$("#fieldSettings_idno_confirm").is(":checked");h===!1&&idnoValues.idnoFormat?$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled")}if("validation"==b){var i=$("#fieldSettings_validation").val();"regexp"===i?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide().val("")}if(("helpText"==b||"helpURL"==b)&&formatHelpForHiddenField(e),"helpType"==b){switch($(this).val()){case"text":case"html":$("#fieldSettings_help_textarea").show().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden");break;case"web":$("#fieldSettings_help_url").show().removeClass("hidden"),$("#fieldSettings_help_textarea").hide().removeClass("hidden");break;case"none":case"default":$("#fieldSettings_help_textarea").hide().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden")}formatHelpForHiddenField(e)}applyFormPreview()}}function formatHelpForHiddenField(a){var b,c=$("#fieldSettings_help_type").val(),d=globalFieldID;"text"==c||"html"==c?(b=sanitizeInput($("#fieldSettings_help_textarea").val()),console.log(b)):(b=$("#fieldSettings_help_url").val(),console.log(b),validateURL(b)?$("#fieldSettings_help_url").removeClass("has-error"):$("#fieldSettings_help_url").addClass("has-error"));var e=c+"|"+b;$("#fieldSettings_help_text").val(e),a.find("[data-bind='help']").val(e),$(".helpPreview").popover("destroy"),$(".helpPreview").hide(),"html"===c||"text"===c?($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help",content:"<div>"+b+"</div>",trigger:"click",html:!0})):"web"===c&&($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help Url",content:'<div><a href="'+b+'">'+b+"</a></div>",trigger:"click",html:!0}))}function evaluateSpace(a,b){checkForSpaces(a)?(b.addClass("has-error testy"),$(".noSpacesAlert").show(),$("input[type=submit]").addClass("disabled").attr("disabled",!0)):(b.removeClass("has-error"),$("input[type=submit]").removeClass("disabled").removeAttr("disabled"),$(".noSpacesAlert").hide())}function getFormFields(){var a="";return $.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(b){var c=JSON.parse(b);$.each(c,function(b,c){$.each(c,function(b,c){a+='<option value="'+c.name+'">'+c.label+"</option>"})})}),a}function evaluateCheck(a){return a.is(":checked")?!0:!1}function formSettingsBindings(){$("#formTitle").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formTitle").focus()}),$("#formSettings_formTitle").keyup(function(){$("#formTitle").html($(this).val()),0!==$(this).val().length?$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled")}).keyup(),$("#formDescription").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formDescription").focus()}),$("#formSettings_formDescription").keyup(function(){$("#formDescription").html($(this).val())}).keyup(),$("#formSettings_formMetadata").change(function(){var a=$("#fieldAdd"),b=$("#formPreview").find("input[name^=type_][value=idno]");$(this).is(":checked")?($("#formSettings_linkTitle_container").show(),0===b.length?($("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):confirm("Enabling this will remove any existing ID Number fields. Do you want to continue?")?(b.parent().parent().remove(),$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):$(this).removeAttr("checked")):($("#formSettings_linkTitle_container").hide(),a.find("li:contains('ID Number')").show(),a.find("li:contains('Paragraph Text')").show(),a.find("li:contains('Radio')").show(),a.find("li:contains('Checkboxes')").show(),a.find("li:contains('Dropdown')").show(),a.find("li:contains('Multi-Select')").show(),a.find("li:contains('File Upload')").show(),a.find("li:contains('WYSIWYG')").show(),a.find("li:contains('Field Set')").parent().show().prev().show(),0===b.length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}).change()}function modalBindings(){$("#formTypeSelector").modal({show:!1,keyboard:!1,backdrop:"static"}).on("click","button:contains('Metadata')",function(){$(".nav-tabs li:nth-child(3) a").click(),$("#formSettings_formMetadata").prop("checked",!0).change(),$("#formTypeSelector").modal("hide")}).on("click","button:contains('Object')",function(){var a=$("#fieldAdd"),b=($("#formPreview .well"),$("#fieldSettings_label")),c=$("#fieldSettings_options_sortable"),d=$("#fieldSettings_options_searchable");a.find("li:contains('ID Number')").click(),b.val("IDNO").keyup(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),a.find("li:contains('Single Line Text')").click(),$("#fieldSettings_name").val("title").keyup(),b.val("Title").keyup(),$("#fieldSettings_options_required").prop("checked",!0).change(),$("#fieldSettings_options_duplicates").prop("checked",!0).change(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),$("#fieldSettings_options_displayTable").prop("checked",!0).change(),$("#fieldTab li:last a").click(),$("#formPreview li").removeClass("activeField"),$("#formSettings_formMetadata").removeAttr("checked").change(),$("#formTypeSelector").modal("hide"),$("#formSettings_formTitle")})}function addNewField(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c=0;$("#formPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");c<=b[1]&&(c=parseInt(b[1])+1)}}),$(a).attr({id:"formPreview_"+c,"data-id":c}).html('<div class="fieldPreview">'+newFieldPreview(c,b)+'</div><div class="fieldValues">'+newFieldValues(c,b)+"</div>"),$("#formPreview_"+c).click(),$("#formSettings_formMetadata").not(":checked")&&(0===$("#formPreview").find("input[name^=type_][value=idno]").length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}function newFieldPreview(a,b,c){var d="";if(void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.choicesOptions="First Choice%,%Second Choice",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),("idno"!=b&&"ID Number"!=b||0!==numIDNOs)&&(d+='<i class="icon-remove"></i>'),d+='<span class="fa fa-question-circle helpPreview"></span>',"Field Set"==b||"fieldset"==b)d+='<fieldset><legend></legend><ul class="unstyled sortable"></ul></fieldset>';else{switch(d+='<div class="control-group"><label class="control-label fieldLabels">Untitled</label><div class="controls">',b){case"ID Number":case"idno":case"Single Line Text":case"text":d+='<input type="text">',numIDNOs++;break;case"Paragraph Text":case"textarea":d+="<textarea></textarea>";break;case"Radio":case"radio":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="radio" checked> '+b+"</label>":'<label> <input type="radio"> '+b+"</label>"})}else d+='<label class="radio"><input type="radio">First Choice</label><label class="radio"><input type="radio">Second Choice</label>';break;case"Checkboxes":case"checkbox":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="checkbox" checked> '+b+"</label>":'<label> <input type="checkbox"> '+b+"</label>"})}else d+='<label class="checkbox"><input type="checkbox">First Choice</label><label class="checkbox"><input type="checkbox">Second Choice</label>';break;case"Dropdown":case"select":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+="<select>",$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+="<select></select>";break;case"Number":case"number":d+='<input type="number">';break;case"Email":case"email":d+='<input type="email">';break;case"Phone":case"tel":d+='<input type="tel">';break;case"Date":case"date":d+='<input type="date">';break;case"Time":case"time":d+='<input type="time">';break;case"Website":case"url":d+='<input type="url">';break;case"Multi-Select":case"multiselect":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+='<select multiple></select><br><select class="selectPreview">',$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+='<select multiple></select><br><select class="selectPreview"></select>';break;case"WYSIWYG":case"wysiwyg":d+='<img src="../includes/img/wysiwyg.png">';break;case"File Upload":case"file":d+='<input type="file" disabled>'}d+="</div></div>"}return d}function newFieldValues(a,b,c){var d="";void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,
c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),c.type=determineType(b),b=c.type;var e=["name","position","type","label","value","placeholder","id","class","style","help","helpType","required","duplicates","readonly","disabled","disabledInsert","disabledUpdate","publicRelease","sortable","searchable","displayTable","hidden","validation","validationRegex","access","fieldset","metadataStandard"];switch(d+=createHiddenFields(e,a,c),b){case"idno":var f=["managedBy","idnoFormat"];d+=createHiddenFields(f,a,c),d+='<input type="hidden" id="startIncrement_'+a+'" name="startIncrement_'+a+'"   data-bind="startIncrement"    value="'+(void 0!==c.startIncrement?c.startIncrement:"1")+'">',d+='<input type="hidden" id="idnoConfirm_'+a+'"    name="idnoConfirm_'+a+'"      data-bind"idnoConfirm"        value="false">';break;case"text":var g=["externalUpdateForm","externalUpdateField","min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"textarea":case"number":var g=["min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"radio":case"checkbox":case"select":case"multiselect":var h=["choicesType","choicesNull","choicesDefault","choicesForm","choicesField","choicesFieldDefault"];d+=createHiddenFields(h,a,c),d+='<input type="hidden" id="choicesOptions_'+a+'" name="choicesOptions_'+a+'" data-bind="choicesOptions" value="'+(void 0!==c.choicesOptions?c.choicesOptions:"First Choice%,%Second Choice")+'">';break;case"file":var i=["bgProcessing","multipleFiles","combine","ocr","convert","convertHeight","convertWidth","watermark","watermarkImage","watermarkLocation","border","borderHeight","borderWidth","borderColor","thumbnail","convertAudio","bitRate","audioFormat","convertVideo","videoHeight","videoWidth","videobitRate","aspectRatio","videoFormat","videothumbnail","videoThumbFrames","videoThumbHeight","videoThumbWidth","videoFormatThumb"];d+=createHiddenFields(i,a,c),d+='<input type="hidden" id="allowedExtensions_'+a+'" name="allowedExtensions_'+a+'"     data-bind="allowedExtensions"    value="'+(void 0!==c.allowedExtensions?c.allowedExtensions:"tif%,%tiff%,%jpg")+'">',d+='<input type="hidden" id="convertResolution_'+a+'" name="convertResolution_'+a+'"     data-bind="convertResolution"    value="'+(void 0!==c.convertResolution?c.convertResolution:"192")+'">',d+='<input type="hidden" id="convertFormat_'+a+'"     name="convertFormat_'+a+'"         data-bind="convertFormat"        value="'+(void 0!==c.convertFormat?c.convertFormat:"JPG")+'">',d+='<input type="hidden" id="thumbnailHeight_'+a+'"   name="thumbnailHeight_'+a+'"       data-bind="thumbnailHeight"      value="'+(void 0!==c.thumbnailHeight?c.thumbnailHeight:"150")+'">',d+='<input type="hidden" id="thumbnailWidth_'+a+'"    name="thumbnailWidth_'+a+'"        data-bind="thumbnailWidth"       value="'+(void 0!==c.thumbnailWidth?c.thumbnailWidth:"150")+'">',d+='<input type="hidden" id="thumbnailFormat_'+a+'"   name="thumbnailFormat_'+a+'"       data-bind="thumbnailFormat"      value="'+(void 0!==c.thumbnailFormat?c.thumbnailFormat:"JPG")+'">',d+='<input type="hidden" id="help_'+a+'"   name="help_'+a+'"       data-bind="help"      value="'+(void 0!==c.help?c.help:"none|")+'">'}return d}function determineValidation(a){switch(a){case"Number":case"number":return"integer";case"Email":case"email":return"emailAddr";case"Phone":case"tel":return"phoneNumber";case"Date":case"date":return"date";case"Website":case"url":return"url";default:return}}function determineType(a){switch(a){case"ID Number":case"idno":return"idno";case"Single Line Text":case"text":return"text";case"Paragraph Text":case"textarea":return"textarea";case"Radio":case"radio":return"radio";case"Checkboxes":case"checkbox":return"checkbox";case"Dropdown":case"select":return"select";case"Number":case"number":return"number";case"Email":case"email":return"email";case"Phone":case"tel":return"tel";case"Date":case"date":return"date";case"Time":case"time":return"time";case"Website":case"url":return"url";case"Multi-Select":case"multiselect":return"multiselect";case"WYSIWYG":case"wysiwyg":return"wysiwyg";case"File Upload":case"file":return"file";case"Field Set":case"fieldset":return"fieldset";default:return}}function createHiddenFields(a,b,c){return output="",$.each(a,function(a,d){var e=d+"_"+b,f=void 0!==c[d]?c[d]:"";output+='<input type="hidden" id="'+e+'" name="'+e+'" data-bind="'+d+'" value="'+f+'"/>'}),output}function addChoice(a,b){return"undefined"==typeof a?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':"undefined"==typeof b?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn'+(a==b?" active":"")+'" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>'}function addAllowedExtension(a){return"undefined"==typeof a&&(a=""),'<div class="row-fluid input-append extensionItem" data-itemtype="extension"><input name="fieldSettings_allowedExtension_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add an extension."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this extension."><i class="icon-remove"></i></button></div>'}function addMetadataStandard(a){"undefined"==typeof a&&(a="");var b=metadataSchema,c=a.split(" : ")[1],d=a.split(" : ")[0];"undefined"==typeof c&&(c=""),"undefined"==typeof d&&(d="");var e='<select class="input-block-level form-control mdStandardSelect" id="fieldSettings_standardType" name="fieldSettings_standardType" data-selectvalue="'+d+'"><option value=""> None </option>'+b+"</select>";return'<div class="row-fluid input-append metadata-item" data-itemtype="metadataStandard">'+e+'<input name="fieldSettings_metadataIdentifer" type="text" value="'+c+'"><button name="add" class="btn" type="button" title="Add Metadata Standard"><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove Metadata Standard"><i class="icon-remove"></i></button></div>'}function enableChoiceFunctionality(){$(".choicesItem").find($("input[type=text], select")).bind("change keyup",modifyChoiceBinding).change(),$(".extensionItem").find($("input[type=text], select")).bind("change keyup",extensionBinding).change(),$(".metadata-item").find($("input[type=text], select")).bind("change keyup",metadataBinding).change(),$("#fieldSettings_choices_null").change(function(){$(".input-append").find("input[type=text]").change()}),$(".input-append").find("button").click(function(){var a=$(this).attr("name"),b=$(this).parent().data("itemtype");if("add"==a)"choice"==b?$(this).parent().after(addChoice()):"extension"==b?$(this).parent().after(addAllowedExtension()):$(this).parent().after(addMetadataStandard()),$(".input-append").find("button").unbind("click"),enableChoiceFunctionality();else if("remove"==a)$(this).parent().remove(),$(".input-append").find($("input[type=text]")).change();else if("default"==a){var c=$(this).next().val(),d=globalFieldID;$("#choicesDefault_"+d).val(c),$('button[name="default"]').removeClass("active"),$(this).hasClass("focus")&&$(this).addClass("selected")}}),$("#fieldSettings_choices_formSelect").change(function(){var a=$(this).val();if("null"==a?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error")),void 0===choicesFields[a]){var b;choicesFields[null]=b,$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var c=JSON.parse(a);$.each(c,function(a,c){b="<option value> Select A Field</option>",$.each(c,function(a,c){b+='<option value="'+c.name+'">'+c.label+"</option>"}),choicesFields[a]=b})})}$("#fieldSettings_choices_fieldSelect").html(choicesFields[a])})}function modifyChoiceBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".choicesOptions").val(b).change(),$("#fieldSettings_choices_null").is(":checked")&&a.unshift("Make A Selection");for(var c=$("#formPreview_"+globalFieldID),d=c.find($("#type_"+globalFieldID)).val(),e="",f=0;f<a.length;f++)"multiselect"==d||"select"==d?e+="<option value='"+a[f]+"'>"+a[f]+"</option>":"checkbox"==d?e+="<label for='checkbox'><input type='checkbox'/>"+a[f]+"</label>":"radio"==d&&(e+="<label for='checkbox'><input type='radio'/>"+a[f]+"</label>");if("multiselect"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}else if("checkbox"==d||"radio"==d){var g=c.find($(".controls"));g.find($("label")).remove(),g.append(e)}else if("select"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}}function extensionBinding(){var a=[];$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".allowedExtensions").val(b).change();var c=$("#fieldSettings_file_allowedExtensions").children().length;1>=c?$("#allowedExtensionsAlert").show():$("#allowedExtensionsAlert").hide(),1>c&&$(this).parent().after(addAllowedExtension())}function metadataBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){var c=$(this).prev("select").val();value=c+" : "+$(this).val(),a[b]=value});var b=a.join("%,%");$(".metadataStandard").val(b).change()}function titleField(){var a=$("#formSettings_objectTitleField"),b="";$("#formPreview").find($(":input[type=text]")).each(function(){var a=($(this).parent().parent().parent().next("div").find($("input[name^='label']")).val(),$(this).parent().parent().parent().next("div").find($("input[name^='name']")).val());"idno"===a||(b+="<option value='"+a+"'>"+a+"</option>")}),a.html(b)}function validateURL(a){var b=/^((https?|ftp):\/\/)?([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;return b.test(a)}function checkForSpaces(a){return/\s/g.test(a)}function removeHtml(a){return a.replace(/&/g,"&amp;").replace(/>/g,"").replace(/</g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"")}function isEmpty(a){return!a||0===a.length}function removeItemFromID(a,b){var c=b.selectedIndex;if(-1!=c){for(i=b.length-1;i>=0;i--)b.options[i].selected&&(b.options[i]=null);b.length>0&&(b.selectedIndex=0==c?0:c-1)}}function selectAllOnSubmit(a){var b=document.getElementById(a);if(null!=b)for(i=b.length-1;i>=0;i--)b.options[i].selected=!0}function entrySubmit(){return selectAllOnSubmit("selectedEntryUsers"),selectAllOnSubmit("selectedViewUsers"),selectAllOnSubmit("selectedUsersAdmins"),!0}function settingsBindings(){var a=$("#GroupingsPreview");$("#GroupingsPreview").on("click","li",function(b){b.stopPropagation(),$(this).hasClass("activeField well")||(a.find(".activeField").removeClass("activeField well"),$(this).addClass("activeField well"),showSettings($(this).prop("id")))}),$("#groupingsSettings_grouping").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val(),e=b.find(".groupingPreview"),f=e.find("i"),g=e.find("ul"),h=e.contents();h.slice(h.index(f)+1,h.index(g)).remove(),g.before(d),b.find("input[name^=nav_grouping_]").val(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_label").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").text(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_url").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").prop("href",d),$("#nav_url_"+c).val(d)})}function showSettings(a){if($("#groupingsSettings").children().hide(),$("#groupingTab a[href='#groupingsSettings']").tab("show"),void 0===a)$("#noGroupingSelected").show();else{var b=a.split("_")[1],c=$("#nav_type_"+b).val(),d=$("#nav_grouping_"+b);if("grouping"==c)$("#groupingsSettings_container_grouping").show(),$("#groupingsSettings_grouping").val(d.val()).keyup();else{switch(c){case"logout":case"link":$("#groupingsSettings_container_label").show(),$("#groupingsSettings_container_url").show();break;case"export":case"objectForm":case"metadataForm":$("#groupingsSettings_container_label").show()}if("objectForm"==c||"metadataForm"==c?$("#groupingsSettings_label").prop("disabled",!0):$("#groupingsSettings_label").removeAttr("disabled"),"grouping"!=c){var e=d.parents("li").parents("li");if(e.length>0){var f=e.prop("id").split("_")[1];d.val($("#nav_grouping_"+f).val())}else d.val("")}else $("#groupingsSettings_grouping").val(d.val());$("#groupingsSettings_label").val($("#nav_label_"+b).val()).keyup(),$("#groupingsSettings_url").val($("#nav_url_"+b).val()).keyup()}}}function addNew(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c={};$(a).data("type")&&(c.type=b=$(a).data("type"),c.label=$("a",a).text()),$(a).data("formid")&&(c.formID=$(a).data("formid"));var d=0;$("#GroupingsPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");d<=b[1]&&(d=parseInt(b[1])+1)}}),$(a).attr({id:"GroupingsPreview_"+d}).html('<div class="groupingPreview">'+newGroupingPreview(b,c)+'</div><div class="groupingValues">'+newGroupingValues(d,b,c)+"</div>"),$("#GroupingsPreview_"+d).click()}function newGroupingPreview(a,b){var c;return c='<i class="icon-remove"></i>',c+="New Grouping"==a||"grouping"==a?'<ul class="unstyled sortable"></ul>':void 0===b||null===b?'<a href="#">[Link]</a>':'<a href="'+(void 0!==b.url?b.url:"")+'">'+(void 0!==b.label?b.label:"Untitled")+"</a>"}function newGroupingValues(a,b,c){var d;switch(void 0===c&&(c={}),b){case"New Grouping":case"grouping":b=c.type="grouping";break;case"Log Out":case"logout":b=c.type="logout";break;case"Export Link":case"export":b=c.type="export";break;case"Link":case"link":b=c.type="link"}switch(d='<input type="hidden" id="nav_position_'+a+'" name="nav_position_'+a+'" value="'+(void 0!==c.position?c.position:"")+'">',d+='<input type="hidden" id="nav_type_'+a+'" name="nav_type_'+a+'" value="'+(void 0!==c.type?c.type:b)+'">',d+='<input type="hidden" id="nav_label_'+a+'" name="nav_label_'+a+'" value="'+(void 0!==c.label?c.label:"Untitled")+'">',d+='<input type="hidden" id="nav_url_'+a+'" name="nav_url_'+a+'" value="'+(void 0!==c.url?c.url:"")+'">',d+='<input type="hidden" id="nav_grouping_'+a+'" name="nav_grouping_'+a+'" value="'+(void 0!==c.grouping?c.grouping:"")+'">',b){case"objectForm":case"metadataForm":d+='<input type="hidden" id="nav_formID_'+a+'" name="nav_formID_'+a+'" value="'+(void 0!==c.formID?c.formID:"")+'">'}return d}function sortableNav(){$("#navigation ul.sortable").sortable({connectWith:"#navigation ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("New Grouping"==$(b.item).text()&&"GroupingsPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNew(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableNav()}})}function removeFormPreviewItem(a){if(confirm("Are you sure you want to remove this field?")){var b=a.parent().parent();"fieldset"==a.parent().next().children(":input[name^=type_]").val()&&b.after(a.next().find("li"));var c=$(".addFieldNav").parent();b.removeClass("well activeField").remove(),c.hasClass("active")||($(".addFieldNav").click().tab("show"),$("#formPreview li:first-child").trigger("click")),$("#formSettings_formMetadata").not(":checked")&&(0===$(":input[name^=type_][value=idno]",formPreview).length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}}function applyFormPreview(){var a;a="undefined"==typeof globalFieldID?$("#formPreview").children().find(".fieldPreview"):$("#formPreview_"+globalFieldID).find(".fieldPreview"),a.each(function(){var a=$(this).find(".fieldLabels"),b=$(this).find(".controls").children(),c=$(this).next(),d=c.find($('input[name^="placeholder"]')).val(),e=(c.find($('input[name^="type"]')).val(),c.find($('input[name^="name"]')).val()),f=(c.find($('input[name^="style"]')).val(),c.find($('input[name^="label"]')).val()),g=c.find($('input[name^="id"]')).val(),h=c.find($('input[name^="class"]')).val(),i=c.find($('input[name^="value"]')).val(),j=c.find($('input[name^="disabled"')).val(),k=c.find($('input[name^="readonly"')).val();c.find($('input[name^="hidden"]')).val(),c.find($('input[name^="choicesOptions"]')).val(),c.find($('input[name^="choicesType"]')).val(),b.attr({placeholder:d,name:e,id:g,"class":h}),b.val(i),"true"===j||"true"===k?(b.prop("readonly",!0).addClass("disabled"),b.prop("disabled",!0).addClass("disabled")):(b.prop("readonly",!1).removeClass("disabled"),b.prop("disabled",!1).removeClass("disabled")),i.length&&b.val(i),a.html(f)})}function sortableForm(){$("#formCreator ul.sortable").sortable({connectWith:"#formCreator ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("Field Set"==$(b.item).text()&&"formPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNewField(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableForm()}}),calculatePosition()}function calculatePosition(){$("#formCreator ul.sortable").children("li").each(function(a){$(this).attr("data-position",a),$(this).find("[data-bind='position']").val(a)})}function showFieldSettings(a){var b=$("#fieldSettings_form"),c=$("#fieldSettings_fieldset_form");if(void 0===a)$("#noFieldSelected").show(),c.hide(),b.hide();else{var d,e,f,g=a,h=$("#type_"+g).val(),i=$("#fieldset_"+g);if($("#noFieldSelected").hide(),"fieldset"==h)c.show(),b.hide();else{c.hide(),b.show(),b.find(".dataSettings").children().hide(),b.find(".default").show();var j=$("#fieldSettings_name"),k=$("#fieldSettings_options_required"),l=$("#fieldSettings_options_duplicates"),m=$("#fieldSettings_options_displayTable"),n=$("#fieldSettings_options_readonly"),o=$("#fieldSettings_options_disabled");switch("idno"==h?(j.prop("readonly",!0).val("idno").keyup(),k.prop({checked:!0,disabled:!0}).change(),l.prop({checked:!0,disabled:!0}).change(),m.prop({checked:!0,disabled:!0}).change(),n.prop({checked:!0,disabled:!0}).change(),o.prop({checked:!1,disabled:!0}).change()):"file"==h?m.removeAttr("checked").change().prop("disabled",!0):(j.removeAttr("readonly"),k.removeAttr("disabled"),l.removeAttr("disabled"),n.removeAttr("disabled"),o.removeAttr("disabled"),m.removeAttr("disabled")),h){case"idno":$("#fieldSettings_container_idno").parent().show();break;case"text":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_externalUpdate").parent().hide(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"textarea":$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().hide(),$("#fieldSettings_range_format").parent().removeClass("span4").addClass("span6"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="characters">Characters</option><option value="words">Words</option>');break;case"radio":case"checkbox":case"select":case"multiselect":$("#fieldSettings_container_choices").parent().show();break;case"number":$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").show(),$("#fieldSettings_container_range").parent().show(),$("#fieldSettings_range_step").parent().show(),$("#fieldSettings_range_format").parent().removeClass("span6").addClass("span4"),$("#fieldSettings_range_format option").remove(),$("#fieldSettings_range_format").append('<option value="value">Value</option><option value="digits">Digits</option>');break;case"wysiwyg":$("#fieldSettings_container_placeholder").hide(),$("#fieldSettings_container_value").hide();break;case"file":$("#fieldSettings_container_file_allowedExtensions").parent().show(),$("#fieldSettings_container_file_options").parent().show(),$("#fieldSettings_container_value").hide(),$("#fieldSettings_container_placeholder").hide();break;default:$("#fieldSettings_container_value").show(),$("#fieldSettings_container_placeholder").show()}var p=$("#choicesOptions_"+g).val();if(void 0!==p){var q=$("#fieldSettings_choices_manual");for(d=p.split("%,%"),e="",f=0;f<d.length;f++)e+=addChoice(d[f],$("#choicesDefault_"+g).val());q.html(e).find("input[name=fieldSettings_choices_text]").keyup()}var r=$("#allowedExtensions_"+g).val();if(void 0!==r){var s=$("#fieldSettings_file_allowedExtensions");for(d=r.split("%,%"),e="",s.html(""),f=0;f<d.length;f++)e+=addAllowedExtension(d[f]);s.append(e),s.find(":input[name=fieldSettings_allowedExtension_text]:first").keyup()}var t=$("#metadataStandard_"+g).val();if(void 0!==t){var u=$("#metadataStandard_options");for(d=t.split("%,%"),e="",u.html(""),f=0;f<d.length;f++)e+=addMetadataStandard(d[f]);u.append(e),$(".mdStandardSelect").each(function(){var a=$(this).data("selectvalue");$(this).val(a)})}if("fieldset"!=h){var v=i.parents("li").parents("li");if(v.length>0){var w=v.prop("id").split("_")[1];i.val($("#fieldset_"+w).val())}else i.val("")}else $("#fieldSettings_fieldset").val(i.val());-1!=$.inArray(h,["idno","text","textarea","date","time","wysiwyg"])?$("#fieldVariablesLink").show():$("#fieldVariablesLink").hide(),$("#fieldSettings_externalUpdate_formSelect").change(function(){var a=$(this).val();void 0===choicesFields[a]&&(choicesFields[a]="",$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var b=JSON.parse(a);$.each(b,function(a,b){var c="";$.each(b,function(a,b){c+='<option value="'+b.name+'">'+b.label+"</option>"}),choicesFields[a]=c})})),$("#externalUpdateForm_"+g).val(a).change(),$("#fieldSettings_externalUpdate_fieldSelect").html(choicesFields[a]).change()}),$(".uxOptions").find("input").change(function(){var a=$(this).data("bindmodel"),b=$("."+a);$(this).is(":checked")||$(this).value?b.show():b.hide()}),enableChoiceFunctionality()}}}function fieldSettingsBindings(){var a=$("#formPreview");a.children("li").removeClass("activeField"),$("#fieldSettings_form").find("[data-bindmodel]").bind("change keyup",bindToHiddenForm),a.on("click","li",function(b){if(b.stopPropagation(),$(b.target).is(".icon-remove"))console.log($(this)),removeFormPreviewItem($(b.target));else{var c=$(this).data("id");globalFieldID=c,a.find("[data-bind]").bind("change",setOriginalValues),$(this).hasClass("activeField")||(a.find(".activeField").removeClass("activeField"),$(this).addClass("activeField"),$("#fieldTab a[href='#fieldSettings']").tab("show"),showFieldSettings(c),setInitialBind(),applyFormPreview())}})}function setInitialBind(){var a=globalFieldID;if("undefined"!=typeof a){var b=$("#formPreview").find("[data-id='"+a+"']"),c=b.find(".fieldValues");c.find("[data-bind]").change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues)}}function setOriginalValues(){var a=globalFieldID,b=$(this).data("bind"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#fieldSettings_form").find("[data-bindmodel='"+b+"']"),e=$("#formPreview").find("[data-id='"+a+"']"),f=e.find(".fieldPreview");if("name"==b&&(c=$.trim(c),evaluateSpace(c,d)),"idnoFormat"==b&&(idnoValues.idnoFormat=c),"startIncrement"==b&&(idnoValues.startIncrement=c),"help"==b){var g=c.split("|")[0],h=c.split("|")[1],c="undefined"==h?"":h;$(this).val(g+"|"+h),$("#fieldSettings_help_textarea").val(c).hide(),$("#fieldSettings_help_url").hide().val(c),$("#fieldSettings_help_type").val(g).change()}d.is("input[type=checkbox]")?"true"==c?d.prop("checked",!0):d.prop("checked",!1):d.is("select")?d.find('option[value="'+c+'"]').prop("selected",!0):d.is("input[type=number]")?d.val(parseInt(c)):d.val(c),d.is($("#fieldSettings_choices_type"))&&("manual"==c?($("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide()):($("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show())),"managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"validation"==b&&("regexp"==c?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide()),"choicesForm"==b&&("null"==c||void 0==c?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error"))),"choicesDefault"==b&&$('input[value="'+c+'"]').prev().addClass("active"),"choicesField"==b&&($("#fieldSettings_choices_formSelect").change(),$("#fieldSettings_choices_fieldSelect").val(c).change())}function bindToHiddenForm(){var a=globalFieldID;if("undefined"!=typeof a){var b=$(this).data("bindmodel"),c=$(this).is("input[type=checkbox]")?evaluateCheck($(this)):$(this).val(),d=$("#formPreview").find("[data-id='"+a+"']"),e=($("#formPreview_"+a).find(".fieldLabels"),d.find(".fieldValues")),f=d.find(".fieldPreview");if(e.find("[data-bind='"+b+"']").val(c),"name"==b&&(evaluateSpace(c,$(this)),titleField()),"hidden"==b&&(1==c?f.css("opacity",".5"):f.css("opacity","1")),"choicesType"==b)if("manual"==c)$("#fieldSettings_container_choices").find(".manual_choices").show(),$("#fieldSettings_container_choices").find(".form_choices").hide(),$("#choicesForm_"+a).val("");else{$("#fieldSettings_container_choices").find(".manual_choices").hide(),$("#fieldSettings_container_choices").find(".form_choices").show();var g=e.find($('input[name^="type"]')).val();"multiselect"==g?f.find(".controls").find($("select")).html():"checkbox"==g||"radio"==g?f.find(".controls").find($("label")).remove():"select"==g&&f.find($(".controls")).find($("select")).html(output)}if("managedBy"==b&&("system"==c?$("#fieldSettings_idno_managedBy").next().show():$("#fieldSettings_idno_managedBy").next().hide()),"idnoFormat"==b||"startIncrement"==b||"idnoConfirm"==b){$("#fieldSettings_container_idno_confirm").removeClass("hidden").show();var h=$("#fieldSettings_idno_confirm").is(":checked");h===!1&&idnoValues.idnoFormat?$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled")}if("validation"==b){var i=$("#fieldSettings_validation").val();"regexp"===i?$("#fieldSettings_validationRegex").show():$("#fieldSettings_validationRegex").hide().val("")}if(("helpText"==b||"helpURL"==b)&&formatHelpForHiddenField(e),"helpType"==b){switch($(this).val()){case"text":case"html":$("#fieldSettings_help_textarea").show().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden");break;case"web":$("#fieldSettings_help_url").show().removeClass("hidden"),$("#fieldSettings_help_textarea").hide().removeClass("hidden");break;case"none":case"default":$("#fieldSettings_help_textarea").hide().removeClass("hidden"),$("#fieldSettings_help_url").hide().removeClass("hidden")}formatHelpForHiddenField(e)}applyFormPreview()}}function formatHelpForHiddenField(a){var b,c=$("#fieldSettings_help_type").val(),d=globalFieldID;"text"==c||"html"==c?(b=sanitizeInput($("#fieldSettings_help_textarea").val()),console.log(b)):(b=$("#fieldSettings_help_url").val(),cosnole.log(b),validateURL(b)?$("#fieldSettings_help_url").removeClass("has-error"):$("#fieldSettings_help_url").addClass("has-error"));var e=c+"|"+b;$("#fieldSettings_help_text").val(e),a.find("[data-bind='help']").val(e),$(".helpPreview").popover("destroy"),$(".helpPreview").hide(),"html"===c||"text"===c?($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help",content:"<div>"+b+"</div>",trigger:"click",html:!0})):"web"===c&&($("#formPreview_"+d).find(".helpPreview").show(),$(".helpPreview").popover({title:"Help Url",content:'<div><a href="'+b+'">'+b+"</a></div>",trigger:"click",html:!0}))}function evaluateSpace(a,b){checkForSpaces(a)?(b.addClass("has-error testy"),$(".noSpacesAlert").show(),$("input[type=submit]").addClass("disabled").attr("disabled",!0)):(b.removeClass("has-error"),$("input[type=submit]").removeClass("disabled").removeAttr("disabled"),$(".noSpacesAlert").hide())}function getFormFields(){var a="";return $.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(b){var c=JSON.parse(b);$.each(c,function(b,c){$.each(c,function(b,c){a+='<option value="'+c.name+'">'+c.label+"</option>"})})}),a}function evaluateCheck(a){return a.is(":checked")?!0:!1}function formSettingsBindings(){$("#formTitle").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formTitle").focus()}),$("#formSettings_formTitle").keyup(function(){$("#formTitle").html($(this).val()),0!==$(this).val().length?$('#submitForm input[type="submit"]').prop("disabled",!1).removeClass("disabled"):$('#submitForm input[type="submit"]').prop("disabled",!0).addClass("disabled")}).keyup(),$("#formDescription").on("click",function(){$("#fieldTab a[href='#formSettings']").click(),$("#formSettings_formDescription").focus()}),$("#formSettings_formDescription").keyup(function(){$("#formDescription").html($(this).val())}).keyup(),$("#formSettings_formMetadata").change(function(){var a=$("#fieldAdd"),b=$("#formPreview").find("input[name^=type_][value=idno]");$(this).is(":checked")?($("#formSettings_linkTitle_container").show(),0===b.length?($("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):confirm("Enabling this will remove any existing ID Number fields. Do you want to continue?")?(b.parent().parent().remove(),
$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"),a.find("li:contains('ID Number')").hide(),a.find("li:contains('Paragraph Text')").hide(),a.find("li:contains('Radio')").hide(),a.find("li:contains('Checkboxes')").hide(),a.find("li:contains('Dropdown')").hide(),a.find("li:contains('Multi-Select')").hide(),a.find("li:contains('File Upload')").hide(),a.find("li:contains('WYSIWYG')").hide(),a.find("li:contains('Field Set')").parent().hide().prev().hide()):$(this).removeAttr("checked")):($("#formSettings_linkTitle_container").hide(),a.find("li:contains('ID Number')").show(),a.find("li:contains('Paragraph Text')").show(),a.find("li:contains('Radio')").show(),a.find("li:contains('Checkboxes')").show(),a.find("li:contains('Dropdown')").show(),a.find("li:contains('Multi-Select')").show(),a.find("li:contains('File Upload')").show(),a.find("li:contains('WYSIWYG')").show(),a.find("li:contains('Field Set')").parent().show().prev().show(),0===b.length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}).change()}function modalBindings(){$("#formTypeSelector").modal({show:!1,keyboard:!1,backdrop:"static"}).on("click","button:contains('Metadata')",function(){$(".nav-tabs li:nth-child(3) a").click(),$("#formSettings_formMetadata").prop("checked",!0).change(),$("#formTypeSelector").modal("hide")}).on("click","button:contains('Object')",function(){var a=$("#fieldAdd"),b=($("#formPreview .well"),$("#fieldSettings_label")),c=$("#fieldSettings_options_sortable"),d=$("#fieldSettings_options_searchable");a.find("li:contains('ID Number')").click(),b.val("IDNO").keyup(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),a.find("li:contains('Single Line Text')").click(),$("#fieldSettings_name").val("title").keyup(),b.val("Title").keyup(),$("#fieldSettings_options_required").prop("checked",!0).change(),$("#fieldSettings_options_duplicates").prop("checked",!0).change(),c.prop("checked",!0).change(),d.prop("checked",!0).change(),$("#fieldSettings_options_displayTable").prop("checked",!0).change(),$("#fieldTab li:last a").click(),$("#formPreview li").removeClass("activeField"),$("#formSettings_formMetadata").removeAttr("checked").change(),$("#formTypeSelector").modal("hide"),$("#formSettings_formTitle")})}function addNewField(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c=0;$("#formPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");c<=b[1]&&(c=parseInt(b[1])+1)}}),$(a).attr({id:"formPreview_"+c,"data-id":c}).html('<div class="fieldPreview">'+newFieldPreview(c,b)+'</div><div class="fieldValues">'+newFieldValues(c,b)+"</div>"),$("#formPreview_"+c).click(),$("#formSettings_formMetadata").not(":checked")&&(0===$("#formPreview").find("input[name^=type_][value=idno]").length?$("#formSettings_formProduction").prop({checked:!1,disabled:!0,title:"This form needs an ID Number field."}):$("#formSettings_formProduction").removeAttr("disabled").removeAttr("title"))}function newFieldPreview(a,b,c){var d="";if(void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.choicesOptions="First Choice%,%Second Choice",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),("idno"!=b&&"ID Number"!=b||0!==numIDNOs)&&(d+='<i class="icon-remove"></i>'),d+='<span class="fa fa-question-circle helpPreview"></span>',"Field Set"==b||"fieldset"==b)d+='<fieldset><legend></legend><ul class="unstyled sortable"></ul></fieldset>';else{switch(d+='<div class="control-group"><label class="control-label fieldLabels">Untitled</label><div class="controls">',b){case"ID Number":case"idno":case"Single Line Text":case"text":d+='<input type="text">',numIDNOs++;break;case"Paragraph Text":case"textarea":d+="<textarea></textarea>";break;case"Radio":case"radio":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="radio" checked> '+b+"</label>":'<label> <input type="radio"> '+b+"</label>"})}else d+='<label class="radio"><input type="radio">First Choice</label><label class="radio"><input type="radio">Second Choice</label>';break;case"Checkboxes":case"checkbox":if(c.choicesOptions){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),$.each(e,function(a,b){d+=b==f?'<label> <input type="checkbox" checked> '+b+"</label>":'<label> <input type="checkbox"> '+b+"</label>"})}else d+='<label class="checkbox"><input type="checkbox">First Choice</label><label class="checkbox"><input type="checkbox">Second Choice</label>';break;case"Dropdown":case"select":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+="<select>",$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+="<select></select>";break;case"Number":case"number":d+='<input type="number">';break;case"Email":case"email":d+='<input type="email">';break;case"Phone":case"tel":d+='<input type="tel">';break;case"Date":case"date":d+='<input type="date">';break;case"Time":case"time":d+='<input type="time">';break;case"Website":case"url":d+='<input type="url">';break;case"Multi-Select":case"multiselect":if("manual"==c.choicesType){var e=c.choicesOptions,f=c.choicesDefault;e=e.split("%,%"),d+='<select multiple></select><br><select class="selectPreview">',$.each(e,function(a,b){d+=b==f?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),d+="</select>"}else d+='<select multiple></select><br><select class="selectPreview"></select>';break;case"WYSIWYG":case"wysiwyg":d+='<img src="../includes/img/wysiwyg.png">';break;case"File Upload":case"file":d+='<input type="file" disabled>'}d+="</div></div>"}return d}function newFieldValues(a,b,c){var d="";void 0===c&&(c={},c.validation=determineValidation(b),c.name="Untitled_"+a,c.label="Untitiled",c.help="none|",c.choicesType="manual",c.choicesForm="null",c.publicRelease=!0,c.managedBy="system",c.idnoFormat="st_###"),c.type=determineType(b),b=c.type;var e=["name","position","type","label","value","placeholder","id","class","style","help","helpType","required","duplicates","readonly","disabled","disabledInsert","disabledUpdate","publicRelease","sortable","searchable","displayTable","hidden","validation","validationRegex","access","fieldset","metadataStandard"];switch(d+=createHiddenFields(e,a,c),b){case"idno":var f=["managedBy","idnoFormat"];d+=createHiddenFields(f,a,c),d+='<input type="hidden" id="startIncrement_'+a+'" name="startIncrement_'+a+'"   data-bind="startIncrement"    value="'+(void 0!==c.startIncrement?c.startIncrement:"1")+'">',d+='<input type="hidden" id="idnoConfirm_'+a+'"    name="idnoConfirm_'+a+'"      data-bind"idnoConfirm"        value="false">';break;case"text":var g=["externalUpdateForm","externalUpdateField","min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"textarea":case"number":var g=["min","max","step","format"];d+=createHiddenFields(g,a,c);break;case"radio":case"checkbox":case"select":case"multiselect":var h=["choicesType","choicesNull","choicesDefault","choicesForm","choicesField","choicesFieldDefault"];d+=createHiddenFields(h,a,c),d+='<input type="hidden" id="choicesOptions_'+a+'" name="choicesOptions_'+a+'" data-bind="choicesOptions" value="'+(void 0!==c.choicesOptions?c.choicesOptions:"First Choice%,%Second Choice")+'">';break;case"file":var i=["bgProcessing","multipleFiles","combine","ocr","convert","convertHeight","convertWidth","watermark","watermarkImage","watermarkLocation","border","borderHeight","borderWidth","borderColor","thumbnail","convertAudio","bitRate","audioFormat","convertVideo","videoHeight","videoWidth","videobitRate","aspectRatio","videoFormat","videothumbnail","videoThumbFrames","videoThumbHeight","videoThumbWidth","videoFormatThumb"];d+=createHiddenFields(i,a,c),d+='<input type="hidden" id="allowedExtensions_'+a+'" name="allowedExtensions_'+a+'"     data-bind="allowedExtensions"    value="'+(void 0!==c.allowedExtensions?c.allowedExtensions:"tif%,%tiff%,%jpg")+'">',d+='<input type="hidden" id="convertResolution_'+a+'" name="convertResolution_'+a+'"     data-bind="convertResolution"    value="'+(void 0!==c.convertResolution?c.convertResolution:"192")+'">',d+='<input type="hidden" id="convertFormat_'+a+'"     name="convertFormat_'+a+'"         data-bind="convertFormat"        value="'+(void 0!==c.convertFormat?c.convertFormat:"JPG")+'">',d+='<input type="hidden" id="thumbnailHeight_'+a+'"   name="thumbnailHeight_'+a+'"       data-bind="thumbnailHeight"      value="'+(void 0!==c.thumbnailHeight?c.thumbnailHeight:"150")+'">',d+='<input type="hidden" id="thumbnailWidth_'+a+'"    name="thumbnailWidth_'+a+'"        data-bind="thumbnailWidth"       value="'+(void 0!==c.thumbnailWidth?c.thumbnailWidth:"150")+'">',d+='<input type="hidden" id="thumbnailFormat_'+a+'"   name="thumbnailFormat_'+a+'"       data-bind="thumbnailFormat"      value="'+(void 0!==c.thumbnailFormat?c.thumbnailFormat:"JPG")+'">',d+='<input type="hidden" id="help_'+a+'"   name="help_'+a+'"       data-bind="help"      value="'+(void 0!==c.help?c.help:"none|")+'">'}return d}function determineValidation(a){switch(a){case"Number":case"number":return"integer";case"Email":case"email":return"emailAddr";case"Phone":case"tel":return"phoneNumber";case"Date":case"date":return"date";case"Website":case"url":return"url";default:return}}function determineType(a){switch(a){case"ID Number":case"idno":return"idno";case"Single Line Text":case"text":return"text";case"Paragraph Text":case"textarea":return"textarea";case"Radio":case"radio":return"radio";case"Checkboxes":case"checkbox":return"checkbox";case"Dropdown":case"select":return"select";case"Number":case"number":return"number";case"Email":case"email":return"email";case"Phone":case"tel":return"tel";case"Date":case"date":return"date";case"Time":case"time":return"time";case"Website":case"url":return"url";case"Multi-Select":case"multiselect":return"multiselect";case"WYSIWYG":case"wysiwyg":return"wysiwyg";case"File Upload":case"file":return"file";case"Field Set":case"fieldset":return"fieldset";default:return}}function createHiddenFields(a,b,c){return output="",$.each(a,function(a,d){var e=d+"_"+b,f=void 0!==c[d]?c[d]:"";output+='<input type="hidden" id="'+e+'" name="'+e+'" data-bind="'+d+'" value="'+f+'"/>'}),output}function addChoice(a,b){return"undefined"==typeof a?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':"undefined"==typeof b?'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>':'<div class="input-prepend input-append choicesItem" data-itemtype="choice"><button name="default" class="btn'+(a==b?" active":"")+'" type="button" data-toggle="buttons-radio" title="Set this choice as the default."><i class="icon-ok"></i></button><input name="fieldSettings_choices_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add a choice."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this choice."><i class="icon-remove"></i></button></div>'}function addAllowedExtension(a){return"undefined"==typeof a&&(a=""),'<div class="row-fluid input-append extensionItem" data-itemtype="extension"><input name="fieldSettings_allowedExtension_text" type="text" value="'+a+'"><button name="add" class="btn" type="button" title="Add an extension."><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove this extension."><i class="icon-remove"></i></button></div>'}function addMetadataStandard(a){"undefined"==typeof a&&(a="");var b=metadataSchema,c=a.split(" : ")[1],d=a.split(" : ")[0];"undefined"==typeof c&&(c=""),"undefined"==typeof d&&(d="");var e='<select class="input-block-level form-control mdStandardSelect" id="fieldSettings_standardType" name="fieldSettings_standardType" data-selectvalue="'+d+'"><option value=""> None </option>'+b+"</select>";return'<div class="row-fluid input-append metadata-item" data-itemtype="metadataStandard">'+e+'<input name="fieldSettings_metadataIdentifer" type="text" value="'+c+'"><button name="add" class="btn" type="button" title="Add Metadata Standard"><i class="icon-plus"></i></button><button name="remove" class="btn" type="button" title="Remove Metadata Standard"><i class="icon-remove"></i></button></div>'}function enableChoiceFunctionality(){$(".choicesItem").find($("input[type=text], select")).bind("change keyup",modifyChoiceBinding).change(),$(".extensionItem").find($("input[type=text], select")).bind("change keyup",extensionBinding).change(),$(".metadata-item").find($("input[type=text], select")).bind("change keyup",metadataBinding).change(),$("#fieldSettings_choices_null").change(function(){$(".input-append").find("input[type=text]").change()}),$(".input-append").find("button").click(function(){var a=$(this).attr("name"),b=$(this).parent().data("itemtype");if("add"==a)"choice"==b?$(this).parent().after(addChoice()):"extension"==b?$(this).parent().after(addAllowedExtension()):$(this).parent().after(addMetadataStandard()),$(".input-append").find("button").unbind("click"),enableChoiceFunctionality();else if("remove"==a)$(this).parent().remove(),$(".input-append").find($("input[type=text]")).change();else if("default"==a){var c=$(this).next().val(),d=globalFieldID;$("#choicesDefault_"+d).val(c),$('button[name="default"]').removeClass("active"),$(this).hasClass("focus")&&$(this).addClass("selected")}}),$("#fieldSettings_choices_formSelect").change(function(){var a=$(this).val();if("null"==a?($('select[data-bindmodel="choicesField"]').addClass("has-error").html(""),$("#fieldSettings_choices_formSelect").addClass("has-error")):($('select[data-bindmodel="choicesField"]').removeClass("has-error"),$("#fieldSettings_choices_formSelect").removeClass("has-error")),void 0===choicesFields[a]){var b;choicesFields[null]=b,$.ajax({url:"../includes/getFormFields.php",async:!1}).always(function(a){var c=JSON.parse(a);$.each(c,function(a,c){b="<option value> Select A Field</option>",$.each(c,function(a,c){b+='<option value="'+c.name+'">'+c.label+"</option>"}),choicesFields[a]=b})})}$("#fieldSettings_choices_fieldSelect").html(choicesFields[a])})}function modifyChoiceBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".choicesOptions").val(b).change(),$("#fieldSettings_choices_null").is(":checked")&&a.unshift("Make A Selection");for(var c=$("#formPreview_"+globalFieldID),d=c.find($("#type_"+globalFieldID)).val(),e="",f=0;f<a.length;f++)"multiselect"==d||"select"==d?e+="<option value='"+a[f]+"'>"+a[f]+"</option>":"checkbox"==d?e+="<label for='checkbox'><input type='checkbox'/>"+a[f]+"</label>":"radio"==d&&(e+="<label for='checkbox'><input type='radio'/>"+a[f]+"</label>");if("multiselect"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}else if("checkbox"==d||"radio"==d){var g=c.find($(".controls"));g.find($("label")).remove(),g.append(e)}else if("select"==d){var g=c.find($(".controls")).find($("select"));g.html(e)}}function extensionBinding(){var a=[];$(this).parent().parent().find($("input[type=text]")).each(function(b){value=$(this).val(),a[b]=value});var b=a.join("%,%");$(".allowedExtensions").val(b).change();var c=$("#fieldSettings_file_allowedExtensions").children().length;1>=c?$("#allowedExtensionsAlert").show():$("#allowedExtensionsAlert").hide(),1>c&&$(this).parent().after(addAllowedExtension())}function metadataBinding(){var a=[];$(this).parent().data("itemtype"),$(this).parent().parent().find($("input[type=text]")).each(function(b){var c=$(this).prev("select").val();value=c+" : "+$(this).val(),a[b]=value});var b=a.join("%,%");$(".metadataStandard").val(b).change()}function titleField(){var a=$("#formSettings_objectTitleField"),b="";$("#formPreview").find($(":input[type=text]")).each(function(){var a=($(this).parent().parent().parent().next("div").find($("input[name^='label']")).val(),$(this).parent().parent().parent().next("div").find($("input[name^='name']")).val());"idno"===a||(b+="<option value='"+a+"'>"+a+"</option>")}),a.html(b)}function validateURL(a){var b=/^((https?|ftp):\/\/)?([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;return b.test(a)}function checkForSpaces(a){return/\s/g.test(a)}function removeHtml(a){return a.replace(/&/g,"&amp;").replace(/>/g,"").replace(/</g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"")}function isEmpty(a){return!a||0===a.length}function removeItemFromID(a,b){var c=b.selectedIndex;if(-1!=c){for(i=b.length-1;i>=0;i--)b.options[i].selected&&(b.options[i]=null);b.length>0&&(b.selectedIndex=0==c?0:c-1)}}function selectAllOnSubmit(a){var b=document.getElementById(a);if(null!=b)for(i=b.length-1;i>=0;i--)b.options[i].selected=!0}function entrySubmit(){return selectAllOnSubmit("selectedEntryUsers"),selectAllOnSubmit("selectedViewUsers"),selectAllOnSubmit("selectedUsersAdmins"),!0}function settingsBindings(){var a=$("#GroupingsPreview");$("#GroupingsPreview").on("click","li",function(b){b.stopPropagation(),$(this).hasClass("activeField well")||(a.find(".activeField").removeClass("activeField well"),$(this).addClass("activeField well"),showSettings($(this).prop("id")))}),$("#groupingsSettings_grouping").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val(),e=b.find(".groupingPreview"),f=e.find("i"),g=e.find("ul"),h=e.contents();h.slice(h.index(f)+1,h.index(g)).remove(),g.before(d),b.find("input[name^=nav_grouping_]").val(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_label").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").text(d),$("#nav_label_"+c).val(d)}),$("#groupingsSettings_url").keyup(function(){var b=a.find(".well"),c=b.prop("id").split("_")[1],d=$(this).val();b.find("a").prop("href",d),$("#nav_url_"+c).val(d)})}function showSettings(a){if($("#groupingsSettings").children().hide(),$("#groupingTab a[href='#groupingsSettings']").tab("show"),void 0===a)$("#noGroupingSelected").show();else{var b=a.split("_")[1],c=$("#nav_type_"+b).val(),d=$("#nav_grouping_"+b);if("grouping"==c)$("#groupingsSettings_container_grouping").show(),$("#groupingsSettings_grouping").val(d.val()).keyup();else{switch(c){case"logout":case"link":$("#groupingsSettings_container_label").show(),$("#groupingsSettings_container_url").show();break;case"export":case"objectForm":case"metadataForm":$("#groupingsSettings_container_label").show()}if("objectForm"==c||"metadataForm"==c?$("#groupingsSettings_label").prop("disabled",!0):$("#groupingsSettings_label").removeAttr("disabled"),"grouping"!=c){var e=d.parents("li").parents("li");if(e.length>0){var f=e.prop("id").split("_")[1];d.val($("#nav_grouping_"+f).val())}else d.val("")}else $("#groupingsSettings_grouping").val(d.val());$("#groupingsSettings_label").val($("#nav_label_"+b).val()).keyup(),$("#groupingsSettings_url").val($("#nav_url_"+b).val()).keyup()}}}function addNew(a){$(a).removeClass("ui-draggable");var b=$("a",a).text(),c={};$(a).data("type")&&(c.type=b=$(a).data("type"),c.label=$("a",a).text()),$(a).data("formid")&&(c.formID=$(a).data("formid"));var d=0;$("#GroupingsPreview li").each(function(){if($(this)[0]!==$(a)[0]){var b=$(this).attr("id").split("_");d<=b[1]&&(d=parseInt(b[1])+1)}}),$(a).attr({id:"GroupingsPreview_"+d}).html('<div class="groupingPreview">'+newGroupingPreview(b,c)+'</div><div class="groupingValues">'+newGroupingValues(d,b,c)+"</div>"),$("#GroupingsPreview_"+d).click()}function newGroupingPreview(a,b){var c;return c='<i class="icon-remove"></i>',c+="New Grouping"==a||"grouping"==a?'<ul class="unstyled sortable"></ul>':void 0===b||null===b?'<a href="#">[Link]</a>':'<a href="'+(void 0!==b.url?b.url:"")+'">'+(void 0!==b.label?b.label:"Untitled")+"</a>"}function newGroupingValues(a,b,c){var d;switch(void 0===c&&(c={}),b){case"New Grouping":case"grouping":b=c.type="grouping";break;case"Log Out":case"logout":b=c.type="logout";break;case"Export Link":case"export":b=c.type="export";break;case"Link":case"link":b=c.type="link"}switch(d='<input type="hidden" id="nav_position_'+a+'" name="nav_position_'+a+'" value="'+(void 0!==c.position?c.position:"")+'">',d+='<input type="hidden" id="nav_type_'+a+'" name="nav_type_'+a+'" value="'+(void 0!==c.type?c.type:b)+'">',d+='<input type="hidden" id="nav_label_'+a+'" name="nav_label_'+a+'" value="'+(void 0!==c.label?c.label:"Untitled")+'">',d+='<input type="hidden" id="nav_url_'+a+'" name="nav_url_'+a+'" value="'+(void 0!==c.url?c.url:"")+'">',d+='<input type="hidden" id="nav_grouping_'+a+'" name="nav_grouping_'+a+'" value="'+(void 0!==c.grouping?c.grouping:"")+'">',b){case"objectForm":case"metadataForm":d+='<input type="hidden" id="nav_formID_'+a+'" name="nav_formID_'+a+'" value="'+(void 0!==c.formID?c.formID:"")+'">'}return d}function sortableNav(){$("#navigation ul.sortable").sortable({connectWith:"#navigation ul.sortable",revert:!0,placeholder:"highlight",update:function(a,b){$(b.item).hasClass("ui-draggable")&&("New Grouping"==$(b.item).text()&&"GroupingsPreview"!=$(b.item).parent().attr("id")&&$(b.item).remove(),addNew(b.item)),$(b.item).parents("li").click(),$(b.item).click(),sortableNav()}})}var globalFieldID,choicesFields={},idnoValues={};$(function(){var a=$("#formPreview"),b=$("#fieldAdd"),c=$("#formSettings"),d=$("#fieldTab");$("#leftPanel"),performance.now();sortableForm(),fieldSettingsBindings(),formSettingsBindings(),modalBindings(),applyFormPreview(),d.on("click","a",function(){$("li",a).removeClass("well activeField"),showFieldSettings()}),$(document).keyup(function(a){27==a.keyCode&&($("#formPreview li").removeClass("activeField"),$(".addFieldNav").click().tab("show"))}),$(".draggable li",b).draggable({connectToSortable:"#formCreator ul.sortable",helper:"clone",revert:"invalid"}).click(function(){event.preventDefault(),$(this).clone().appendTo(a),addNewField($("li:last",a)),sortableForm()}),$(".fieldValues :input[name^='type_'][value='fieldset']").each(function(){var a=$(this).closest("li").prop("id");$(".fieldValues :input[name^='fieldset_'][value='"+$(this).siblings(":input[name^='fieldset_']").val()+"']").each(function(){a!=$(this).closest("li").prop("id")&&$(this).closest("li").detach().appendTo($("#"+a+" ul"))})}),$("form[name=submitForm]").submit(function(a){0===$("#formSettings_objectDisplayTitle").val().length&&$("#formSettings_objectDisplayTitle").val($("#formSettings_formTitle").val()).change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues),$("#fieldSettings_form").find("[data-bindmodel]").unbind("change keyup",bindToHiddenForm);var b={};$(":input",c).each(function(){var a=$(this).prop("name").split("_");"checkbox"==$(this).prop("type")?b[a[1]]=$(this).prop("checked"):b[a[1]]=$(this).val()}),$(":input[name=form]",this).val(JSON.stringify(b));var b={};$(".fieldValues :input").each(function(){var a=$(this).prop("name").split("_");b[a[1]]||(b[a[1]]={}),$(this).is('[id^="choicesOptions_"]')||$(this).is('[id^="allowedExtensions_"]')?(b[a[1]][a[0]]={},b[a[1]][a[0]]=$(this).val().split("%,%")):b[a[1]][a[0]]=$(this).val()});for(var d in b)("fieldset"==b[d].type||"Field Set"==b[d].type)&&delete b[d];$(":input[name=fields]",this).val(JSON.stringify(b))}),$("#fieldTab li:nth-child(3)").find("a").click(),0==$(".unassignedForms li").length?$(".unassignedForms").hide():$(".unassignedForms").show(),$(".navigationCreator").click(function(){$("#groupingTab li:first-child").find("a").click().tab("show")}),$(":submit").removeAttr("disabled")});var numIDNOs=0;String.prototype.sanitizeInput=function(){var a=/<\/?(script|embed|object|frameset|frame|iframe|meta|link|style).*?>/gim;return this.replace(a,"")},String.prototype.escapeHtml=function(){var a=this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;");return a},String.prototype.unEscapeHtml=function(){var a=this.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/g,"/");return a},$(function(){$("form[name=submitPermissions]").submit(function(){entrySubmit()})}),$(function(){var a=$("#GroupingsPreview");$("#groupingTab").on("click","a",function(){a.find("li").removeClass("well"),showSettings()}),$("#groupingsAdd .draggable li").draggable({connectToSortable:"#navigation ul.sortable",helper:"clone",revert:"invalid",cancel:".noDrag"}),$("#groupingsAdd").on("click","li",function(b){b.preventDefault(),$(this).hasClass("noDrag")||($(this).clone().appendTo(a),addNew(a.find("li:last")),sortableNav())}),$("#deleteFormBtn-Cancel").click(function(){$("a[href='#formCreator']").click()}),$("#deleteFormBtn-Submit").click(function(a){"yes"==prompt("Last chance!\nAre you sure you want to permanently delete this form?\n\nAnything but 'yes' will cancel").toLowerCase()&&$("#deleteFormFrm").submit()}),a.on("click",".groupingPreview i.icon-remove",function(){if(confirm("Are you sure you want to remove this grouping?")){var a=$(this).parent().parent();"grouping"==$(this).parent().next().children(":input[name^=nav_type_]").val()&&a.after($(this).next().find("li")),a.remove()}}).on("click","a",function(a){a.preventDefault()}),$(".groupingValues :input[name^='nav_type_'][value='grouping']").each(function(){var a=$(this).parents("li").prop("id");$(".groupingValues :input[name^='nav_grouping_'][value='"+$(this).siblings(":input[name^='nav_grouping_']").val()+"']").each(function(){a!=$(this).parents("li").prop("id")&&$(this).parents("li").detach().appendTo($("#"+a+" ul"))})}),sortableNav(),settingsBindings(),$("form[name=submitNavigation]").submit(function(b){$(".groupingValues :input[name^=nav_position_]").each(function(a){$(this).val(a)});var c={};$(".groupingValues :input").each(function(){var a=$(this).prop("name").split("_");c[a[2]]||(c[a[2]]={}),c[a[2]][a[1]]=$(this).val()});for(var d in c)"grouping"==c[d].type&&delete c[d];$(":input[name=groupings]",this).val(JSON.stringify(c)),$("#groupingsSettings :input").prop("disabled",!0),a.find(":input").prop("disabled",!0)})}),$(function(){$("div.fineUploader").each(function(a,b){var c=$(b),d=c.closest("form"),e=c.data("upload_id"),f=c.data("multiple"),g=c.data("allowed_extensions").split(",");c.fineUploader({request:{endpoint:siteRoot+"includes/uploader.php",params:{engineCSRFCheck:csrfToken,uploadID:e,multiple:f}},failedUploadTextDisplay:{mode:"custom",maxChars:40,responseProperty:"error",enableTooltip:!0},multiple:f,validation:{allowedExtensions:g},text:{uploadButton:'<div class="uploadText"> <i class="fa fa-upload fa-4x"></i> <br> Drag or Click Here <br> To Upload Files </div>',dropButton:"HELP"},showMessage:function(a){c.find(".qq-upload-list").append('<li class="alert alert-danger">'+a+"</li >")},classes:{success:"alert alert-success",fail:"alert alert-danger"}}).on("submit",function(){var a=d.data("uploads_working"),b="undefined"==typeof a?0:parseInt(a);d.data("uploads_working",++b).find(":submit").attr("disabled","disabled")}).on("complete cancel",function(){var a=parseInt(d.data("uploads_working"));a--,d.data("uploads_working",a),0==a&&d.find(":submit").removeAttr("disabled","disabled")})}),$(".fineUploader").parent().addClass("uploadFiles"),$(".qq-upload-drop-area").html('<div class="uploadText"> <i class="fa fa-dropbox fa-4x"></i> <br><br> Drop Files Here </div>'),$("div.filePreview a.previewLink").click(function(){var a=$(this).closest("div");a.hasClass("open")?a.removeClass("open").find("div").slideUp():a.addClass("open").find("div").slideDown()})});var globalFieldID,choicesFields={},idnoValues={};$(function(){var a=$("#formPreview"),b=$("#fieldAdd"),c=$("#formSettings"),d=$("#fieldTab");$("#leftPanel"),performance.now(),sortableForm(),fieldSettingsBindings(),formSettingsBindings(),modalBindings(),applyFormPreview(),d.on("click","a",function(){$("li",a).removeClass("well activeField"),showFieldSettings()}),$(document).keyup(function(a){27==a.keyCode&&($("#formPreview li").removeClass("activeField"),$(".addFieldNav").click().tab("show"))}),$(".draggable li",b).draggable({connectToSortable:"#formCreator ul.sortable",helper:"clone",revert:"invalid"}).click(function(){event.preventDefault(),$(this).clone().appendTo(a),addNewField($("li:last",a)),sortableForm()}),$(".fieldValues :input[name^='type_'][value='fieldset']").each(function(){var a=$(this).closest("li").prop("id");$(".fieldValues :input[name^='fieldset_'][value='"+$(this).siblings(":input[name^='fieldset_']").val()+"']").each(function(){a!=$(this).closest("li").prop("id")&&$(this).closest("li").detach().appendTo($("#"+a+" ul"))})}),$("form[name=submitForm]").submit(function(a){0===$("#formSettings_objectDisplayTitle").val().length&&$("#formSettings_objectDisplayTitle").val($("#formSettings_formTitle").val()).change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues),$("#fieldSettings_form").find("[data-bindmodel]").unbind("change keyup",bindToHiddenForm);var b={};$(":input",c).each(function(){var a=$(this).prop("name").split("_");"checkbox"==$(this).prop("type")?b[a[1]]=$(this).prop("checked"):b[a[1]]=$(this).val()}),$(":input[name=form]",this).val(JSON.stringify(b));var b={};$(".fieldValues :input").each(function(){var a=$(this).prop("name").split("_");b[a[1]]||(b[a[1]]={}),$(this).is('[id^="choicesOptions_"]')||$(this).is('[id^="allowedExtensions_"]')?(b[a[1]][a[0]]={},b[a[1]][a[0]]=$(this).val().split("%,%")):b[a[1]][a[0]]=$(this).val()});for(var d in b)("fieldset"==b[d].type||"Field Set"==b[d].type)&&delete b[d];$(":input[name=fields]",this).val(JSON.stringify(b))}),$("#fieldTab li:nth-child(3)").find("a").click(),0==$(".unassignedForms li").length?$(".unassignedForms").hide():$(".unassignedForms").show(),$(".navigationCreator").click(function(){$("#groupingTab li:first-child").find("a").click().tab("show")}),$(":submit").removeAttr("disabled")});var numIDNOs=0;String.prototype.sanitizeInput=function(){var a=/<\/?(script|embed|object|frameset|frame|iframe|meta|link|style).*?>/gim;return this.replace(a,"")},String.prototype.escapeHtml=function(){var a=this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;");return a},String.prototype.unEscapeHtml=function(){var a=this.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/g,"/");return a},$(function(){$("form[name=submitPermissions]").submit(function(){entrySubmit()})}),$(function(){var a=$("#GroupingsPreview");$("#groupingTab").on("click","a",function(){a.find("li").removeClass("well"),showSettings()}),$("#groupingsAdd .draggable li").draggable({
connectToSortable:"#navigation ul.sortable",helper:"clone",revert:"invalid",cancel:".noDrag"}),$("#groupingsAdd").on("click","li",function(b){b.preventDefault(),$(this).hasClass("noDrag")||($(this).clone().appendTo(a),addNew(a.find("li:last")),sortableNav())}),$("#deleteFormBtn-Cancel").click(function(){$("a[href='#formCreator']").click()}),$("#deleteFormBtn-Submit").click(function(a){"yes"==prompt("Last chance!\nAre you sure you want to permanently delete this form?\n\nAnything but 'yes' will cancel").toLowerCase()&&$("#deleteFormFrm").submit()}),a.on("click",".groupingPreview i.icon-remove",function(){if(confirm("Are you sure you want to remove this grouping?")){var a=$(this).parent().parent();"grouping"==$(this).parent().next().children(":input[name^=nav_type_]").val()&&a.after($(this).next().find("li")),a.remove()}}).on("click","a",function(a){a.preventDefault()}),$(".groupingValues :input[name^='nav_type_'][value='grouping']").each(function(){var a=$(this).parents("li").prop("id");$(".groupingValues :input[name^='nav_grouping_'][value='"+$(this).siblings(":input[name^='nav_grouping_']").val()+"']").each(function(){a!=$(this).parents("li").prop("id")&&$(this).parents("li").detach().appendTo($("#"+a+" ul"))})}),sortableNav(),settingsBindings(),$("form[name=submitNavigation]").submit(function(b){$(".groupingValues :input[name^=nav_position_]").each(function(a){$(this).val(a)});var c={};$(".groupingValues :input").each(function(){var a=$(this).prop("name").split("_");c[a[2]]||(c[a[2]]={}),c[a[2]][a[1]]=$(this).val()});for(var d in c)"grouping"==c[d].type&&delete c[d];$(":input[name=groupings]",this).val(JSON.stringify(c)),$("#groupingsSettings :input").prop("disabled",!0),a.find(":input").prop("disabled",!0)})}),$(function(){$("div.fineUploader").each(function(a,b){var c=$(b),d=c.closest("form"),e=c.data("upload_id"),f=c.data("multiple"),g=c.data("allowed_extensions").split(",");c.fineUploader({request:{endpoint:siteRoot+"includes/uploader.php",params:{engineCSRFCheck:csrfToken,uploadID:e,multiple:f}},failedUploadTextDisplay:{mode:"custom",maxChars:40,responseProperty:"error",enableTooltip:!0},multiple:f,validation:{allowedExtensions:g},text:{uploadButton:'<div class="uploadText"> <i class="fa fa-upload fa-4x"></i> <br> Drag or Click Here <br> To Upload Files </div>',dropButton:"HELP"},showMessage:function(a){c.find(".qq-upload-list").append('<li class="alert alert-danger">'+a+"</li >")},classes:{success:"alert alert-success",fail:"alert alert-danger"}}).on("submit",function(){var a=d.data("uploads_working"),b="undefined"==typeof a?0:parseInt(a);d.data("uploads_working",++b).find(":submit").attr("disabled","disabled")}).on("complete cancel",function(){var a=parseInt(d.data("uploads_working"));a--,d.data("uploads_working",a),0==a&&d.find(":submit").removeAttr("disabled","disabled")})}),$(".fineUploader").parent().addClass("uploadFiles"),$(".qq-upload-drop-area").html('<div class="uploadText"> <i class="fa fa-dropbox fa-4x"></i> <br><br> Drop Files Here </div>'),$("div.filePreview a.previewLink").click(function(){var a=$(this).closest("div");a.hasClass("open")?a.removeClass("open").find("div").slideUp():a.addClass("open").find("div").slideDown()})});var globalFieldID,choicesFields={},idnoValues={};$(function(){var a=$("#formPreview"),b=$("#fieldAdd"),c=$("#formSettings"),d=$("#fieldTab");$("#leftPanel"),performance.now(),sortableForm(),fieldSettingsBindings(),formSettingsBindings(),modalBindings(),applyFormPreview(),d.on("click","a",function(){$("li",a).removeClass("well activeField"),showFieldSettings()}),$(document).keyup(function(a){27==a.keyCode&&($("#formPreview li").removeClass("activeField"),$(".addFieldNav").click().tab("show"))}),$(".draggable li",b).draggable({connectToSortable:"#formCreator ul.sortable",helper:"clone",revert:"invalid"}).click(function(){event.preventDefault(),$(this).clone().appendTo(a),addNewField($("li:last",a)),sortableForm()}),$(".fieldValues :input[name^='type_'][value='fieldset']").each(function(){var a=$(this).closest("li").prop("id");$(".fieldValues :input[name^='fieldset_'][value='"+$(this).siblings(":input[name^='fieldset_']").val()+"']").each(function(){a!=$(this).closest("li").prop("id")&&$(this).closest("li").detach().appendTo($("#"+a+" ul"))})}),$("form[name=submitForm]").submit(function(a){0===$("#formSettings_objectDisplayTitle").val().length&&$("#formSettings_objectDisplayTitle").val($("#formSettings_formTitle").val()).change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues),$("#fieldSettings_form").find("[data-bindmodel]").unbind("change keyup",bindToHiddenForm);var b={};$(":input",c).each(function(){var a=$(this).prop("name").split("_");"checkbox"==$(this).prop("type")?b[a[1]]=$(this).prop("checked"):b[a[1]]=$(this).val()}),$(":input[name=form]",this).val(JSON.stringify(b));var b={};$(".fieldValues :input").each(function(){var a=$(this).prop("name").split("_");b[a[1]]||(b[a[1]]={}),$(this).is('[id^="choicesOptions_"]')||$(this).is('[id^="allowedExtensions_"]')?(b[a[1]][a[0]]={},b[a[1]][a[0]]=$(this).val().split("%,%")):b[a[1]][a[0]]=$(this).val()});for(var d in b)("fieldset"==b[d].type||"Field Set"==b[d].type)&&delete b[d];$(":input[name=fields]",this).val(JSON.stringify(b))}),$("#fieldTab li:nth-child(3)").find("a").click(),0==$(".unassignedForms li").length?$(".unassignedForms").hide():$(".unassignedForms").show(),$(".navigationCreator").click(function(){$("#groupingTab li:first-child").find("a").click().tab("show")}),$(":submit").removeAttr("disabled")});var numIDNOs=0;String.prototype.sanitizeInput=function(){var a=/<\/?(script|embed|object|frameset|frame|iframe|meta|link|style).*?>/gim;return this.replace(a,"")},String.prototype.escapeHtml=function(){var a=this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;");return a},String.prototype.unEscapeHtml=function(){var a=this.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/g,"/");return a},$(function(){$("form[name=submitPermissions]").submit(function(){entrySubmit()})}),$(function(){var a=$("#GroupingsPreview");$("#groupingTab").on("click","a",function(){a.find("li").removeClass("well"),showSettings()}),$("#groupingsAdd .draggable li").draggable({connectToSortable:"#navigation ul.sortable",helper:"clone",revert:"invalid",cancel:".noDrag"}),$("#groupingsAdd").on("click","li",function(b){b.preventDefault(),$(this).hasClass("noDrag")||($(this).clone().appendTo(a),addNew(a.find("li:last")),sortableNav())}),$("#deleteFormBtn-Cancel").click(function(){$("a[href='#formCreator']").click()}),$("#deleteFormBtn-Submit").click(function(a){"yes"==prompt("Last chance!\nAre you sure you want to permanently delete this form?\n\nAnything but 'yes' will cancel").toLowerCase()&&$("#deleteFormFrm").submit()}),a.on("click",".groupingPreview i.icon-remove",function(){if(confirm("Are you sure you want to remove this grouping?")){var a=$(this).parent().parent();"grouping"==$(this).parent().next().children(":input[name^=nav_type_]").val()&&a.after($(this).next().find("li")),a.remove()}}).on("click","a",function(a){a.preventDefault()}),$(".groupingValues :input[name^='nav_type_'][value='grouping']").each(function(){var a=$(this).parents("li").prop("id");$(".groupingValues :input[name^='nav_grouping_'][value='"+$(this).siblings(":input[name^='nav_grouping_']").val()+"']").each(function(){a!=$(this).parents("li").prop("id")&&$(this).parents("li").detach().appendTo($("#"+a+" ul"))})}),sortableNav(),settingsBindings(),$("form[name=submitNavigation]").submit(function(b){$(".groupingValues :input[name^=nav_position_]").each(function(a){$(this).val(a)});var c={};$(".groupingValues :input").each(function(){var a=$(this).prop("name").split("_");c[a[2]]||(c[a[2]]={}),c[a[2]][a[1]]=$(this).val()});for(var d in c)"grouping"==c[d].type&&delete c[d];$(":input[name=groupings]",this).val(JSON.stringify(c)),$("#groupingsSettings :input").prop("disabled",!0),a.find(":input").prop("disabled",!0)})}),$(function(){$("div.fineUploader").each(function(a,b){var c=$(b),d=c.closest("form"),e=c.data("upload_id"),f=c.data("multiple"),g=c.data("allowed_extensions").split(",");c.fineUploader({request:{endpoint:siteRoot+"includes/uploader.php",params:{engineCSRFCheck:csrfToken,uploadID:e,multiple:f}},failedUploadTextDisplay:{mode:"custom",maxChars:40,responseProperty:"error",enableTooltip:!0},multiple:f,validation:{allowedExtensions:g},text:{uploadButton:'<div class="uploadText"> <i class="fa fa-upload fa-4x"></i> <br> Drag or Click Here <br> To Upload Files </div>',dropButton:"HELP"},showMessage:function(a){c.find(".qq-upload-list").append('<li class="alert alert-danger">'+a+"</li >")},classes:{success:"alert alert-success",fail:"alert alert-danger"}}).on("submit",function(){var a=d.data("uploads_working"),b="undefined"==typeof a?0:parseInt(a);d.data("uploads_working",++b).find(":submit").attr("disabled","disabled")}).on("complete cancel",function(){var a=parseInt(d.data("uploads_working"));a--,d.data("uploads_working",a),0==a&&d.find(":submit").removeAttr("disabled","disabled")})}),$(".fineUploader").parent().addClass("uploadFiles"),$(".qq-upload-drop-area").html('<div class="uploadText"> <i class="fa fa-dropbox fa-4x"></i> <br><br> Drop Files Here </div>'),$("div.filePreview a.previewLink").click(function(){var a=$(this).closest("div");a.hasClass("open")?a.removeClass("open").find("div").slideUp():a.addClass("open").find("div").slideDown()})});var globalFieldID,choicesFields={},idnoValues={};$(function(){var a=$("#formPreview"),b=$("#fieldAdd"),c=$("#formSettings"),d=$("#fieldTab");$("#leftPanel"),performance.now(),sortableForm(),fieldSettingsBindings(),formSettingsBindings(),modalBindings(),applyFormPreview(),d.on("click","a",function(){$("li",a).removeClass("well activeField"),showFieldSettings()}),$(document).keyup(function(a){27==a.keyCode&&($("#formPreview li").removeClass("activeField"),$(".addFieldNav").click().tab("show"))}),$(".draggable li",b).draggable({connectToSortable:"#formCreator ul.sortable",helper:"clone",revert:"invalid"}).click(function(){event.preventDefault(),$(this).clone().appendTo(a),addNewField($("li:last",a)),sortableForm()}),$(".fieldValues :input[name^='type_'][value='fieldset']").each(function(){var a=$(this).closest("li").prop("id");$(".fieldValues :input[name^='fieldset_'][value='"+$(this).siblings(":input[name^='fieldset_']").val()+"']").each(function(){a!=$(this).closest("li").prop("id")&&$(this).closest("li").detach().appendTo($("#"+a+" ul"))})}),$("form[name=submitForm]").submit(function(a){0===$("#formSettings_objectDisplayTitle").val().length&&$("#formSettings_objectDisplayTitle").val($("#formSettings_formTitle").val()).change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues),$("#fieldSettings_form").find("[data-bindmodel]").unbind("change keyup",bindToHiddenForm);var b={};$(":input",c).each(function(){var a=$(this).prop("name").split("_");"checkbox"==$(this).prop("type")?b[a[1]]=$(this).prop("checked"):b[a[1]]=$(this).val()}),$(":input[name=form]",this).val(JSON.stringify(b));var b={};$(".fieldValues :input").each(function(){var a=$(this).prop("name").split("_");b[a[1]]||(b[a[1]]={}),$(this).is('[id^="choicesOptions_"]')||$(this).is('[id^="allowedExtensions_"]')?(b[a[1]][a[0]]={},b[a[1]][a[0]]=$(this).val().split("%,%")):b[a[1]][a[0]]=$(this).val()});for(var d in b)("fieldset"==b[d].type||"Field Set"==b[d].type)&&delete b[d];$(":input[name=fields]",this).val(JSON.stringify(b))}),$("#fieldTab li:nth-child(3)").find("a").click(),0==$(".unassignedForms li").length?$(".unassignedForms").hide():$(".unassignedForms").show(),$(".navigationCreator").click(function(){$("#groupingTab li:first-child").find("a").click().tab("show")}),$(":submit").removeAttr("disabled")});var numIDNOs=0;String.prototype.sanitizeInput=function(){var a=/<\/?(script|embed|object|frameset|frame|iframe|meta|link|style).*?>/gim;return this.replace(a,"")},String.prototype.escapeHtml=function(){var a=this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;");return a},String.prototype.unEscapeHtml=function(){var a=this.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/g,"/");return a},$(function(){$("form[name=submitPermissions]").submit(function(){entrySubmit()})}),$(function(){var a=$("#GroupingsPreview");$("#groupingTab").on("click","a",function(){a.find("li").removeClass("well"),showSettings()}),$("#groupingsAdd .draggable li").draggable({connectToSortable:"#navigation ul.sortable",helper:"clone",revert:"invalid",cancel:".noDrag"}),$("#groupingsAdd").on("click","li",function(b){b.preventDefault(),$(this).hasClass("noDrag")||($(this).clone().appendTo(a),addNew(a.find("li:last")),sortableNav())}),$("#deleteFormBtn-Cancel").click(function(){$("a[href='#formCreator']").click()}),$("#deleteFormBtn-Submit").click(function(a){"yes"==prompt("Last chance!\nAre you sure you want to permanently delete this form?\n\nAnything but 'yes' will cancel").toLowerCase()&&$("#deleteFormFrm").submit()}),a.on("click",".groupingPreview i.icon-remove",function(){if(confirm("Are you sure you want to remove this grouping?")){var a=$(this).parent().parent();"grouping"==$(this).parent().next().children(":input[name^=nav_type_]").val()&&a.after($(this).next().find("li")),a.remove()}}).on("click","a",function(a){a.preventDefault()}),$(".groupingValues :input[name^='nav_type_'][value='grouping']").each(function(){var a=$(this).parents("li").prop("id");$(".groupingValues :input[name^='nav_grouping_'][value='"+$(this).siblings(":input[name^='nav_grouping_']").val()+"']").each(function(){a!=$(this).parents("li").prop("id")&&$(this).parents("li").detach().appendTo($("#"+a+" ul"))})}),sortableNav(),settingsBindings(),$("form[name=submitNavigation]").submit(function(b){$(".groupingValues :input[name^=nav_position_]").each(function(a){$(this).val(a)});var c={};$(".groupingValues :input").each(function(){var a=$(this).prop("name").split("_");c[a[2]]||(c[a[2]]={}),c[a[2]][a[1]]=$(this).val()});for(var d in c)"grouping"==c[d].type&&delete c[d];$(":input[name=groupings]",this).val(JSON.stringify(c)),$("#groupingsSettings :input").prop("disabled",!0),a.find(":input").prop("disabled",!0)})}),$(function(){$("div.fineUploader").each(function(a,b){var c=$(b),d=c.closest("form"),e=c.data("upload_id"),f=c.data("multiple"),g=c.data("allowed_extensions").split(",");c.fineUploader({request:{endpoint:siteRoot+"includes/uploader.php",params:{engineCSRFCheck:csrfToken,uploadID:e,multiple:f}},failedUploadTextDisplay:{mode:"custom",maxChars:40,responseProperty:"error",enableTooltip:!0},multiple:f,validation:{allowedExtensions:g},text:{uploadButton:'<div class="uploadText"> <i class="fa fa-upload fa-4x"></i> <br> Drag or Click Here <br> To Upload Files </div>',dropButton:"HELP"},showMessage:function(a){c.find(".qq-upload-list").append('<li class="alert alert-danger">'+a+"</li >")},classes:{success:"alert alert-success",fail:"alert alert-danger"}}).on("submit",function(){var a=d.data("uploads_working"),b="undefined"==typeof a?0:parseInt(a);d.data("uploads_working",++b).find(":submit").attr("disabled","disabled")}).on("complete cancel",function(){var a=parseInt(d.data("uploads_working"));a--,d.data("uploads_working",a),0==a&&d.find(":submit").removeAttr("disabled","disabled")})}),$(".fineUploader").parent().addClass("uploadFiles"),$(".qq-upload-drop-area").html('<div class="uploadText"> <i class="fa fa-dropbox fa-4x"></i> <br><br> Drop Files Here </div>'),$("div.filePreview a.previewLink").click(function(){var a=$(this).closest("div");a.hasClass("open")?a.removeClass("open").find("div").slideUp():a.addClass("open").find("div").slideDown()})});var globalFieldID,choicesFields={},idnoValues={};$(function(){var a=$("#formPreview"),b=$("#fieldAdd"),c=$("#formSettings"),d=$("#fieldTab");$("#leftPanel"),performance.now(),sortableForm(),fieldSettingsBindings(),formSettingsBindings(),modalBindings(),applyFormPreview(),d.on("click","a",function(){$("li",a).removeClass("well activeField"),showFieldSettings()}),$(document).keyup(function(a){27==a.keyCode&&($("#formPreview li").removeClass("activeField"),$(".addFieldNav").click().tab("show"))}),$(".draggable li",b).draggable({connectToSortable:"#formCreator ul.sortable",helper:"clone",revert:"invalid"}).click(function(){event.preventDefault(),$(this).clone().appendTo(a),addNewField($("li:last",a)),sortableForm()}),$(".fieldValues :input[name^='type_'][value='fieldset']").each(function(){var a=$(this).closest("li").prop("id");$(".fieldValues :input[name^='fieldset_'][value='"+$(this).siblings(":input[name^='fieldset_']").val()+"']").each(function(){a!=$(this).closest("li").prop("id")&&$(this).closest("li").detach().appendTo($("#"+a+" ul"))})}),$("form[name=submitForm]").submit(function(a){0===$("#formSettings_objectDisplayTitle").val().length&&$("#formSettings_objectDisplayTitle").val($("#formSettings_formTitle").val()).change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues),$("#fieldSettings_form").find("[data-bindmodel]").unbind("change keyup",bindToHiddenForm);var b={};$(":input",c).each(function(){var a=$(this).prop("name").split("_");"checkbox"==$(this).prop("type")?b[a[1]]=$(this).prop("checked"):b[a[1]]=$(this).val()}),$(":input[name=form]",this).val(JSON.stringify(b));var b={};$(".fieldValues :input").each(function(){var a=$(this).prop("name").split("_");b[a[1]]||(b[a[1]]={}),$(this).is('[id^="choicesOptions_"]')||$(this).is('[id^="allowedExtensions_"]')?(b[a[1]][a[0]]={},b[a[1]][a[0]]=$(this).val().split("%,%")):b[a[1]][a[0]]=$(this).val()});for(var d in b)("fieldset"==b[d].type||"Field Set"==b[d].type)&&delete b[d];$(":input[name=fields]",this).val(JSON.stringify(b))}),$("#fieldTab li:nth-child(3)").find("a").click(),0==$(".unassignedForms li").length?$(".unassignedForms").hide():$(".unassignedForms").show(),$(".navigationCreator").click(function(){$("#groupingTab li:first-child").find("a").click().tab("show")}),$(":submit").removeAttr("disabled")});var numIDNOs=0;String.prototype.sanitizeInput=function(){var a=/<\/?(script|embed|object|frameset|frame|iframe|meta|link|style).*?>/gim;return this.replace(a,"")},String.prototype.escapeHtml=function(){var a=this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;");return a},String.prototype.unEscapeHtml=function(){var a=this.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/g,"/");return a},$(function(){$("form[name=submitPermissions]").submit(function(){entrySubmit()})}),$(function(){var a=$("#GroupingsPreview");$("#groupingTab").on("click","a",function(){a.find("li").removeClass("well"),showSettings()}),$("#groupingsAdd .draggable li").draggable({connectToSortable:"#navigation ul.sortable",helper:"clone",revert:"invalid",cancel:".noDrag"}),$("#groupingsAdd").on("click","li",function(b){b.preventDefault(),$(this).hasClass("noDrag")||($(this).clone().appendTo(a),addNew(a.find("li:last")),sortableNav())}),$("#deleteFormBtn-Cancel").click(function(){$("a[href='#formCreator']").click()}),$("#deleteFormBtn-Submit").click(function(a){"yes"==prompt("Last chance!\nAre you sure you want to permanently delete this form?\n\nAnything but 'yes' will cancel").toLowerCase()&&$("#deleteFormFrm").submit()}),a.on("click",".groupingPreview i.icon-remove",function(){if(confirm("Are you sure you want to remove this grouping?")){var a=$(this).parent().parent();"grouping"==$(this).parent().next().children(":input[name^=nav_type_]").val()&&a.after($(this).next().find("li")),a.remove()}}).on("click","a",function(a){a.preventDefault()}),$(".groupingValues :input[name^='nav_type_'][value='grouping']").each(function(){var a=$(this).parents("li").prop("id");$(".groupingValues :input[name^='nav_grouping_'][value='"+$(this).siblings(":input[name^='nav_grouping_']").val()+"']").each(function(){a!=$(this).parents("li").prop("id")&&$(this).parents("li").detach().appendTo($("#"+a+" ul"))})}),sortableNav(),settingsBindings(),$("form[name=submitNavigation]").submit(function(b){$(".groupingValues :input[name^=nav_position_]").each(function(a){$(this).val(a)});var c={};$(".groupingValues :input").each(function(){var a=$(this).prop("name").split("_");c[a[2]]||(c[a[2]]={}),c[a[2]][a[1]]=$(this).val()});for(var d in c)"grouping"==c[d].type&&delete c[d];$(":input[name=groupings]",this).val(JSON.stringify(c)),$("#groupingsSettings :input").prop("disabled",!0),a.find(":input").prop("disabled",!0)})}),$(function(){$("div.fineUploader").each(function(a,b){var c=$(b),d=c.closest("form"),e=c.data("upload_id"),f=c.data("multiple"),g=c.data("allowed_extensions").split(",");c.fineUploader({request:{endpoint:siteRoot+"includes/uploader.php",params:{engineCSRFCheck:csrfToken,uploadID:e,multiple:f}},failedUploadTextDisplay:{mode:"custom",maxChars:40,responseProperty:"error",enableTooltip:!0},multiple:f,validation:{allowedExtensions:g},text:{uploadButton:'<div class="uploadText"> <i class="fa fa-upload fa-4x"></i> <br> Drag or Click Here <br> To Upload Files </div>',dropButton:"HELP"},showMessage:function(a){c.find(".qq-upload-list").append('<li class="alert alert-danger">'+a+"</li >")},classes:{success:"alert alert-success",fail:"alert alert-danger"}}).on("submit",function(){var a=d.data("uploads_working"),b="undefined"==typeof a?0:parseInt(a);d.data("uploads_working",++b).find(":submit").attr("disabled","disabled")}).on("complete cancel",function(){var a=parseInt(d.data("uploads_working"));a--,d.data("uploads_working",a),0==a&&d.find(":submit").removeAttr("disabled","disabled")})}),$(".fineUploader").parent().addClass("uploadFiles"),$(".qq-upload-drop-area").html('<div class="uploadText"> <i class="fa fa-dropbox fa-4x"></i> <br><br> Drop Files Here </div>'),$("div.filePreview a.previewLink").click(function(){var a=$(this).closest("div");a.hasClass("open")?a.removeClass("open").find("div").slideUp():a.addClass("open").find("div").slideDown()})});var globalFieldID,choicesFields={},idnoValues={};$(function(){var a=$("#formPreview"),b=$("#fieldAdd"),c=$("#formSettings"),d=$("#fieldTab");$("#leftPanel"),performance.now(),sortableForm(),fieldSettingsBindings(),formSettingsBindings(),modalBindings(),applyFormPreview(),d.on("click","a",function(){$("li",a).removeClass("well activeField"),showFieldSettings()}),$(document).keyup(function(a){27==a.keyCode&&($("#formPreview li").removeClass("activeField"),$(".addFieldNav").click().tab("show"))}),$(".draggable li",b).draggable({connectToSortable:"#formCreator ul.sortable",helper:"clone",revert:"invalid"}).click(function(){event.preventDefault(),$(this).clone().appendTo(a),addNewField($("li:last",a)),sortableForm()}),$(".fieldValues :input[name^='type_'][value='fieldset']").each(function(){var a=$(this).closest("li").prop("id");$(".fieldValues :input[name^='fieldset_'][value='"+$(this).siblings(":input[name^='fieldset_']").val()+"']").each(function(){a!=$(this).closest("li").prop("id")&&$(this).closest("li").detach().appendTo($("#"+a+" ul"))})}),$("form[name=submitForm]").submit(function(a){0===$("#formSettings_objectDisplayTitle").val().length&&$("#formSettings_objectDisplayTitle").val($("#formSettings_formTitle").val()).change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues),$("#fieldSettings_form").find("[data-bindmodel]").unbind("change keyup",bindToHiddenForm);var b={};$(":input",c).each(function(){var a=$(this).prop("name").split("_");"checkbox"==$(this).prop("type")?b[a[1]]=$(this).prop("checked"):b[a[1]]=$(this).val()}),$(":input[name=form]",this).val(JSON.stringify(b));var b={};$(".fieldValues :input").each(function(){var a=$(this).prop("name").split("_");b[a[1]]||(b[a[1]]={}),$(this).is('[id^="choicesOptions_"]')||$(this).is('[id^="allowedExtensions_"]')?(b[a[1]][a[0]]={},b[a[1]][a[0]]=$(this).val().split("%,%")):b[a[1]][a[0]]=$(this).val()});for(var d in b)("fieldset"==b[d].type||"Field Set"==b[d].type)&&delete b[d];$(":input[name=fields]",this).val(JSON.stringify(b))}),$("#fieldTab li:nth-child(3)").find("a").click(),0==$(".unassignedForms li").length?$(".unassignedForms").hide():$(".unassignedForms").show(),$(".navigationCreator").click(function(){$("#groupingTab li:first-child").find("a").click().tab("show")}),$(":submit").removeAttr("disabled")});var numIDNOs=0;String.prototype.sanitizeInput=function(){var a=/<\/?(script|embed|object|frameset|frame|iframe|meta|link|style).*?>/gim;return this.replace(a,"")},String.prototype.escapeHtml=function(){var a=this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;");return a},String.prototype.unEscapeHtml=function(){var a=this.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/g,"/");return a},$(function(){$("form[name=submitPermissions]").submit(function(){entrySubmit()})}),$(function(){var a=$("#GroupingsPreview");$("#groupingTab").on("click","a",function(){a.find("li").removeClass("well"),showSettings()}),$("#groupingsAdd .draggable li").draggable({connectToSortable:"#navigation ul.sortable",helper:"clone",revert:"invalid",cancel:".noDrag"}),$("#groupingsAdd").on("click","li",function(b){b.preventDefault(),$(this).hasClass("noDrag")||($(this).clone().appendTo(a),addNew(a.find("li:last")),sortableNav())}),$("#deleteFormBtn-Cancel").click(function(){$("a[href='#formCreator']").click()}),$("#deleteFormBtn-Submit").click(function(a){"yes"==prompt("Last chance!\nAre you sure you want to permanently delete this form?\n\nAnything but 'yes' will cancel").toLowerCase()&&$("#deleteFormFrm").submit()}),a.on("click",".groupingPreview i.icon-remove",function(){if(confirm("Are you sure you want to remove this grouping?")){var a=$(this).parent().parent();"grouping"==$(this).parent().next().children(":input[name^=nav_type_]").val()&&a.after($(this).next().find("li")),a.remove()}}).on("click","a",function(a){a.preventDefault()}),$(".groupingValues :input[name^='nav_type_'][value='grouping']").each(function(){var a=$(this).parents("li").prop("id");$(".groupingValues :input[name^='nav_grouping_'][value='"+$(this).siblings(":input[name^='nav_grouping_']").val()+"']").each(function(){a!=$(this).parents("li").prop("id")&&$(this).parents("li").detach().appendTo($("#"+a+" ul"))})}),sortableNav(),settingsBindings(),$("form[name=submitNavigation]").submit(function(b){$(".groupingValues :input[name^=nav_position_]").each(function(a){$(this).val(a)});var c={};$(".groupingValues :input").each(function(){var a=$(this).prop("name").split("_");c[a[2]]||(c[a[2]]={}),c[a[2]][a[1]]=$(this).val()});for(var d in c)"grouping"==c[d].type&&delete c[d];$(":input[name=groupings]",this).val(JSON.stringify(c)),$("#groupingsSettings :input").prop("disabled",!0),a.find(":input").prop("disabled",!0)})}),$(function(){$("div.fineUploader").each(function(a,b){var c=$(b),d=c.closest("form"),e=c.data("upload_id"),f=c.data("multiple"),g=c.data("allowed_extensions").split(",");c.fineUploader({request:{endpoint:siteRoot+"includes/uploader.php",params:{engineCSRFCheck:csrfToken,uploadID:e,multiple:f}},failedUploadTextDisplay:{mode:"custom",maxChars:40,responseProperty:"error",enableTooltip:!0},multiple:f,validation:{allowedExtensions:g},text:{uploadButton:'<div class="uploadText"> <i class="fa fa-upload fa-4x"></i> <br> Drag or Click Here <br> To Upload Files </div>',dropButton:"HELP"},showMessage:function(a){c.find(".qq-upload-list").append('<li class="alert alert-danger">'+a+"</li >")},classes:{success:"alert alert-success",fail:"alert alert-danger"}}).on("submit",function(){var a=d.data("uploads_working"),b="undefined"==typeof a?0:parseInt(a);d.data("uploads_working",++b).find(":submit").attr("disabled","disabled")}).on("complete cancel",function(){var a=parseInt(d.data("uploads_working"));a--,d.data("uploads_working",a),0==a&&d.find(":submit").removeAttr("disabled","disabled")})}),$(".fineUploader").parent().addClass("uploadFiles"),$(".qq-upload-drop-area").html('<div class="uploadText"> <i class="fa fa-dropbox fa-4x"></i> <br><br> Drop Files Here </div>'),$("div.filePreview a.previewLink").click(function(){var a=$(this).closest("div");a.hasClass("open")?a.removeClass("open").find("div").slideUp():a.addClass("open").find("div").slideDown()})});var globalFieldID,choicesFields={},idnoValues={};$(function(){var a=$("#formPreview"),b=$("#fieldAdd"),c=$("#formSettings"),d=$("#fieldTab");$("#leftPanel"),performance.now(),sortableForm(),fieldSettingsBindings(),formSettingsBindings(),modalBindings(),applyFormPreview(),d.on("click","a",function(){$("li",a).removeClass("well activeField"),showFieldSettings()}),$(document).keyup(function(a){27==a.keyCode&&($("#formPreview li").removeClass("activeField"),$(".addFieldNav").click().tab("show"))}),$(".draggable li",b).draggable({connectToSortable:"#formCreator ul.sortable",helper:"clone",revert:"invalid"}).click(function(){event.preventDefault(),$(this).clone().appendTo(a),addNewField($("li:last",a)),sortableForm()}),$(".fieldValues :input[name^='type_'][value='fieldset']").each(function(){var a=$(this).closest("li").prop("id");$(".fieldValues :input[name^='fieldset_'][value='"+$(this).siblings(":input[name^='fieldset_']").val()+"']").each(function(){a!=$(this).closest("li").prop("id")&&$(this).closest("li").detach().appendTo($("#"+a+" ul"))})}),$("form[name=submitForm]").submit(function(a){0===$("#formSettings_objectDisplayTitle").val().length&&$("#formSettings_objectDisplayTitle").val($("#formSettings_formTitle").val()).change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues),$("#fieldSettings_form").find("[data-bindmodel]").unbind("change keyup",bindToHiddenForm);var b={};$(":input",c).each(function(){var a=$(this).prop("name").split("_");"checkbox"==$(this).prop("type")?b[a[1]]=$(this).prop("checked"):b[a[1]]=$(this).val()}),$(":input[name=form]",this).val(JSON.stringify(b));var b={};$(".fieldValues :input").each(function(){var a=$(this).prop("name").split("_");b[a[1]]||(b[a[1]]={}),$(this).is('[id^="choicesOptions_"]')||$(this).is('[id^="allowedExtensions_"]')?(b[a[1]][a[0]]={},b[a[1]][a[0]]=$(this).val().split("%,%")):b[a[1]][a[0]]=$(this).val()});for(var d in b)("fieldset"==b[d].type||"Field Set"==b[d].type)&&delete b[d];$(":input[name=fields]",this).val(JSON.stringify(b))}),$("#fieldTab li:nth-child(3)").find("a").click(),0==$(".unassignedForms li").length?$(".unassignedForms").hide():$(".unassignedForms").show(),$(".navigationCreator").click(function(){$("#groupingTab li:first-child").find("a").click().tab("show")}),$(":submit").removeAttr("disabled")});var numIDNOs=0;String.prototype.sanitizeInput=function(){var a=/<\/?(script|embed|object|frameset|frame|iframe|meta|link|style).*?>/gim;return this.replace(a,"")},String.prototype.escapeHtml=function(){var a=this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;");return a},String.prototype.unEscapeHtml=function(){var a=this.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/g,"/");return a},$(function(){$("form[name=submitPermissions]").submit(function(){entrySubmit()})}),$(function(){var a=$("#GroupingsPreview");$("#groupingTab").on("click","a",function(){a.find("li").removeClass("well"),showSettings()}),$("#groupingsAdd .draggable li").draggable({connectToSortable:"#navigation ul.sortable",helper:"clone",revert:"invalid",cancel:".noDrag"}),$("#groupingsAdd").on("click","li",function(b){b.preventDefault(),$(this).hasClass("noDrag")||($(this).clone().appendTo(a),addNew(a.find("li:last")),sortableNav())}),$("#deleteFormBtn-Cancel").click(function(){
$("a[href='#formCreator']").click()}),$("#deleteFormBtn-Submit").click(function(a){"yes"==prompt("Last chance!\nAre you sure you want to permanently delete this form?\n\nAnything but 'yes' will cancel").toLowerCase()&&$("#deleteFormFrm").submit()}),a.on("click",".groupingPreview i.icon-remove",function(){if(confirm("Are you sure you want to remove this grouping?")){var a=$(this).parent().parent();"grouping"==$(this).parent().next().children(":input[name^=nav_type_]").val()&&a.after($(this).next().find("li")),a.remove()}}).on("click","a",function(a){a.preventDefault()}),$(".groupingValues :input[name^='nav_type_'][value='grouping']").each(function(){var a=$(this).parents("li").prop("id");$(".groupingValues :input[name^='nav_grouping_'][value='"+$(this).siblings(":input[name^='nav_grouping_']").val()+"']").each(function(){a!=$(this).parents("li").prop("id")&&$(this).parents("li").detach().appendTo($("#"+a+" ul"))})}),sortableNav(),settingsBindings(),$("form[name=submitNavigation]").submit(function(b){$(".groupingValues :input[name^=nav_position_]").each(function(a){$(this).val(a)});var c={};$(".groupingValues :input").each(function(){var a=$(this).prop("name").split("_");c[a[2]]||(c[a[2]]={}),c[a[2]][a[1]]=$(this).val()});for(var d in c)"grouping"==c[d].type&&delete c[d];$(":input[name=groupings]",this).val(JSON.stringify(c)),$("#groupingsSettings :input").prop("disabled",!0),a.find(":input").prop("disabled",!0)})}),$(function(){$("div.fineUploader").each(function(a,b){var c=$(b),d=c.closest("form"),e=c.data("upload_id"),f=c.data("multiple"),g=c.data("allowed_extensions").split(",");c.fineUploader({request:{endpoint:siteRoot+"includes/uploader.php",params:{engineCSRFCheck:csrfToken,uploadID:e,multiple:f}},failedUploadTextDisplay:{mode:"custom",maxChars:40,responseProperty:"error",enableTooltip:!0},multiple:f,validation:{allowedExtensions:g},text:{uploadButton:'<div class="uploadText"> <i class="fa fa-upload fa-4x"></i> <br> Drag or Click Here <br> To Upload Files </div>',dropButton:"HELP"},showMessage:function(a){c.find(".qq-upload-list").append('<li class="alert alert-danger">'+a+"</li >")},classes:{success:"alert alert-success",fail:"alert alert-danger"}}).on("submit",function(){var a=d.data("uploads_working"),b="undefined"==typeof a?0:parseInt(a);d.data("uploads_working",++b).find(":submit").attr("disabled","disabled")}).on("complete cancel",function(){var a=parseInt(d.data("uploads_working"));a--,d.data("uploads_working",a),0==a&&d.find(":submit").removeAttr("disabled","disabled")})}),$(".fineUploader").parent().addClass("uploadFiles"),$(".qq-upload-drop-area").html('<div class="uploadText"> <i class="fa fa-dropbox fa-4x"></i> <br><br> Drop Files Here </div>'),$("div.filePreview a.previewLink").click(function(){var a=$(this).closest("div");a.hasClass("open")?a.removeClass("open").find("div").slideUp():a.addClass("open").find("div").slideDown()})});var globalFieldID,choicesFields={},idnoValues={};$(function(){var a=$("#formPreview"),b=$("#fieldAdd"),c=$("#formSettings"),d=$("#fieldTab");$("#leftPanel"),performance.now(),sortableForm(),fieldSettingsBindings(),formSettingsBindings(),modalBindings(),applyFormPreview(),d.on("click","a",function(){$("li",a).removeClass("well activeField"),showFieldSettings()}),$(document).keyup(function(a){27==a.keyCode&&($("#formPreview li").removeClass("activeField"),$(".addFieldNav").click().tab("show"))}),$(".draggable li",b).draggable({connectToSortable:"#formCreator ul.sortable",helper:"clone",revert:"invalid"}).click(function(){event.preventDefault(),$(this).clone().appendTo(a),addNewField($("li:last",a)),sortableForm()}),$(".fieldValues :input[name^='type_'][value='fieldset']").each(function(){var a=$(this).closest("li").prop("id");$(".fieldValues :input[name^='fieldset_'][value='"+$(this).siblings(":input[name^='fieldset_']").val()+"']").each(function(){a!=$(this).closest("li").prop("id")&&$(this).closest("li").detach().appendTo($("#"+a+" ul"))})}),$("form[name=submitForm]").submit(function(a){0===$("#formSettings_objectDisplayTitle").val().length&&$("#formSettings_objectDisplayTitle").val($("#formSettings_formTitle").val()).change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues),$("#fieldSettings_form").find("[data-bindmodel]").unbind("change keyup",bindToHiddenForm);var b={};$(":input",c).each(function(){var a=$(this).prop("name").split("_");"checkbox"==$(this).prop("type")?b[a[1]]=$(this).prop("checked"):b[a[1]]=$(this).val()}),$(":input[name=form]",this).val(JSON.stringify(b));var b={};$(".fieldValues :input").each(function(){var a=$(this).prop("name").split("_");b[a[1]]||(b[a[1]]={}),$(this).is('[id^="choicesOptions_"]')||$(this).is('[id^="allowedExtensions_"]')?(b[a[1]][a[0]]={},b[a[1]][a[0]]=$(this).val().split("%,%")):b[a[1]][a[0]]=$(this).val()});for(var d in b)("fieldset"==b[d].type||"Field Set"==b[d].type)&&delete b[d];$(":input[name=fields]",this).val(JSON.stringify(b))}),$("#fieldTab li:nth-child(3)").find("a").click(),0==$(".unassignedForms li").length?$(".unassignedForms").hide():$(".unassignedForms").show(),$(".navigationCreator").click(function(){$("#groupingTab li:first-child").find("a").click().tab("show")}),$(":submit").removeAttr("disabled")});var numIDNOs=0;String.prototype.sanitizeInput=function(){var a=/<\/?(script|embed|object|frameset|frame|iframe|meta|link|style).*?>/gim;return this.replace(a,"")},String.prototype.escapeHtml=function(){var a=this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;");return a},String.prototype.unEscapeHtml=function(){var a=this.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/g,"/");return a},$(function(){$("form[name=submitPermissions]").submit(function(){entrySubmit()})}),$(function(){var a=$("#GroupingsPreview");$("#groupingTab").on("click","a",function(){a.find("li").removeClass("well"),showSettings()}),$("#groupingsAdd .draggable li").draggable({connectToSortable:"#navigation ul.sortable",helper:"clone",revert:"invalid",cancel:".noDrag"}),$("#groupingsAdd").on("click","li",function(b){b.preventDefault(),$(this).hasClass("noDrag")||($(this).clone().appendTo(a),addNew(a.find("li:last")),sortableNav())}),$("#deleteFormBtn-Cancel").click(function(){$("a[href='#formCreator']").click()}),$("#deleteFormBtn-Submit").click(function(a){"yes"==prompt("Last chance!\nAre you sure you want to permanently delete this form?\n\nAnything but 'yes' will cancel").toLowerCase()&&$("#deleteFormFrm").submit()}),a.on("click",".groupingPreview i.icon-remove",function(){if(confirm("Are you sure you want to remove this grouping?")){var a=$(this).parent().parent();"grouping"==$(this).parent().next().children(":input[name^=nav_type_]").val()&&a.after($(this).next().find("li")),a.remove()}}).on("click","a",function(a){a.preventDefault()}),$(".groupingValues :input[name^='nav_type_'][value='grouping']").each(function(){var a=$(this).parents("li").prop("id");$(".groupingValues :input[name^='nav_grouping_'][value='"+$(this).siblings(":input[name^='nav_grouping_']").val()+"']").each(function(){a!=$(this).parents("li").prop("id")&&$(this).parents("li").detach().appendTo($("#"+a+" ul"))})}),sortableNav(),settingsBindings(),$("form[name=submitNavigation]").submit(function(b){$(".groupingValues :input[name^=nav_position_]").each(function(a){$(this).val(a)});var c={};$(".groupingValues :input").each(function(){var a=$(this).prop("name").split("_");c[a[2]]||(c[a[2]]={}),c[a[2]][a[1]]=$(this).val()});for(var d in c)"grouping"==c[d].type&&delete c[d];$(":input[name=groupings]",this).val(JSON.stringify(c)),$("#groupingsSettings :input").prop("disabled",!0),a.find(":input").prop("disabled",!0)})}),$(function(){$("div.fineUploader").each(function(a,b){var c=$(b),d=c.closest("form"),e=c.data("upload_id"),f=c.data("multiple"),g=c.data("allowed_extensions").split(",");c.fineUploader({request:{endpoint:siteRoot+"includes/uploader.php",params:{engineCSRFCheck:csrfToken,uploadID:e,multiple:f}},failedUploadTextDisplay:{mode:"custom",maxChars:40,responseProperty:"error",enableTooltip:!0},multiple:f,validation:{allowedExtensions:g},text:{uploadButton:'<div class="uploadText"> <i class="fa fa-upload fa-4x"></i> <br> Drag or Click Here <br> To Upload Files </div>',dropButton:"HELP"},showMessage:function(a){c.find(".qq-upload-list").append('<li class="alert alert-danger">'+a+"</li >")},classes:{success:"alert alert-success",fail:"alert alert-danger"}}).on("submit",function(){var a=d.data("uploads_working"),b="undefined"==typeof a?0:parseInt(a);d.data("uploads_working",++b).find(":submit").attr("disabled","disabled")}).on("complete cancel",function(){var a=parseInt(d.data("uploads_working"));a--,d.data("uploads_working",a),0==a&&d.find(":submit").removeAttr("disabled","disabled")})}),$(".fineUploader").parent().addClass("uploadFiles"),$(".qq-upload-drop-area").html('<div class="uploadText"> <i class="fa fa-dropbox fa-4x"></i> <br><br> Drop Files Here </div>'),$("div.filePreview a.previewLink").click(function(){var a=$(this).closest("div");a.hasClass("open")?a.removeClass("open").find("div").slideUp():a.addClass("open").find("div").slideDown()})});var globalFieldID,choicesFields={},idnoValues={};$(function(){var a=$("#formPreview"),b=$("#fieldAdd"),c=$("#formSettings"),d=$("#fieldTab");$("#leftPanel"),performance.now(),sortableForm(),fieldSettingsBindings(),formSettingsBindings(),modalBindings(),applyFormPreview(),d.on("click","a",function(){$("li",a).removeClass("well activeField"),showFieldSettings()}),$(document).keyup(function(a){27==a.keyCode&&($("#formPreview li").removeClass("activeField"),$(".addFieldNav").click().tab("show"))}),$(".draggable li",b).draggable({connectToSortable:"#formCreator ul.sortable",helper:"clone",revert:"invalid"}).click(function(){event.preventDefault(),$(this).clone().appendTo(a),addNewField($("li:last",a)),sortableForm()}),$(".fieldValues :input[name^='type_'][value='fieldset']").each(function(){var a=$(this).closest("li").prop("id");$(".fieldValues :input[name^='fieldset_'][value='"+$(this).siblings(":input[name^='fieldset_']").val()+"']").each(function(){a!=$(this).closest("li").prop("id")&&$(this).closest("li").detach().appendTo($("#"+a+" ul"))})}),$("form[name=submitForm]").submit(function(a){0===$("#formSettings_objectDisplayTitle").val().length&&$("#formSettings_objectDisplayTitle").val($("#formSettings_formTitle").val()).change(),$("#formPreview").find("[data-bind]").unbind("change",setOriginalValues),$("#fieldSettings_form").find("[data-bindmodel]").unbind("change keyup",bindToHiddenForm);var b={};$(":input",c).each(function(){var a=$(this).prop("name").split("_");"checkbox"==$(this).prop("type")?b[a[1]]=$(this).prop("checked"):b[a[1]]=$(this).val()}),$(":input[name=form]",this).val(JSON.stringify(b));var b={};$(".fieldValues :input").each(function(){var a=$(this).prop("name").split("_");b[a[1]]||(b[a[1]]={}),$(this).is('[id^="choicesOptions_"]')||$(this).is('[id^="allowedExtensions_"]')?(b[a[1]][a[0]]={},b[a[1]][a[0]]=$(this).val().split("%,%")):b[a[1]][a[0]]=$(this).val()});for(var d in b)("fieldset"==b[d].type||"Field Set"==b[d].type)&&delete b[d];$(":input[name=fields]",this).val(JSON.stringify(b))}),$("#fieldTab li:nth-child(3)").find("a").click(),0==$(".unassignedForms li").length?$(".unassignedForms").hide():$(".unassignedForms").show(),$(".navigationCreator").click(function(){$("#groupingTab li:first-child").find("a").click().tab("show")}),$(":submit").removeAttr("disabled")});var numIDNOs=0;String.prototype.sanitizeInput=function(){var a=/<\/?(script|embed|object|frameset|frame|iframe|meta|link|style).*?>/gim;return this.replace(a,"")},String.prototype.escapeHtml=function(){var a=this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;");return a},String.prototype.unEscapeHtml=function(){var a=this.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/g,"/");return a},$(function(){$("form[name=submitPermissions]").submit(function(){entrySubmit()})}),$(function(){var a=$("#GroupingsPreview");$("#groupingTab").on("click","a",function(){a.find("li").removeClass("well"),showSettings()}),$("#groupingsAdd .draggable li").draggable({connectToSortable:"#navigation ul.sortable",helper:"clone",revert:"invalid",cancel:".noDrag"}),$("#groupingsAdd").on("click","li",function(b){b.preventDefault(),$(this).hasClass("noDrag")||($(this).clone().appendTo(a),addNew(a.find("li:last")),sortableNav())}),$("#deleteFormBtn-Cancel").click(function(){$("a[href='#formCreator']").click()}),$("#deleteFormBtn-Submit").click(function(a){"yes"==prompt("Last chance!\nAre you sure you want to permanently delete this form?\n\nAnything but 'yes' will cancel").toLowerCase()&&$("#deleteFormFrm").submit()}),a.on("click",".groupingPreview i.icon-remove",function(){if(confirm("Are you sure you want to remove this grouping?")){var a=$(this).parent().parent();"grouping"==$(this).parent().next().children(":input[name^=nav_type_]").val()&&a.after($(this).next().find("li")),a.remove()}}).on("click","a",function(a){a.preventDefault()}),$(".groupingValues :input[name^='nav_type_'][value='grouping']").each(function(){var a=$(this).parents("li").prop("id");$(".groupingValues :input[name^='nav_grouping_'][value='"+$(this).siblings(":input[name^='nav_grouping_']").val()+"']").each(function(){a!=$(this).parents("li").prop("id")&&$(this).parents("li").detach().appendTo($("#"+a+" ul"))})}),sortableNav(),settingsBindings(),$("form[name=submitNavigation]").submit(function(b){$(".groupingValues :input[name^=nav_position_]").each(function(a){$(this).val(a)});var c={};$(".groupingValues :input").each(function(){var a=$(this).prop("name").split("_");c[a[2]]||(c[a[2]]={}),c[a[2]][a[1]]=$(this).val()});for(var d in c)"grouping"==c[d].type&&delete c[d];$(":input[name=groupings]",this).val(JSON.stringify(c)),$("#groupingsSettings :input").prop("disabled",!0),a.find(":input").prop("disabled",!0)})}),$(function(){$("div.fineUploader").each(function(a,b){var c=$(b),d=c.closest("form"),e=c.data("upload_id"),f=c.data("multiple"),g=c.data("allowed_extensions").split(",");c.fineUploader({request:{endpoint:siteRoot+"includes/uploader.php",params:{engineCSRFCheck:csrfToken,uploadID:e,multiple:f}},failedUploadTextDisplay:{mode:"custom",maxChars:40,responseProperty:"error",enableTooltip:!0},multiple:f,validation:{allowedExtensions:g},text:{uploadButton:'<div class="uploadText"> <i class="fa fa-upload fa-4x"></i> <br> Drag or Click Here <br> To Upload Files </div>',dropButton:"HELP"},showMessage:function(a){c.find(".qq-upload-list").append('<li class="alert alert-danger">'+a+"</li >")},classes:{success:"alert alert-success",fail:"alert alert-danger"}}).on("submit",function(){var a=d.data("uploads_working"),b="undefined"==typeof a?0:parseInt(a);d.data("uploads_working",++b).find(":submit").attr("disabled","disabled")}).on("complete cancel",function(){var a=parseInt(d.data("uploads_working"));a--,d.data("uploads_working",a),0==a&&d.find(":submit").removeAttr("disabled","disabled")})}),$(".fineUploader").parent().addClass("uploadFiles"),$(".qq-upload-drop-area").html('<div class="uploadText"> <i class="fa fa-dropbox fa-4x"></i> <br><br> Drop Files Here </div>'),$("div.filePreview a.previewLink").click(function(){var a=$(this).closest("div");a.hasClass("open")?a.removeClass("open").find("div").slideUp():a.addClass("open").find("div").slideDown()})});